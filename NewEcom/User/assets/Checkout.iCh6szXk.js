import{j as e,n as y,z as f,R as v,f as P,e as k,r as N}from"./index.iBcEEe4E.js";import{u as S,A}from"./AddressModal.CxXJmMgi.js";import{u as F}from"./useModal.CYjSKKl-.js";import{B as L}from"./ButtonBar.BCVNhBr3.js";import{P as w}from"./dialog.Dole23pQ.js";import{b as O,u as $}from"./useCart.D6g7wMx8.js";import{u as D}from"./useOrder.DGBVX9fE.js";import"./index.esm.CSPHdcmw.js";import"./useMutation.GV4_nnAS.js";import"./queryToast.C6VuZVzt.js";const M=({selectedAddress:s,setSelectedAddress:a,onContinue:n})=>{const{data:i,isLoading:m,error:r,refetch:d}=S({pageNumber:1,pageSize:10}),{openModal:c,closeModal:u,isModalOpen:h}=F();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4 max-w-xl mx-auto",children:[e.jsx(w,{title:"Address",component:e.jsx(L,{buttons:[{label:"Add New",onClick:()=>c({isAddress:!0}),colorClass:"bg-orange-500 hover:bg-orange-600 text-white transition"}]})}),e.jsx(A,{show:h?.isAddress||!1,handleClose:()=>u({isAddress:!1}),isAdd:!0,refetch:d}),m&&e.jsx(y,{}),r&&e.jsx("p",{className:"text-red-500",children:"Failed to load addresses"}),i?.results?.length?e.jsx("div",{className:"space-y-2 max-h-[50vh] custom-scroll",children:i.results.map(t=>e.jsxs("div",{onClick:()=>t._id&&a(t),className:`relative p-3 border rounded cursor-pointer transition-all duration-200
                                ${s?._id===t._id?"border-orange-500 bg-orange-50 shadow-md":"border-gray-300 hover:border-orange-500 hover:bg-orange-50"}`,children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 z-10",children:[e.jsx("button",{onClick:g=>{g.stopPropagation()},className:"p-1 text-gray-500 hover:text-orange-600 hover:bg-gray-200 rounded transition",title:"Edit Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),f.success(`Deleted address: ${t.name}`)},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-gray-200 rounded transition",title:"Delete Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.addressLine1}),t.addressLine2&&e.jsx("p",{className:"text-sm text-gray-600",children:t.addressLine2}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.city,", ",t.state," - ",t.postalCode]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.country}),e.jsx("p",{className:"text-sm text-gray-600",children:t.phone})]},t._id))}):e.jsx("p",{className:"text-gray-500",children:"No saved addresses"}),e.jsx("button",{onClick:n,disabled:!s,className:`bg-orange-500 text-white px-6 py-2 rounded w-full disabled:opacity-50\r
                    hover:bg-orange-600 hover:scale-105 transition-transform duration-200`,children:"Continue to Payment"})]})},z=({products:s,address:a,subtotal:n,shipping:i,discount:m=0,refetch:r,onContinue:d})=>{const{handleIncrease:c,handleDecrease:u,handleRemove:h,isPending:t}=O(r),g=n+i;return e.jsxs("div",{className:"max-w-4xl mx-auto bg-gradient-to-br from-orange-50 to-white rounded-xl shadow-xl",children:[e.jsx(w,{title:"Summary"}),e.jsxs("div",{className:"sm:p-8 p-2 flex gap-3 flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md sm:p-6 p-2",children:[e.jsx("h3",{className:"font-semibold text-2xl mb-4 border-b border-orange-300 pb-2",children:"Shipping Address"}),e.jsxs("address",{className:"not-italic space-y-1 text-gray-800 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-lg",children:a.name}),e.jsxs("p",{children:[a.addressLine1,a.addressLine2&&`, ${a.addressLine2}`]}),e.jsxs("p",{children:[a.city,", ",a.state," - ",a.postalCode]}),e.jsx("p",{children:a.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Phone: ",a.phone]})]})]}),e.jsxs("div",{className:"max-h-[50vh] custom-scroll",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-white bg-opacity-90 backdrop-blur-md border-b border-orange-300 py-3 px-2",children:e.jsxs("h3",{className:"font-semibold text-2xl text-orange-600 tracking-wide",children:["Products: ",s.length]})}),e.jsx("div",{className:"space-y-6 mt-4",children:t?e.jsx(y,{}):s.map(o=>{const l=typeof o.product_id=="string"?null:o.product_id;if(!l)return e.jsxs("div",{className:"text-red-700 font-semibold bg-red-100 p-4 rounded-md shadow-sm",children:["Product data missing for item ",o._id]},o._id);const x=!l.inStock||l.stock===0,j=o.quantity<l.stock,p=o.quantity>0;return e.jsxs("div",{className:"flex items-center flex-wrap justify-between border rounded-lg border-gray-200 p-4 shadow-sm hover:shadow-lg transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[l.images?e.jsx("img",{src:l.images,alt:l.name,className:"w-24 h-24 object-cover rounded-lg shadow-md",loading:"lazy"}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-sm font-medium",children:"No Image"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:l.name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Quantity: ",o.quantity]}),x&&e.jsxs("p",{className:"text-red-600 flex items-center gap-2 mt-2 font-medium",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"error"}),"Sorry, this product is out of stock. Available stock:"," ",l.stock]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"font-bold text-lg text-orange-600 tracking-wide",children:["₹",l.total_sell_price.toFixed(2)]}),e.jsx("button",{onClick:()=>u(o),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${p?"bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-4 focus:ring-orange-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,disabled:!p,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"remove"})}),e.jsx("button",{onClick:()=>c(o),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${j?"bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-4 focus:ring-orange-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,disabled:!j,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"})}),e.jsx("button",{onClick:()=>h(o),className:"flex items-center justify-center w-10 h-10 bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-300 text-white rounded-full shadow-md transition-transform active:scale-95",children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]},o._id)})})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",n.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",i.toFixed(2)]})]}),m>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-semibold text-lg",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-extrabold text-2xl pt-3 text-orange-600",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",g.toFixed(2)]})]})]}),e.jsx("button",{onClick:d,className:"w-full mt-8 bg-gradient-to-r from-orange-500 to-orange-700 hover:from-orange-700 hover:to-orange-900 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95",children:"Proceed to Payment"})]})]})},q=({step:s,setStep:a})=>{const n=["Address","Summary","Payment","Done"];return e.jsx("div",{className:"w-full bg-white p-4 rounded-md shadow border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between relative",children:n.map((i,m)=>{const r=m+1,d=s===r,c=s>r;return e.jsxs("div",{className:"flex flex-col items-center flex-1 relative",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold z-10
                  ${c?"bg-green-500 text-white":d?"bg-orange-500 text-white":"bg-gray-200 text-gray-500"}`,onClick:()=>a(r),children:c?"✓":r}),e.jsx("span",{className:`mt-2 text-xs sm:text-sm text-center
                  ${d?"text-orange-500 font-medium":c?"text-green-600":"text-gray-400"}`,children:i}),m<n.length-1&&e.jsxs("div",{className:"absolute top-[15px] left-1/2 w-full h-0.5 -z-0",children:[e.jsx("div",{className:"h-[3px] absolute left-0 bg-gray-300 w-full"}),e.jsx("div",{className:`h-[3px] absolute left-0 transition-all duration-500
        ${c&&"bg-green-500"}`,style:{width:c?"100%":d?"50%":"0%"}})]})]},i)})})})},I=({productData:s,setPaymentMethod:a,onConfirm:n,isPending:i,address:m,shipping:r=0,discount:d=0,paymentMethod:c})=>{const{results:u,total_carts:h}=s,[t,g]=v.useState("upi"),o=x=>{g(x),a(x)},l=h.total_sell_price+r-d;return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-3",children:"Review & Payment"}),e.jsx("div",{className:"space-y-4",children:u.map(x=>e.jsx(R,{item:x},x._id))}),e.jsx(E,{totals:h,shipping:r,discount:d}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-800",children:"Select Payment Method"}),e.jsxs("select",{className:"w-full border-2 border-orange-500 focus:border-orange-700 focus:ring-2 focus:ring-orange-200 px-3 py-2 rounded-lg outline-none transition",value:t,onChange:x=>o(x.target.value),children:[e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Credit/Debit Card"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"})]})]}),e.jsx("button",{className:"w-full bg-orange-500 text-white py-3 rounded-lg font-medium hover:bg-orange-800 transition disabled:opacity-60",onClick:()=>n({address_id:m?._id,card_id:u.map(x=>x._id),paymentMethod:c,shipping:r,discount:d,totalAmount:l}),disabled:i,children:i?"Processing...":`Confirm & Pay ₹${l.toFixed(2)}`})]})},R=({item:s})=>e.jsxs("div",{className:"flex items-center gap-4 border-b pb-4 last:border-none",children:[e.jsx("img",{src:s.product_id.images,alt:s.product_id.name,className:"w-20 h-20 object-contain rounded border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.product_id.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",s.quantity," | In stock: ",s.product_id.stock]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold text-orange-700",children:["₹",s.product_id.total_sell_price]}),e.jsxs("span",{className:"text-sm line-through text-gray-400",children:["₹",s.product_id.total_original_price]})]})]}),e.jsxs("div",{className:"font-semibold text-gray-700 mr-16",children:["₹",(s.product_id.total_sell_price*s.quantity).toFixed(2)]})]}),E=({totals:s,shipping:a=0,discount:n=0})=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Items"}),e.jsx("span",{children:s.total_quantity})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Original Price"}),e.jsxs("span",{children:["₹",s.total_original_price]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["₹",n.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",a.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium text-orange-700",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{children:["₹",(s.total_sell_price+a-n).toFixed(2)]})]})]}),Y=()=>{const s=P(),a=k(),n=new URLSearchParams(s.search),i=n.get("cart_id"),m=n.get("type"),{data:r,isLoading:d,refetch:c}=$({type:m||"through_cart",cart_id:i||""}),[u,h]=N.useState(1),[t,g]=N.useState(null),[o,l]=v.useState("upi"),{mutate:x,isPending:j}=D();if(d||!r)return e.jsx(y,{});const p=r.total_carts.total_sell_price,_=r.total_carts.total_original_price-p;return e.jsxs("div",{children:[e.jsx(q,{step:u,setStep:h}),u===1&&e.jsx(M,{selectedAddress:t,setSelectedAddress:g,onContinue:()=>h(2)}),u===2&&t&&e.jsx(z,{products:r.results,address:t,subtotal:p,shipping:50,discount:_,refetch:c,onContinue:()=>h(3)}),u===3&&t&&e.jsx(I,{productData:r,paymentMethod:o,setPaymentMethod:l,onConfirm:C=>{x(C,{onSuccess:b=>{f.success("Order placed successfully"),a(`/order-status?order_id=${b._id}`,{replace:!0})},onError:b=>{f.error(b?.message||"Failed to place order")}})},isPending:j,address:t})]})};export{Y as default};
