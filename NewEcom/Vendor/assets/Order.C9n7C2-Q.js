import{o as f,i as y,m as N,k as b,a as n,j as e,s as w}from"./index.1CbKXVec.js";import{u as v,P as S}from"./usePagination.DBnjr7Ov.js";import{L as C}from"./loader-circle.Cv--Wrlq.js";import{S as k,E as O,M as P}from"./search.CvSdDRNp.js";import{S as A}from"./settings.CDEwKIkE.js";import{H as _}from"./hash.CH7VhsAP.js";import{P as D}from"./package.D_1E8Z0J.js";import{U as E}from"./user.CWCoclIE.js";import{D as $}from"./dollar-sign.C9jOSMHM.js";import{C as z}from"./credit-card.BVGhIk5P.js";import{T as L}from"./truck.CDWDlwck.js";import{S as T}from"./shopping-bag.Cs4_8P5G.js";const F=async a=>(await b.get("/orders/details",{params:a})).data,R=async({orderId:a,orderStatus:r})=>(await b.patch(`/orders/${a}/status`,{orderStatus:r})).data,q=({pageSize:a=10,pageNumber:r=1,status:i})=>{const d=f(),x=y({queryKey:["orders",a,r,i],queryFn:()=>F({pageSize:a,pageNumber:r,status:i}),staleTime:1e3*60}),l=N({mutationFn:R,onSuccess:()=>{d.invalidateQueries({queryKey:["orders"]})}});return{...x,updateOrderStatus:l.mutateAsync}},j=[{label:"Pending",color:"bg-blue-100 text-blue-700 border-blue-300"},{label:"Processing",color:"bg-indigo-100 text-indigo-700 border-indigo-300"},{label:"Shipped",color:"bg-teal-100 text-teal-700 border-teal-300"},{label:"Out for Delivery",color:"bg-orange-100 text-orange-700 border-orange-300"},{label:"Delivered",color:"bg-green-100 text-green-700 border-green-300"},{label:"Placed",color:"bg-sky-100 text-sky-700 border-sky-300"},{label:"Cancelled",color:"bg-red-100 text-red-700 border-red-300"},{label:"Returned",color:"bg-pink-100 text-pink-700 border-pink-300"},{label:"Failed",color:"bg-gray-100 text-gray-700 border-gray-300"},{label:"Refunded",color:"bg-yellow-100 text-yellow-700 border-yellow-300"}],I=({orders:a,startItem:r,updateOrderStatus:i})=>{const[d,x]=n.useState(null),[l,c]=n.useState(null),[p,g]=n.useState(a);n.useEffect(()=>{g(a)},[a]);const o=async(s,m)=>{c(s);try{g(t=>t.map(h=>h._id===s?{...h,orderStatus:m}:h)),await i({orderId:s,orderStatus:m})}catch(t){console.error("Failed to update order status:",t),alert("Failed to update order status."),g(a)}finally{c(null)}};return p.length===0?e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-4 text-gray-500",children:"No Orders Found"})})}):e.jsx("tbody",{children:p.map((s,m)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"p-3 border text-center text-sm align-middle",children:m+r}),e.jsx("td",{className:"p-3 border font-mono text-xs sm:text-sm text-gray-800 break-words align-middle",children:s.transaction_id||"N/A"}),e.jsx("td",{className:"p-3 border text-sm align-middle",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"break-words",children:[e.jsx("strong",{children:"ID:"})," ",s.user._id]}),e.jsxs("div",{className:"break-words",children:[e.jsx("strong",{children:"Name:"})," ",s.user.username]}),e.jsxs("div",{className:"break-words",children:[e.jsx("strong",{children:"Email:"})," ",s.user.email]})]})}),e.jsxs("td",{className:"p-3 border font-semibold text-gray-900 align-middle text-center",children:["₹ ",s.totalAmount]}),e.jsx("td",{className:"p-3 border text-center align-middle",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.paymentStatus==="Paid"?"bg-green-100 text-green-700":s.paymentStatus==="Pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:s.paymentStatus})}),e.jsx("td",{className:"p-3 border text-center align-middle",children:e.jsxs("div",{className:"relative inline-flex items-center w-full max-w-[150px]",children:[e.jsx("select",{value:s.orderStatus,disabled:l===s._id,onChange:t=>o(s._id,t.target.value),className:`appearance-none w-full rounded-full pl-3 pr-8 py-1.5 text-xs font-semibold border shadow-sm cursor-pointer transition-all duration-200 focus:ring-2 focus:ring-indigo-400 focus:outline-none ${j.find(t=>t.label===s.orderStatus)?.color||"bg-gray-100 text-gray-700 border-gray-300"} ${l===s._id?"opacity-60 cursor-wait":""}`,children:j.map(t=>e.jsx("option",{value:t.label,children:t.label},t.label))}),e.jsx("span",{className:"material-symbols-outlined absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500 text-base",children:"arrow_drop_down"}),l===s._id&&e.jsx(C,{className:"w-4 h-4 text-gray-500 animate-spin absolute right-6 top-1/2 -translate-y-1/2"})]})}),e.jsxs("td",{className:"p-3 border text-xs sm:text-sm text-center align-middle",children:[e.jsx("button",{onClick:()=>x(d===s._id?null:s._id),className:"px-3 py-1 rounded-md bg-indigo-50 text-indigo-600 hover:bg-indigo-100 text-xs font-medium transition",children:d===s._id?"Hide Items":`View Items (${s.items.length})`}),d===s._id&&e.jsx("div",{className:"mt-3 flex flex-col gap-3",children:s.items.map(t=>e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50 flex flex-col items-center text-center",children:[t.productDetails.images.length>0&&e.jsx("img",{src:t.productDetails.images[0],alt:t.name,className:"w-20 h-20 object-cover rounded border mb-2"}),e.jsx("div",{className:"font-semibold text-gray-900 text-sm break-words",children:t.name}),e.jsxs("div",{className:"text-gray-600 text-xs mt-1",children:[t.quantity," pcs · ₹",t.size.sell_price," each"]}),e.jsxs("div",{className:"text-gray-500 text-xs break-words",children:["Color: ",t.color," | Size: ",t.size.sizeName]}),e.jsxs("div",{className:"text-gray-800 text-xs font-medium mt-1",children:["Total: ₹",t.total]})]},t._id))})]}),e.jsx("td",{className:"p-3 border text-xs sm:text-sm align-middle",children:e.jsxs("div",{className:"flex flex-col gap-1 text-gray-700 break-words",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Name:"})," ",s.shippingAddress?.name]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Address:"})," ",s.shippingAddress?.addressLine1,","," ",s.shippingAddress?.addressLine2]}),e.jsxs("span",{children:[e.jsx("strong",{children:"City:"})," ",s.shippingAddress?.city]}),e.jsxs("span",{children:[e.jsx("strong",{children:"State:"})," ",s.shippingAddress?.state]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Postal Code:"})," ",s.shippingAddress?.postalCode]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Country:"})," ",s.shippingAddress?.country]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Phone:"})," ",s.shippingAddress?.phone]})]})})]},s._id))})},Z=({status:a})=>{const{startItem:r,handlePageChange:i,handlePageSizeChange:d,pageNumber:x,pageSizeValue:l}=v(),{data:c,isLoading:p,updateOrderStatus:g}=q({pageSize:l,pageNumber:x,...a!=="All"&&{status:a}}),[o,s]=n.useState(!1),[m,t]=n.useState(""),h=n.useRef(null);return n.useEffect(()=>{o&&h.current?.focus()},[o]),p?e.jsx(w,{}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-md overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-gradient-to-r from-white to-gray-50",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:[a," Orders"]}),e.jsx("div",{className:"h-2 w-24 bg-gray-200 rounded-full mt-1 relative overflow-hidden",children:e.jsx("div",{className:`absolute left-0 top-0 h-full rounded-full transition-all duration-700 ${a==="Pending"?"bg-yellow-400 w-1/3":a==="Shipped"?"bg-blue-400 w-2/3":a==="Delivered"?"bg-green-500 w-full":a==="Cancelled"?"bg-red-500 w-2/5":a==="Refunded"?"bg-purple-500 w-3/5":"bg-gray-200 w-0"}`})})]}),e.jsxs("div",{className:"flex items-center gap-3 relative",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("button",{onClick:()=>s(u=>!u),className:"p-2 rounded-full hover:bg-gray-100 transition",children:o?e.jsx("span",{className:"text-gray-600 text-lg font-bold",children:"×"}):e.jsx(k,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:`absolute right-0 top-10 flex items-center bg-white border border-gray-300 rounded-full shadow-sm overflow-hidden transition-all duration-300 ease-in-out ${o?"w-64 px-3 opacity-100":"w-0 px-0 opacity-0"}`,children:e.jsx("input",{ref:h,type:"text",value:m,onChange:u=>t(u.target.value),placeholder:"Search orders...",className:`flex-1 py-1.5 text-sm outline-none bg-transparent transition-opacity duration-300 ${o?"opacity-100":"opacity-0"}`})})]}),e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100",children:e.jsx(A,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100",children:e.jsx(O,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm text-gray-700",children:[e.jsx("thead",{className:"bg-orange-100 text-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-center font-semibold min-w-[70px]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(_,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"S.No"})]})}),e.jsx("th",{className:"p-3 text-center font-semibold min-w-[120px]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"Order ID"})]})}),e.jsx("th",{className:"p-3 text-center font-semibold min-w-[140px]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(E,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"User"})]})}),e.jsx("th",{className:"p-3 text-center font-semibold min-w-[150px]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx($,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"Total Amount"})]})}),e.jsx("th",{className:"p-3 text-center font-semibold min-w-[150px]",children:e.jsxs("div",{className:"flex items-center justify-start",children:[e.jsx(z,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"Payment Status"})]})}),e.jsx("th",{className:"p-3 text-center font-semibold min-w-[150px]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(L,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"Order Status"})]})}),e.jsx("th",{className:"p-3 text-center font-semibold min-w-[110px]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(T,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"Items"})]})}),e.jsx("th",{className:"p-3 text-center font-semibold min-w-[180px]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(P,{className:"w-4 h-4 text-gray-700 mr-1"}),e.jsx("span",{children:"Shipping Address"})]})})]})}),e.jsx(I,{orders:c?.results||[],startItem:r,updateOrderStatus:g})]})})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("span",{className:"text-gray-600 text-sm",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:c?.results?.length||0})," of"," ",e.jsx("span",{className:"font-medium",children:c?.pagination?.total||0})," orders"]}),e.jsx(S,{currentPage:x,handlePageChange:i,pageSize:l,handlePageSizeChange:d,totalCount:c?.pagination?.total||0})]})]})};export{Z as default};
