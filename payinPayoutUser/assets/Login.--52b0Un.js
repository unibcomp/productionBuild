import{n as v,o as N,C as L,A as k,r as d,a as F,p as P,D as E,j as e,m,P as S,F as C,V as u,G as q}from"./index.CxIyUJQN.js";import{g as A,a as _,b as T}from"./user.BiIEwEb1.js";const H=n=>N.post("/login",n).then(s=>s.data),V=()=>v({mutationFn:H,mutationKey:["login"]}),D=()=>{const n=L(),s=k(),[g,r]=d.useState(!1),[l,y]=d.useState(!1),{register:x,handleSubmit:f,formState:{errors:i}}=F(),{login:b}=P(),{mutateAsync:j,isPending:p}=V(),w=async c=>{var h;try{r(!0);const[o,a]=await Promise.all([A(),_()]);if(!o||!a)return r(!1),u.error("Failed to get location.");r(!1);const t=await j({...c,device_id:T(),latitude:o,longitude:a});return b(t),q(t.token),u.success(t.message),s("/")}catch(o){const a=o,t=(h=a.response)==null?void 0:h.data;u.error((t==null?void 0:t.message)||(a==null?void 0:a.message)||(t==null?void 0:t.error)||"Login failed.")}};return d.useEffect(()=>{const c=E();s(c?"/":"/login")},[n.pathname]),e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"min-h-screen flex items-center justify-center bg-gradient-to-r from-[#101F33] to-[#0D2B2F] px-4",children:e.jsxs(m.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2},className:"relative w-full max-w-md bg-[#1a2c33] text-white border border-[#2a3e4c] shadow-2xl rounded-xl overflow-hidden",children:[e.jsx(S,{title:"Login to Your Account",searchComponent:e.jsx(e.Fragment,{})}),e.jsxs("div",{className:"p-8 space-y-5",children:[e.jsxs("form",{onSubmit:f(w),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-3 top-3 text-gray-500 text-lg",children:"mail"}),e.jsx("input",{type:"email",placeholder:"Enter your Email",...x("email",{required:"Email is required"}),className:"pl-10 pr-4 py-3 w-full rounded-md bg-white text-gray-900 placeholder-gray-400 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none transition"})]}),i.email&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-3 top-3 text-gray-500 text-lg",children:"lock"}),e.jsx("input",{type:l?"text":"password",placeholder:"Enter your password",...x("password",{required:"Password is required"}),className:"pl-10 pr-12 py-3 w-full rounded-md bg-white text-gray-900 placeholder-gray-400 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none transition"}),e.jsx("span",{onClick:()=>y(!l),className:"material-symbols-outlined absolute right-3 top-3 text-gray-500 text-lg cursor-pointer",children:l?"visibility_off":"visibility"})]}),i.password&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.password.message})]}),e.jsx("div",{className:"text-left text-sm",children:e.jsx("button",{onClick:()=>s("/forgot-password"),type:"button",className:"text-cyan-400 hover:underline transition",children:"Forgot Password?"})}),e.jsx(m.button,{type:"submit",whileHover:{scale:1.03},whileTap:{scale:.97},disabled:g||p,className:"w-full py-3 bg-[#185e91] hover:bg-[#144e7a] text-white font-semibold rounded-md transition",children:g?"Fetching Your Location":p?"Logging in...":"Login"})]}),e.jsx("div",{className:"text-right text-sm pt-2",children:e.jsx("button",{onClick:()=>s("/register"),className:"text-gray-300 hover:text-cyan-400 font-medium transition",children:"Donâ€™t have an account?"})})]}),e.jsx(C,{})]})})};export{D as default};
