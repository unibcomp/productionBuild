import{n as R,o as T,p as O,a as _,j as e,V as U,r as N,q as L,s as X,t as ee,E as te,v as se,w as re,m as $,P as ae,L as ne,N as ie}from"./index.CQ1mGLNM.js";const oe=()=>R({mutationFn:async n=>(await T.post("/kyc/personal",n)).data}),le=({setKycPage:n})=>{const{mutate:s,isPending:f}=oe(),{user:l,refetch:h}=O(),{register:u,handleSubmit:o,formState:{errors:i},reset:m}=_({defaultValues:{address:l==null?void 0:l.address,dateOfBirth:(l==null?void 0:l.dateOfBirth)&&(l==null?void 0:l.dateOfBirth.split("T")[0]),firstName:l==null?void 0:l.firstName,lastName:l==null?void 0:l.lastName,pincode:l==null?void 0:l.pincode}}),p=g=>{s(g,{onSuccess:y=>{U.success(y.message),n(y.kycPage),h(),m()},onError:y=>{var t,c;const d=(t=y.response)==null?void 0:t.data,r=Array.isArray(d==null?void 0:d.error)?(c=d==null?void 0:d.error)==null?void 0:c.join(","):d!=null&&d.message?d.message:(d==null?void 0:d.error)||"Something went wrong";U.error(r)}})};return e.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Personal Information"}),!["PENDING","REJECTED"].includes(l==null?void 0:l.personalInformationStatus)&&e.jsxs("button",{onClick:()=>n("aadhar"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:o(p),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"First Name"}),e.jsx("input",{type:"text",...u("firstName",{required:"First name is required"}),className:`w-full px-4 py-2 rounded-xl border ${i.firstName?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),i.firstName&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.firstName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",...u("lastName",{required:"Last name is required"}),className:`w-full px-4 py-2 rounded-xl border ${i.lastName?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),i.lastName&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.lastName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",...u("dateOfBirth",{required:"Date of birth is required"}),className:`w-full px-4 py-2 rounded-xl border ${i.dateOfBirth?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),i.dateOfBirth&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.dateOfBirth.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",...u("address",{required:"Address is required"}),className:`w-full px-4 py-2 rounded-xl border ${i.address?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),i.address&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.address.message})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Pincode"}),e.jsx("input",{type:"text",...u("pincode",{required:"Pincode is required"}),className:`w-full px-4 py-2 rounded-xl border ${i.pincode?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),i.pincode&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.pincode.message})]})]}),e.jsx("button",{type:"submit",disabled:f,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-50",children:f?"Saving...":"Continue"})]})]})})},ce=()=>R({mutationFn:async n=>(await T.post("/kyc/aadhar/init",n)).data}),de=()=>R({mutationFn:async n=>(await T.post("/kyc/aadhar/otpVerify",n)).data}),ue=({setKycPage:n})=>{const{user:s,refetch:f}=O(),{register:l,handleSubmit:h,setValue:u,getValues:o,reset:i,formState:{errors:m}}=_({defaultValues:{aadharNumber:s==null?void 0:s.aadharNumber}});N.useEffect(()=>{s&&i(s)},[s,i]);const[p,g]=N.useState(!1),[y,x]=N.useState(""),[d,r]=N.useState(!1),[t,c]=N.useState(null),[a,v]=N.useState(!1),b=ce(),j=de(),E=async w=>{try{g(!0);const I=await L(w);u("aadharImageUrl",I,{shouldValidate:!0}),x(I),U.success("Image uploaded successfully")}catch{U.error("Image upload failed")}finally{g(!1)}},k=async()=>{const w=o();if(!w.aadharNumber&&!(s!=null&&s.aadharNumber)||!w.aadharImageUrl&&!(s!=null&&s.aadharImageUrl))return U.error("Please provide Aadhaar number and image.");v(!1),b.mutate({aadharNumber:w.aadharNumber||s&&s.aadharNumber,aadharImageUrl:w.aadharImageUrl||s&&s.aadharImageUrl},{onSuccess:I=>{c(I.data.ref_id),r(!0),f(),setTimeout(()=>{v(!0)},1e4),U.success("OTP sent successfully")},onError:I=>{var M,A;U.error(((A=(M=I==null?void 0:I.response)==null?void 0:M.data)==null?void 0:A.error)||"Failed to send OTP")}})},S=w=>{const{otp:I}=w;if(console.log(t,I),!t||!I)return U.error("Missing OTP or Aadhaar session data");j.mutate({ref_id:t,otp:I},{onSuccess:M=>{U.success("Aadhaar verified successfully!"),f(),n(M.kycPage)},onError:M=>{var A,B;U.error(((B=(A=M==null?void 0:M.response)==null?void 0:A.data)==null?void 0:B.error)||"OTP verification failed")}})};return e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Aadhaar Information"}),e.jsxs("button",{onClick:()=>n("personalInformation"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.aadharStatus)&&e.jsxs("button",{onClick:()=>n("pan"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:h(S),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Aadhaar Number"}),e.jsx("input",{type:"text",defaultValue:(s==null?void 0:s.aadharNumber)??"",maxLength:12,...l("aadharNumber",{required:"Aadhar number is required",pattern:{value:/^[0-9]{12}$/,message:"Aadhar number must be 12 digits"}}),onInput:w=>{const I=w.currentTarget;I.value=I.value.replace(/[^0-9]/g,"").slice(0,12)},className:`w-full px-4 py-2 rounded-xl border ${m.aadharNumber?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),m.aadharNumber&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.aadharNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Aadhaar Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:w=>{var M;const I=(M=w.target.files)==null?void 0:M[0];if(I){if(I.size>2097152){alert("File size should not exceed 2 MB"),w.target.value="";return}E(I)}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl cursor-pointer"}),p&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Uploading..."}),(y||(s==null?void 0:s.aadharImageUrl))&&/\.(jpe?g|png|webp|gif|bmp)$/i.test(y||(s==null?void 0:s.aadharImageUrl))&&e.jsx("img",{src:y||(s==null?void 0:s.aadharImageUrl)||"",alt:"Aadhaar Preview",className:"mt-3 h-32 object-contain rounded-md border"}),m.aadharImageUrl&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.aadharImageUrl.message})]})]}),e.jsx("input",{type:"hidden",defaultValue:(s==null?void 0:s.aadharImageUrl)??"",...l("aadharImageUrl",{required:"Aadhar image is required"})}),d&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Enter OTP"}),e.jsx("input",{type:"number",...l("otp",{required:"OTP is required"}),className:`w-full px-4 py-2 rounded-xl border ${m.otp?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),m.otp&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.otp.message}),e.jsxs("button",{type:"button",onClick:k,disabled:!a,className:`mt-3 text-sm font-semibold underline transition ${a?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,children:["Resend OTP ",!a&&"(Wait 10s)"]})]}),e.jsx("button",{type:d?"submit":"button",onClick:d?void 0:k,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-60 cursor-pointer",children:p||b.isPending||j.isPending?"Processing...":d?"Continue":"Send OTP"})]})]})})},me=()=>R({mutationFn:async n=>{const{data:s}=await T.post("/kyc/pan/init",n);return s}}),pe=({setKycPage:n})=>{const{user:s,refetch:f}=O(),{register:l,handleSubmit:h,setValue:u,formState:{errors:o}}=_(),[i,m]=N.useState(!1),[p,g]=N.useState(""),y=me();N.useEffect(()=>{s!=null&&s.panNumber&&u("pan",s.panNumber),(s!=null&&s.firstName||s!=null&&s.lastName)&&u("name",`${s.firstName??""} ${s.lastName??""}`.trim()),s!=null&&s.panImageUrl&&(u("panImageUrl",s.panImageUrl),g(s.panImageUrl))},[s,u]);const x=async r=>{try{m(!0);const t=await L(r);u("panImageUrl",t,{shouldValidate:!0}),g(t),U.success("PAN Image uploaded successfully")}catch(t){U.error("Failed to upload image"),console.error(t)}finally{m(!1)}},d=r=>{y.mutate({pan:r.pan,name:r.name,panImageUrl:r.panImageUrl},{onSuccess:t=>{n("businessInformation"),f(),U.success(t.message||"PAN verified successfully")},onError:t=>{var c,a;U.error(((a=(c=t==null?void 0:t.response)==null?void 0:c.data)==null?void 0:a.error)||"PAN verification failed")}})};return e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 mt-6 relative",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"PAN Verification"}),e.jsxs("button",{onClick:()=>n("aadhar"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.panStatus)&&e.jsxs("button",{onClick:()=>n("businessInformation"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:h(d),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PAN Number"}),e.jsx("input",{type:"text",maxLength:10,...l("pan",{required:"PAN number is required",pattern:{value:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Invalid PAN format"},maxLength:{value:10,message:"PAN must be 10 characters"}}),onInput:r=>{const t=r.currentTarget;t.value=t.value.toUpperCase()},className:`w-full px-4 py-2 rounded-xl border ${o.pan?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),o.pan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.pan.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Name on PAN"}),e.jsx("input",{type:"text",...l("name",{required:"Name is required"}),className:`w-full px-4 py-2 rounded-xl border ${o.name?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),o.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.name.message})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PAN Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:r=>{var c;const t=(c=r.target.files)==null?void 0:c[0];if(t){if(t.size>2097152){alert("File size should not exceed 2 MB"),r.target.value="";return}x(t)}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl cursor-pointer"}),i&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Uploading..."}),(p||(s==null?void 0:s.panImageUrl))&&/\.(jpe?g|png|webp|gif|bmp)$/i.test(p||(s==null?void 0:s.panImageUrl))&&e.jsx("img",{src:p||(s==null?void 0:s.panImageUrl)||"",alt:"PAN Preview",className:"mt-3 h-32 object-contain rounded-md border"}),o.panImageUrl&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.panImageUrl.message})]})]}),e.jsx("button",{type:"submit",disabled:i||y.isPending,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-60",children:i||y.isPending?"Processing...":"Continue"})]})]})})},xe=()=>R({mutationFn:async n=>(await T.post("/kyc/business",n)).data}),he=({setKycPage:n})=>{const{user:s,refetch:f}=O(),{register:l,handleSubmit:h,setValue:u,watch:o,formState:{errors:i}}=_({defaultValues:{companyType:s.companyType,phoneNumber:s.phoneNumber,url:s.url,gstNumber:s.gstNumber,companyPan:s.companyPan,msmeNumber:s.msmeNumber,tan:s.tan,cin:s.tan,moa:s.moa,aoa:s.aoa}}),m=o("method"),p=o("companyType"),[g,y]=N.useState(""),x=xe(),d=async(t,c)=>{try{y(c);const a=await L(t);u(c,a,{shouldValidate:!0})}catch(a){console.error(`Upload failed for ${c}`,a),U.error("Upload failed")}finally{y("")}},r=t=>{delete t.method;const c=Object.fromEntries(Object.entries(t).filter(([,a])=>a!=null&&!(typeof a=="string"&&a.trim()==="")));x.mutate(c,{onSuccess:a=>{U.success(a.message||"Business KYC submitted successfully"),f(),n(a.kycPage)},onError:a=>{var v,b;U.error(((b=(v=a==null?void 0:a.response)==null?void 0:v.data)==null?void 0:b.error)||"Submission failed")}})};return e.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsxs("button",{onClick:()=>n("pan"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.businessStatus)&&e.jsxs("button",{onClick:()=>n("bank"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Business KYC"}),e.jsxs("form",{onSubmit:h(r),children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Choose Company Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{...l("companyType",{required:"Please select a method"}),className:"w-full appearance-none bg-white px-4 py-3 pr-10 rounded-xl border border-gray-300 shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"",children:"-- Select Company Type --"}),e.jsx("option",{value:"Proprietor",children:"Proprietor"}),e.jsx("option",{value:"opc",children:"OPC"}),e.jsx("option",{value:"private limited",children:"Private Limited"}),e.jsx("option",{value:"llp",children:"LLP"}),e.jsx("option",{value:"partnership",children:"Partnership"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M7 7l3-3 3 3m0 6l-3 3-3-3",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})})})]}),i.companyType&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.companyType.message})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Phone Number"}),e.jsx("input",{type:"text",...l("phoneNumber",{required:"Phone number is required",pattern:{value:/^[6-9][0-9]{9}$/,message:"Phone number must be 10 digits starting with 6-9"}}),className:`w-full px-4 py-2 rounded-xl border ${i.phoneNumber?"border-red-500":"border-gray-300"}`}),i.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:i.phoneNumber.message})]}),!["Proprietor","opc","partnership"].includes(p)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"CIN"}),e.jsx("input",{type:"text",...l("cin",{required:"CIN is required",pattern:{value:/^[A-Z0-9]{21}$/,message:"Invalid CIN format"}}),className:`w-full px-4 py-2 rounded-xl border ${i.cin?"border-red-500":"border-gray-300"}`}),i.cin&&e.jsx("p",{className:"text-sm text-red-500",children:i.cin.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Choose Verification Method"}),e.jsxs("select",{...l("method",{required:"Please select a method"}),className:"w-full px-4 py-2 rounded-xl border border-gray-300",children:[e.jsx("option",{value:"",children:"-- Select Verification method"}),e.jsx("option",{value:"gst",children:"GST Number"}),p!=="Proprietor"&&e.jsxs("option",{value:"pan",children:[" ",p==="partnership"?"Firm":"Company"," PAN"]}),p==="Proprietor"&&e.jsx("option",{value:"msme",children:"Msme Number"})]}),i.method&&e.jsx("p",{className:"text-red-500 text-sm",children:i.method.message})]}),m==="gst"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"GST Number"}),e.jsx("input",{type:"text",...l("gstNumber",{required:"GST Number is required when using GST method"}),className:`w-full px-4 py-2 rounded-xl border ${i.gstNumber?"border-red-500":"border-gray-300"}`}),i.gstNumber&&e.jsx("p",{className:"text-red-500 text-sm",children:i.gstNumber.message})]}),m==="pan"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-1",children:[" ",p==="partnership"?"Firm":"Company"," PAN"]}),e.jsx("input",{type:"text",...l("companyPan",{required:"Company PAN is required when using PAN method",pattern:{value:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Invalid PAN format"}}),className:`w-full px-4 py-2 rounded-xl border ${i.companyPan?"border-red-500":"border-gray-300"}`}),i.companyPan&&e.jsx("p",{className:"text-red-500 text-sm",children:i.companyPan.message})]}),(p==="Proprietor"?m==="msme":!0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"MSME Number"}),e.jsx("input",{type:"text",...l("msmeNumber"),className:"w-full px-4 py-2 rounded-xl border border-gray-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Website / URL"}),e.jsx("input",{type:"url",...l("url"),className:`w-full px-4 py-2 rounded-xl border ${i.url?"border-red-500":"border-gray-300"}`}),i.url&&e.jsx("p",{className:"text-sm text-red-500",children:i.url.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"TAN"}),e.jsx("input",{type:"text",...l("tan"),className:"w-full px-4 py-2 rounded-xl border border-gray-300"})]}),X.map(({label:t,name:c,required:a})=>(ee[p]||[]).includes(t)?e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-1",children:[t," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",onChange:b=>{var E;const j=(E=b.target.files)==null?void 0:E[0];j&&d(j,c)},className:"w-full px-3 py-2 border border-gray-300 rounded-xl cursor-pointer"}),g===c&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Uploading..."})]},c):null)]})}),e.jsx("button",{type:"submit",disabled:!!g||x.isPending,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-60",children:g||x.isPending?"Processing...":"Continue"})]})]})})},fe=n=>T.post("/kyc/bank",n).then(s=>s.data),be=n=>T.post("/kyc/video",n).then(s=>s.data),ge=n=>T.post("/kyc/photo",n).then(s=>s.data),K=()=>{const n=R({mutationFn:fe}),s=R({mutationFn:ge}),f=R({mutationFn:be});return{updateBankMutation:n,updateVideoMutation:f,updateImageMutation:s}},ye=({fullName:n,resellerName:s,businessName:f})=>{const l=N.useRef(null),h=N.useRef(null),[u,o]=N.useState(!1),[i,m]=N.useState(!1),p=new Date,g=p.toLocaleDateString("en-GB"),y=p.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}),x=[{id:1,title:"1. Declaration Acknowledgement",text:`â€œI have carefully read and understood the KYC Declaration Form provided by ${s}. I accept all terms, and I am voluntarily recording this video as proof of my consent.â€`},{id:2,title:"2. Introduction",text:`â€œHello, my name is ${n}. I am recording this video to complete the KYC verification process for Payin and Payout services with ${s}.â€`},{id:3,title:"3. Date and Time Confirmation",text:`â€œTodayâ€™s date is ${g}, and the current time is approximately ${y} IST.â€`},{id:4,title:"4. Identity Proof Display",text:"â€œI am now showing my government-issued ID: [PAN Card / Aadhaar Card / Passport], issued by [Issuing Authority].â€"},{id:5,title:"5. Address Proof Display (If Required)",text:"â€œThis document is my [Utility Bill / Bank Statement / Rent Agreement], dated [MM/YYYY], which shows my current address.â€"},{id:6,title:"6. Facial Verification",text:"â€œYou can clearly see my face. I will now move my head left and right, and smile to confirm liveness.â€"},{id:7,title:"7. Declaration of Accuracy",text:"â€œI confirm that all the documents shown belong to me and the information provided is accurate to the best of my knowledge.â€"},{id:8,title:"8. Purpose of KYC",text:"â€œThis video is submitted solely for the purpose of verifying my identity for using Payin and Payout services.â€"},{id:9,title:"9. Business Account Confirmation",text:`â€œThe bank account provided is registered under the name of ${f}, and is used for official business transactions.â€`,condition:!!f},{id:10,title:"10. Signature Confirmation (Optional)",text:"â€œI will now sign for additional verification purposes.â€"},{id:11,title:"11. Final Consent and Authorization",text:`â€œThank you for reviewing my KYC video. I authorize ${s} to verify my documents and use this information for KYC validation of Payin and Payout services. I am available for any additional verification if needed.â€`}];return{contentRef:l,scrollRef:h,checkboxVisible:u,accepted:i,setAccepted:m,handleScroll:()=>{const t=h.current;if(!t)return;t.scrollHeight-t.scrollTop<=t.clientHeight+10&&o(!0)},generatePDF:()=>{const t=new te;let c=t.internal.pageSize.getWidth(),a=20;const v=20,b=c-v*2,j=16,E=13,k=11,S=6;t.setFillColor(230,240,255),t.rect(0,0,c,t.internal.pageSize.getHeight(),"F"),t.setFontSize(j),t.setTextColor(40,40,90),t.setFont("helvetica","bold");const w="KYC Video Declaration",I=t.getStringUnitWidth(w)*j/t.internal.scaleFactor,M=(c-I)/2;t.text(w,M,a),a+=10,x.filter(V=>V.condition!==!1).forEach(({title:V,text:G})=>{a>260&&(t.addPage(),a=20),t.setFillColor(255,255,255),t.setDrawColor(200,200,200),t.roundedRect(v,a,b,30,3,3,"FD"),t.setFontSize(E),t.setTextColor(0,0,100),t.setFont("helvetica","bold"),t.text(V,v+5,a+8),t.setFontSize(k),t.setTextColor(50,50,50),t.setFont("helvetica","normal");const P=t.splitTextToSize(G,b-10);t.text(P,v+5,a+15),a+=P.length*S+15});const A=t.output("blob");return new File([A],`kyc_declaration_${Date.now()}.pdf`,{type:"application/pdf"})},dateStr:g,timeStr:y,declarations:x}},ve=({setKycPage:n})=>{const{user:s,refetch:f}=O(),{register:l,handleSubmit:h,formState:{errors:u}}=_({defaultValues:{bankName:s.bankName,accountNumber:s.accountNumber,ifscCode:s.ifscCode}}),{updateBankMutation:o}=K(),i=m=>{o.mutate(m)};return N.useEffect(()=>{var y,x;const m=o.isError,p=o.isSuccess,g=(y=o.data)==null?void 0:y.kycPage;if(p&&(f(),U.success("Bank details submitted succesfully"),g&&n(g),f()),m){const d=(x=o.error.response)==null?void 0:x.data;U.success((d==null?void 0:d.message)||(d==null?void 0:d.error))}},[o.isError,o.isSuccess]),e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Bank KYC Information"}),e.jsxs("button",{onClick:()=>n("businessInformation"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.bankStatus)&&e.jsxs("button",{onClick:()=>n("photo"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:h(i),className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{type:"text",...l("bankName",{required:"Bank name is required"}),className:`w-full px-4 py-2 rounded-xl border ${u.bankName?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),u.bankName&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.bankName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{type:"text",...l("accountNumber",{required:"Account number is required"}),className:`w-full px-4 py-2 rounded-xl border ${u.accountNumber?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),u.accountNumber&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.accountNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"IFSC Code"}),e.jsx("input",{type:"text",...l("ifscCode",{required:"IFSC code is required",pattern:{value:/^[A-Z]{4}0[A-Z0-9]{6}$/i,message:"Invalid IFSC code format"}}),className:`w-full px-4 py-2 rounded-xl border ${u.ifscCode?"border-red-500":"border-gray-300"} uppercase focus:outline-none focus:ring-2 focus:ring-blue-500`}),u.ifscCode&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.ifscCode.message})]}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx("button",{type:"submit",disabled:o.isPending,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all",children:o.isPending?"Processing":"Continue"})})]})]})})};var Y={exports:{}},Ne=Y.exports,J;function je(){return J||(J=1,function(n,s){(function(l,h){n.exports=h(se())})(Ne,function(f){return function(l){var h={};function u(o){if(h[o])return h[o].exports;var i=h[o]={i:o,l:!1,exports:{}};return l[o].call(i.exports,i,i.exports,u),i.l=!0,i.exports}return u.m=l,u.c=h,u.d=function(o,i,m){u.o(o,i)||Object.defineProperty(o,i,{enumerable:!0,get:m})},u.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},u.t=function(o,i){if(i&1&&(o=u(o)),i&8||i&4&&typeof o=="object"&&o&&o.__esModule)return o;var m=Object.create(null);if(u.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:o}),i&2&&typeof o!="string")for(var p in o)u.d(m,p,(function(g){return o[g]}).bind(null,p));return m},u.n=function(o){var i=o&&o.__esModule?function(){return o.default}:function(){return o};return u.d(i,"a",i),i},u.o=function(o,i){return Object.prototype.hasOwnProperty.call(o,i)},u.p="",u(u.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(l,h,u){u.r(h);var o=u("react"),i=function(){var x=function(d,r){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,c){t.__proto__=c}||function(t,c){for(var a in c)c.hasOwnProperty(a)&&(t[a]=c[a])},x(d,r)};return function(d,r){x(d,r);function t(){this.constructor=d}d.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),m=function(){return m=Object.assign||function(x){for(var d,r=1,t=arguments.length;r<t;r++){d=arguments[r];for(var c in d)Object.prototype.hasOwnProperty.call(d,c)&&(x[c]=d[c])}return x},m.apply(this,arguments)},p=function(x,d){var r={};for(var t in x)Object.prototype.hasOwnProperty.call(x,t)&&d.indexOf(t)<0&&(r[t]=x[t]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,t=Object.getOwnPropertySymbols(x);c<t.length;c++)d.indexOf(t[c])<0&&Object.prototype.propertyIsEnumerable.call(x,t[c])&&(r[t[c]]=x[t[c]]);return r};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(d){var r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return r?new Promise(function(t,c){r.call(navigator,d,t,c)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function g(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var y=function(x){i(d,x);function d(r){var t=x.call(this,r)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return d.prototype.componentDidMount=function(){var r=this,t=r.state,c=r.props;if(this.unmounted=!1,!g()){c.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),c.children&&typeof c.children!="function"&&console.warn("children must be a function")},d.prototype.componentDidUpdate=function(r){var t=this.props;if(!g()){t.onUserMediaError("getUserMedia not supported");return}var c=JSON.stringify(r.audioConstraints)!==JSON.stringify(t.audioConstraints),a=JSON.stringify(r.videoConstraints)!==JSON.stringify(t.videoConstraints),v=r.minScreenshotWidth!==t.minScreenshotWidth,b=r.minScreenshotHeight!==t.minScreenshotHeight;(a||v||b)&&(this.canvas=null,this.ctx=null),(c||a)&&(this.stopAndCleanup(),this.requestUserMedia())},d.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},d.stopMediaStream=function(r){r&&(r.getVideoTracks&&r.getAudioTracks?(r.getVideoTracks().map(function(t){r.removeTrack(t),t.stop()}),r.getAudioTracks().map(function(t){r.removeTrack(t),t.stop()})):r.stop())},d.prototype.stopAndCleanup=function(){var r=this.state;r.hasUserMedia&&(d.stopMediaStream(this.stream),r.src&&window.URL.revokeObjectURL(r.src))},d.prototype.getScreenshot=function(r){var t=this,c=t.state,a=t.props;if(!c.hasUserMedia)return null;var v=this.getCanvas(r);return v&&v.toDataURL(a.screenshotFormat,a.screenshotQuality)},d.prototype.getCanvas=function(r){var t=this,c=t.state,a=t.props;if(!this.video||!c.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var v=this.video.videoWidth,b=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var j=v/b;v=a.minScreenshotWidth||this.video.clientWidth,b=v/j,a.minScreenshotHeight&&b<a.minScreenshotHeight&&(b=a.minScreenshotHeight,v=b*j)}this.canvas=document.createElement("canvas"),this.canvas.width=(r==null?void 0:r.width)||v,this.canvas.height=(r==null?void 0:r.height)||b,this.ctx=this.canvas.getContext("2d")}var E=this,k=E.ctx,S=E.canvas;return k&&S&&(S.width=(r==null?void 0:r.width)||S.width,S.height=(r==null?void 0:r.height)||S.height,a.mirrored&&(k.translate(S.width,0),k.scale(-1,1)),k.imageSmoothingEnabled=a.imageSmoothing,k.drawImage(this.video,0,0,(r==null?void 0:r.width)||S.width,(r==null?void 0:r.height)||S.height),a.mirrored&&(k.scale(-1,1),k.translate(-S.width,0))),S},d.prototype.requestUserMedia=function(){var r=this,t=this.props,c=function(b,j){var E={video:typeof j<"u"?j:!0};t.audio&&(E.audio=typeof b<"u"?b:!0),r.requestUserMediaId++;var k=r.requestUserMediaId;navigator.mediaDevices.getUserMedia(E).then(function(S){r.unmounted||k!==r.requestUserMediaId?d.stopMediaStream(S):r.handleUserMedia(null,S)}).catch(function(S){r.handleUserMedia(S)})};if("mediaDevices"in navigator)c(t.audioConstraints,t.videoConstraints);else{var a=function(b){return{optional:[{sourceId:b}]}},v=function(b){var j=b.deviceId;return typeof j=="string"?j:Array.isArray(j)&&j.length>0?j[0]:typeof j=="object"&&j.ideal?j.ideal:null};MediaStreamTrack.getSources(function(b){var j=null,E=null;b.forEach(function(w){w.kind==="audio"?j=w.id:w.kind==="video"&&(E=w.id)});var k=v(t.audioConstraints);k&&(j=k);var S=v(t.videoConstraints);S&&(E=S),c(a(j),a(E))})}},d.prototype.handleUserMedia=function(r,t){var c=this.props;if(r||!t){this.setState({hasUserMedia:!1}),c.onUserMediaError(r);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}c.onUserMedia(t)},d.prototype.render=function(){var r=this,t=this,c=t.state,a=t.props,v=a.audio;a.forceScreenshotSourceSize;var b=a.disablePictureInPicture;a.onUserMedia,a.onUserMediaError,a.screenshotFormat,a.screenshotQuality,a.minScreenshotWidth,a.minScreenshotHeight,a.audioConstraints,a.videoConstraints,a.imageSmoothing;var j=a.mirrored,E=a.style,k=E===void 0?{}:E,S=a.children,w=p(a,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),I=j?m(m({},k),{transform:(k.transform||"")+" scaleX(-1)"}):k,M={getScreenshot:this.getScreenshot.bind(this)};return o.createElement(o.Fragment,null,o.createElement("video",m({autoPlay:!0,disablePictureInPicture:b,src:c.src,muted:!v,playsInline:!0,ref:function(A){r.video=A},style:I},w)),S&&S(M))},d.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},d}(o.Component);h.default=y},react:function(l,h){l.exports=f}}).default})}(Y)),Y.exports}var we=je();const Se=re(we),Pe=({setKycPage:n})=>{const{register:s,handleSubmit:f,setValue:l}=_(),{user:h,refetch:u}=O(),[o,i]=N.useState(null),[m,p]=N.useState(!1),g=N.useRef(null),{updateImageMutation:y}=K(),x=()=>{var t;const r=(t=g.current)==null?void 0:t.getScreenshot();r&&(i(r),fetch(r).then(c=>c.blob()).then(c=>{const a=new File([c],"captured.png",{type:"image/png"}),v=new DataTransfer;v.items.add(a),l("imageFile",v.files)}),p(!1))},d=async r=>{var t,c;if((t=r.imageFile)!=null&&t[0]){const a=await L(r.imageFile[0]);a&&y.mutate({photoUrl:a})}console.log("Submitted Image:",(c=r.imageFile)==null?void 0:c[0])};return N.useEffect(()=>{var a,v;const r=y.isError,t=y.isSuccess,c=(a=y.data)==null?void 0:a.kycPage;if(t&&(U.success("Image submitted succesfully"),c&&(u(),n(c))),r){const b=(v=y.error.response)==null?void 0:v.data;U.success((b==null?void 0:b.message)||(b==null?void 0:b.error))}},[y.isError,y.isSuccess]),e.jsx($.div,{className:"w-full max-w-3xl mx-auto px-4 mt-6 relative",children:e.jsxs($.div,{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Upload Image"}),e.jsxs("button",{onClick:()=>n("bank"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(h==null?void 0:h.photoUrl)&&e.jsxs("button",{onClick:()=>n("video"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("h4",{className:"text-lg font-semibold",children:["Pick One Option ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("form",{onSubmit:f(d),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",...s("imageFile"),className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Webcam Option"}),e.jsxs("button",{type:"button",onClick:()=>p(!m),className:`w-full flex justify-center items-center gap-2 px-4 py-2 rounded-md text-white transition ${m?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:m?"stop_circle":"photo_camera"}),m?"Close Webcam":"Open Webcam"]})]})]}),m&&e.jsxs("div",{className:"rounded border p-4 shadow-md bg-gray-50 space-y-3 text-center",children:[e.jsx(Se,{ref:g,screenshotFormat:"image/png",className:"rounded-md w-full max-w-sm mx-auto"}),e.jsx("button",{type:"button",onClick:x,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded",children:"Capture"})]}),o&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Preview:"}),e.jsx("img",{src:o,alt:"Captured Preview",className:"w-40 h-auto mx-auto rounded border"})]}),e.jsx("button",{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700 text-white w-full py-2 rounded-md font-medium",disabled:y.isPending,children:y.isPending?"Processing":"Continue"})]})]})})},Ce=({contentRef:n,scrollRef:s,checkboxVisible:f,accepted:l,setAccepted:h,handleScroll:u,declarations:o})=>{const[i,m]=N.useState(!1);return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[!i&&e.jsx("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-md cursor-pointer",children:"View Declaration"}),i&&e.jsxs("div",{children:[e.jsx("div",{ref:s,onScroll:u,className:"max-h-[200px] overflow-y-auto border border-gray-300 p-4 rounded bg-white mt-6",children:e.jsxs("div",{ref:n,className:"text-sm leading-relaxed whitespace-pre-wrap",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4 border-b pb-2",children:"Video KYC for User Activation of Payin and Payout Services"}),o.filter(p=>p.condition!==!1).map(({id:p,title:g,text:y})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:g}),e.jsx("p",{className:"mt-1",children:y})]},p))]})}),e.jsx("div",{className:"mt-4",children:f&&e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:p=>{h(p.target.checked)}}),e.jsx("span",{children:"I accept the above declaration"})]})})]})]})},Ie=({setKycPage:n})=>{const{refetch:s,user:f}=O(),l=ye({fullName:` ${f==null?void 0:f.firstName} ${f==null?void 0:f.lastName}`,businessName:f==null?void 0:f.company_name,resellerName:"QUANTUMSPHERE INNOVATIONS (OPC) PRIVATE LIMITED"}),{handleSubmit:h,setValue:u,watch:o}=_(),i=o("videoFile"),[m,p]=N.useState({uploading:!1,error:"",success:""}),[g,y]=N.useState(20),[x,d]=N.useState(!1),[r,t]=N.useState(null),[c,a]=N.useState(0),v=N.useRef(null),b=N.useRef(null),j=N.useRef(null),E=N.useRef(null),k=N.useRef(null),S=N.useRef([]),{updateVideoMutation:w}=K(),I=P=>P.size>20*1024*1024?(p({uploading:!1,error:"File too large (>20MB).",success:""}),!1):!0,M=async()=>{const P=await navigator.mediaDevices.getUserMedia({audio:!0});j.current=P;const F=new AudioContext,C=F.createAnalyser();F.createMediaStreamSource(P).connect(C),E.current=F,k.current=C;const z=new Uint8Array(C.frequencyBinCount),Z=setInterval(()=>{C.getByteFrequencyData(z);const Q=Math.max(...z)/255;a(Q)},100);return()=>clearInterval(Z)},A=()=>{var P,F;(P=j.current)==null||P.getTracks().forEach(C=>C.stop()),(F=E.current)==null||F.close(),k.current=null},B=async()=>{d(!0),y(20),S.current=[];const P=await navigator.mediaDevices.getUserMedia({video:{width:320,height:240,frameRate:10},audio:!0});j.current=P,v.current&&(v.current.srcObject=P,v.current.play());const F={mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:2e5},C=new MediaRecorder(P,F);C.ondataavailable=D=>{D.data.size>0&&S.current.push(D.data)},C.onstop=()=>{const D=new Blob(S.current,{type:"video/webm"}),z=URL.createObjectURL(D);t(z),A()},b.current=C,C.start(),await M()},V=()=>{var P;(P=b.current)==null||P.stop(),d(!1)};N.useEffect(()=>{let P;return x&&g>0&&(P=setTimeout(()=>y(F=>F-1),1e3)),x&&g===0&&V(),()=>clearTimeout(P)},[x,g]);const G=async P=>{if(!P.videoFile){p({uploading:!1,error:"No video recorded.",success:""});return}const F=l.generatePDF();if(!F){p({uploading:!1,error:"No video recorded.",success:""});return}p({uploading:!0,error:"",success:""});const C=new FormData;C.append("videoFile",P.videoFile),C.append("kycDeclaration",F);try{w.mutate(C,{onSuccess:()=>{n("under_review"),s()}})}catch(D){console.error(D),p({uploading:!1,error:"Upload failed.",success:""})}};return N.useEffect(()=>{var P,F;if(w.isSuccess){U.success("Video uploaded successfully");const C=(P=w.data)==null?void 0:P.kycPage;C&&n(C)}if(w.isError){const C=(F=w.error.response)==null?void 0:F.data;U.error((C==null?void 0:C.message)||(C==null?void 0:C.error)||"Upload failed"),p({uploading:!1,error:"Upload failed.",success:""})}},[w.isError,w.isSuccess]),e.jsx($.div,{className:"w-full max-w-3xl mx-auto px-4 mt-6 relative",children:e.jsxs($.div,{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Video Verification"}),e.jsx("button",{onClick:()=>n("photo"),className:"absolute left-10 top-10 text-blue-600 hover:text-blue-800",children:"â† Back"}),e.jsx("p",{className:"text-sm text-yellow-800 bg-yellow-100 border-l-4 border-yellow-500 p-2 rounded",children:"ðŸ“Œ Please review the full declaration below and record a video clearly stating your acceptance to proceed with the KYC verification process."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[x&&e.jsxs("p",{children:["â± Time left: ",g,"s"]}),x&&e.jsx("div",{className:"h-3 w-28 bg-gray-200 rounded",children:e.jsx("div",{className:"h-3 bg-green-500 rounded",style:{width:`${c*100}%`}})})]}),e.jsxs("div",{className:"flex gap-4 justify-center flex-col items-center",children:[e.jsx("video",{ref:v,autoPlay:!0,muted:!0,playsInline:!0,className:"w-40 h-40 rounded-full object-cover border"}),e.jsx("button",{onClick:x?V:B,className:`px-4 py-2 cursor-pointer text-white rounded ${x?"bg-red-600":"bg-blue-600"}`,children:x?"Stop":"Record"}),r&&e.jsx("button",{onClick:()=>{u("videoFile",void 0),t(null),y(20)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Retry"})]}),r&&!x&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("video",{src:r,controls:!0,className:"w-full rounded"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:async()=>{const P=await fetch(r).then(C=>C.blob()),F=new File([P],"recorded.webm",{type:P.type});I(F)&&u("videoFile",F)},children:"Use This Recording"})]})]}),i&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Selected Video:"}),e.jsx("video",{src:URL.createObjectURL(i),controls:!0,className:"w-full rounded"})]}),e.jsxs("div",{className:"text-sm text-center mt-2 text-gray-600",children:[m.uploading&&e.jsx("p",{className:"text-blue-600",children:"Uploading video..."}),m.error&&e.jsx("p",{className:"text-red-600",children:m.error}),m.success&&e.jsx("p",{className:"text-green-600",children:m.success})]}),e.jsx(Ce,{...l}),e.jsx("form",{onSubmit:h(G),className:"text-center mt-4",children:e.jsx("button",{type:"submit",disabled:m.uploading||!l.accepted,className:`px-6 py-2 rounded font-medium text-white 
    ${m.uploading||!l.accepted?"bg-indigo-600 hover:bg-indigo-700 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,style:{opacity:1},children:m.uploading?"Uploading...":"Submit Video"})})]})})},q=["personalInformation","aadhar","pan","businessInformation","bank","photo","video","under_review","approved"],W={personalInformation:"Personal Info",aadhar:"Aadhaar",pan:"PAN",businessInformation:"Business",bank:"Bank",photo:"photo",video:"Video",under_review:"Under Review",approved:"Approved"},ke=({currentStep:n})=>{const s=q.indexOf(n==="done"?"approved":n);return e.jsxs("div",{className:"w-full px-4 py-6 text-gray-800",children:[e.jsxs("div",{className:"hidden md:flex relative items-center justify-between gap-4 min-w-[900px] sm:min-w-full",children:[e.jsx("div",{className:"absolute top-[13px] h-1 bg-gray-300 z-0",style:{left:"calc(50px + 0.75rem)",right:"calc(50px + 0.75rem)"},children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${s/(q.length-1)*100}%`}})}),q.map((f,l)=>{const h=n==="done"||l<s,u=l===s;return e.jsxs("div",{className:"flex flex-col items-center text-center z-10 min-w-[100px]",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold
                  ${h?"bg-blue-600 text-white":u?"bg-white border-2 border-blue-600 text-blue-600":"bg-gray-300 text-white"}
                `,children:h?"âœ“":l+1}),e.jsx("div",{className:"text-xs mt-2 px-1 whitespace-nowrap",children:W[f]})]},f)})]}),e.jsx("div",{className:"flex flex-col items-center gap-4 md:hidden mt-4",children:e.jsxs("div",{className:"flex justify-around w-full text-sm font-medium text-gray-800",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-green-600 text-[28px]",children:"radio_button_checked"}),e.jsx("span",{className:`text-xs ${s===0?"font-bold text-blue-600":""}`,children:W[q[s]]||"Current"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Current"})]}),q[s+1]&&e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-500 text-[28px]",children:"arrow_forward"}),e.jsx("span",{className:"text-xs",children:W[q[s+1]]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Next"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-purple-600 text-[28px]",children:"flag"}),e.jsx("span",{className:"text-xs",children:W.approved}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Final"})]})]})})]})},Ue={PENDING:"Your KYC is pending.",UNDER_REVIEW:"Your KYC is under review.",APPROVED:"Your KYC has been approved ðŸŽ‰",REJECTED:"Your KYC was rejected.",PROCESSING:"Your Kyc Has Been Approved. Service will be start after 15 minutes"},Ee={PENDING:"text-yellow-500",UNDER_REVIEW:"text-blue-500",APPROVED:"text-green-600",REJECTED:"text-red-600",PROCESSING:"text-green-600"},H=({status:n,onRetry:s,onBack:f,rejectedField:l})=>e.jsx($.div,{className:"max-w-xl mx-auto px-4 mt-10",children:e.jsxs("div",{className:"border border-gray-300 rounded-2xl shadow p-8 text-center space-y-6",children:[e.jsx("h2",{className:`text-2xl font-bold ${Ee[n]}`,children:Ue[n]}),n==="REJECTED"&&e.jsxs("div",{className:"bg-red-50 text-red-700 border border-red-200 rounded p-4",children:[e.jsx("strong",{children:"Reason:"}),e.jsx("p",{children:"Please review the details and fill out the form correctly."}),e.jsx("div",{className:"flex gap-4 justify-center",children:l&&l.map(h=>e.jsx("b",{children:h.split("S")[0]}))})]}),(n==="PENDING"||n==="UNDER_REVIEW")&&e.jsx("p",{className:"text-gray-600",children:"We are currently verifying your information. You will be notified once it's done."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[n==="REJECTED"&&s&&e.jsx("button",{onClick:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"Retry KYC"}),f&&e.jsx("button",{onClick:f,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded",children:"Back"})]})]})}),Fe=["personalInformation","aadhar","pan","businessInformation","bank","photo","video","under_review","approved"],Me={personalInformation:le,aadhar:ue,pan:pe,businessInformation:he,bank:ve,photo:Pe,video:Ie,under_review:()=>e.jsx("div",{}),approved:()=>e.jsx("div",{})},Re=()=>{var p;const{user:n,isLoading:s,isError:f}=O(),[l,h]=N.useState("personalInformation");N.useEffect(()=>{const g=n==null?void 0:n.kycPage;g&&Fe.includes(g)&&h(g)},[n==null?void 0:n.kycPage]);const u=Me[l],o=n==null?void 0:n.kycStatus,i=n&&Object.keys(n).filter(g=>n[g]==="REJECTED"&&g!="kycStatus"),m=o&&["UNDER_REVIEW","APPROVED","PROCESSING"].includes(o);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 to-indigo-100 text-gray-800 sm:p-6 p-2",children:[e.jsx(ae,{title:"KYC",searchComponent:e.jsx(e.Fragment,{})}),e.jsx(ke,{currentStep:l}),e.jsx("div",{className:"mt-4",children:s?e.jsx(ne,{}):f?e.jsx(ie,{}):e.jsx(e.Fragment,{children:m?e.jsx(H,{status:o,onRetry:()=>h(l),onBack:()=>h(l),reason:(p=n==null?void 0:n.data)==null?void 0:p.kycRejectionReason}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-6",children:u&&e.jsx(u,{setKycPage:h})}),o==="REJECTED"&&e.jsx(H,{status:o,onRetry:()=>h(l),onBack:()=>h(l),reason:n==null?void 0:n.remark,rejectedField:i})]})})})]})};export{Re as default};
