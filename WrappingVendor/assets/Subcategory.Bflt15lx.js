import{o as F,m as S,z as y,a as w,e as n,j as e,i as L,q as P}from"./index.CiDKljiW.js";import{u as q,a as z}from"./useCreateProduct.C7j_S_kq.js";import{u as T,P as I}from"./usePagination.C-C2FNTU.js";import{X as _}from"./x.D_PkhF9k.js";import{K as j}from"./transition.XzcnYbDF.js";import{h as v}from"./dialog.CF2BtVuw.js";import{m as N}from"./proxy.DZSzScmH.js";const D=()=>{const r=F();return S({mutationFn:async t=>{const i=new FormData;return i.append("name",t.name),i.append("category",t.category),i.append("image",t.image),(await w.post("/subcategory",i,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:()=>{y.success("Subcategory created successfully!"),r.invalidateQueries({queryKey:["sub-category"]})},onError:t=>{y.error(t?.response?.data?.error||t?.message||"Failed to create subcategory")}})},E=()=>S({mutationFn:async({id:r,isActive:t})=>(await w.put(`/update-subcategory/${r}`,{isActive:t})).data}),K=({isOpen:r,onClose:t,categories:i,isCategoriesLoading:l,onSubmit:p})=>{const[o,c]=n.useState(""),[d,x]=n.useState(""),[u,m]=n.useState(null),[h,g]=n.useState(!1);n.useEffect(()=>{r||(c(""),x(""),m(null),g(!1))},[r]);const f=async s=>{if(s.preventDefault(),!o||!d){alert("Please fill all required fields");return}g(!0),await p({name:o,category:d,image:u||void 0}),g(!1),t()};return e.jsx(j,{appear:!0,show:r,as:n.Fragment,children:e.jsxs(v,{as:"div",className:"relative z-50",onClose:t,children:[e.jsx(j.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(j.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(v.Panel,{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(v.Title,{className:"text-lg font-semibold",children:"Add New Subcategory"}),e.jsx("button",{type:"button",onClick:t,className:"rounded-full p-1 hover:bg-gray-100",children:e.jsx(_,{size:20})})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcategory Name"}),e.jsx("input",{type:"text",value:o,onChange:s=>c(s.target.value),placeholder:"Enter subcategory name",className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category"}),l?e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading categories..."}):e.jsxs("select",{value:d,onChange:s=>x(s.target.value),className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),i.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcategory Image (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>m(s.target.files?.[0]||null),className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500"}),u&&e.jsx("img",{src:URL.createObjectURL(u),alt:"Preview",className:"w-20 h-20 object-cover rounded-lg mt-2 border"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 rounded-lg text-white bg-pink-600 hover:bg-pink-700 transition",children:"Add Subcategory"})]})]})]})})})]})})},B=()=>{const[r,t]=n.useState(""),[i,l]=n.useState(!1),{data:p,isLoading:o}=q(),{data:c,isLoading:d,refetch:x}=z(r),{mutateAsync:u}=D(),{pageNumber:m,pageSizeValue:h,handlePageChange:g,handlePageSizeChange:f}=T(),{mutateAsync:s,isPending:C}=E(),k=async(a,b)=>{try{await s({id:a,isActive:!b}),y.success("Status updated successfully!"),P.invalidateQueries({queryKey:["sub-category"]})}catch{y.error("Failed to update status")}},A=async a=>{await u(a),l(!1),x()};return o||d?e.jsx(L,{}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("select",{value:r,onChange:a=>t(a.target.value),className:"border rounded-md p-2",children:[e.jsx("option",{value:"",children:"All Categories"}),p?.results.map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]}),e.jsx("button",{onClick:()=>l(!0),className:"bg-pink-600 text-white px-4 py-2 rounded-md hover:bg-pink-700 transition",children:"+ Add Subcategory"})]}),e.jsx("div",{className:"overflow-x-auto max-h-[400px] rounded-lg shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm bg-white",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left font-medium",children:"S.No"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Image"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Name"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Status"})]})}),e.jsx("tbody",{children:c?.results.map((a,b)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 transition-all duration-200",children:[e.jsx("td",{className:"p-3",children:(m-1)*h+(b+1)}),e.jsx("td",{className:"p-3",children:a.image?e.jsx("img",{src:a.image,alt:a.name,className:"w-12 h-12 object-cover rounded-md border"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md flex items-center justify-center text-gray-500 text-xs",children:"No Image"})}),e.jsx("td",{className:"p-3 font-medium",children:a.name}),e.jsx("td",{className:"p-3",children:e.jsxs(N.label,{whileTap:{scale:.9},className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:!!a.isActive,onChange:()=>k(a._id,!!a.isActive),disabled:C}),e.jsx(N.div,{layout:!0,transition:{type:"spring",stiffness:500,damping:30},className:`w-11 h-6 rounded-full relative transition-colors duration-300 ${a.isActive?"bg-green-500":"bg-gray-300"}`,children:e.jsx(N.div,{layout:!0,transition:{type:"spring",stiffness:400,damping:25},className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow ${a.isActive?"left-[22px]":"left-[2px]"}`})})]})})]},a._id))})]})}),c?.pagination&&e.jsx(I,{currentPage:m,handlePageChange:g,pageSize:h,handlePageSizeChange:f,totalCount:c.pagination.total}),e.jsx(K,{isOpen:i,onClose:()=>l(!1),categories:p?.results??[],isCategoriesLoading:o,onSubmit:A})]})};export{B as default};
