import{o as q,m as k,z as F,a as P,n as _,e as g,j as e,x as z,k as I,q as T}from"./index.DlsZ5bxu.js";import{u as E,a as D}from"./useCreateProduct.Bh7u6Crb.js";import{u as O,P as K}from"./usePagination.Ct4CxkUv.js";import{X as M}from"./x.DtgYVvYY.js";import{K as S}from"./transition.Bad4aoF1.js";import{h as w}from"./dialog.VCeNJoc3.js";import{h as C}from"./queryToast.Dg3-Eyj2.js";import{m as A}from"./proxy.Dpz_HWkI.js";const R=()=>{const n=q();return k({mutationFn:async a=>(await P.post("/subcategory",a,{headers:{"Content-Type":"multipart/form-data"}})).data,onSuccess:()=>{F.success("Subcategory created successfully!"),n.invalidateQueries({queryKey:["sub-category"]})},onError:a=>{F.error(a?.response?.data?.error||a?.message||"Failed to create subcategory")}})},Q=()=>k({mutationFn:async({id:n,data:a})=>(await P.put(`/update-subcategory/${n}`,a)).data}),$=({isOpen:n,categories:a,isCategoriesLoading:f,isUpdate:p=!1,data:i,isDisabled:c,onSubmit:y,onClose:x})=>{const{register:m,handleSubmit:b,reset:l,watch:j,formState:{errors:h}}=_({defaultValues:{name:"",category:"",image:void 0,isActive:!0}}),u=j("image")?.[0];g.useEffect(()=>{if(!n){l();return}l(i&&p?{name:i.name||"",category:i.category?._id||"",image:void 0,isActive:i.isActive??!0}:{name:"",category:"",image:void 0,isActive:!0})},[n,i,p,l]);const N=r=>{const o=new FormData;Object.entries(r).forEach(([d,s])=>{d==="image"&&s instanceof FileList&&s.length>0?o.append(d,s[0]):s instanceof File?o.append(d,s):typeof s=="boolean"?o.append(d,s?"true":"false"):s!=null&&o.append(d,String(s))}),y(o)};return e.jsx(S,{appear:!0,show:n,as:g.Fragment,children:e.jsxs(w,{as:"div",className:"relative z-50",onClose:x,children:[e.jsx(S.Child,{as:g.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(S.Child,{as:g.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(w.Panel,{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(w.Title,{className:"text-lg font-semibold",children:p?"Update Subcategory":"Add New Subcategory"}),e.jsx("button",{type:"button",onClick:x,className:"rounded-full p-1 hover:bg-gray-100",children:e.jsx(M,{size:20})})]}),e.jsxs("form",{onSubmit:b(N),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcategory Name"}),e.jsx("input",{type:"text",...m("name",{required:"Name is required"}),placeholder:"Enter subcategory name",className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500"}),h.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:h.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category"}),f?e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading categories..."}):e.jsxs("select",{...m("category",{required:"Category is required"}),className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500",children:[e.jsx("option",{value:"",children:"Select Category"}),a.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),h.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:h.category.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcategory Image (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",...m("image",{onChange:r=>r.target.files?.[0]}),className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500"}),u instanceof File&&e.jsx("img",{src:URL.createObjectURL(u),alt:"Preview",className:"w-20 h-20 object-cover rounded-lg mt-2 border"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",...m("isActive"),id:"isActive",className:"h-4 w-4 text-pink-600 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:c,className:"px-4 py-2 rounded-lg text-white bg-pink-600 hover:bg-pink-700 transition",children:[p?"Update":"Add"," Subcategory"]})]})]})]})})})]})})},Z=()=>{const{categoryId:n}=z(),[a,f]=g.useState(n||""),[p,i]=g.useState(!1),[c,y]=g.useState({isUpdate:!1,data:null}),{data:x,isLoading:m}=E(),{pageNumber:b,pageSizeValue:l,handlePageChange:j,handlePageSizeChange:h}=O(),{data:u,isLoading:N,refetch:r}=D(a,b,l),o=R(),{mutateAsync:d,isPending:s}=Q(),U=async(t,v)=>{d({id:t,data:{isActive:!v}},C(r)),F.success("Status updated successfully!"),T.invalidateQueries({queryKey:["sub-category"]})},L=async t=>{c.isUpdate&&c?.data?._id?d({id:c.data?._id,data:t},C(r,()=>i(!1),()=>y({isUpdate:!1,data:null}))):o.mutate(t,C(r,()=>i(!1)))};return m||N?e.jsx(I,{}):e.jsxs("div",{className:"sm:p-4 p-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("select",{value:a,onChange:t=>f(t.target.value),className:"border rounded-md p-2",children:[e.jsx("option",{value:"",children:"All Categories"}),x?.results?.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx("button",{onClick:()=>i(!0),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md font-medium transition",children:"+ Add Subcategory"})]}),e.jsx("div",{className:"overflow-x-auto max-h-[400px] rounded-lg shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm bg-white",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left font-medium",children:"S.No"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Image"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Name"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Category"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:u?.results?.length?u.results.map((t,v)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 transition-all duration-200",children:[e.jsx("td",{className:"p-3",children:(b-1)*l+(v+1)}),e.jsx("td",{className:"p-3",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-12 h-12 object-cover rounded-md border"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md flex items-center justify-center text-gray-500 text-xs",children:"No Image"})}),e.jsx("td",{className:"p-3 font-medium",children:t.name}),e.jsx("td",{className:"p-3 font-medium",children:t?.category?.name}),e.jsx("td",{className:"p-3",children:e.jsxs(A.label,{whileTap:{scale:.9},className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:!!t.isActive,onChange:()=>U(t._id,!!t.isActive),disabled:s}),e.jsx(A.div,{layout:!0,transition:{type:"spring",stiffness:500,damping:30},className:`w-11 h-6 rounded-full relative transition-colors duration-300 ${t.isActive?"bg-green-500":"bg-gray-300"}`,children:e.jsx(A.div,{layout:!0,transition:{type:"spring",stiffness:400,damping:25},className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow ${t.isActive?"left-[22px]":"left-[2px]"}`})})]})}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>{y({isUpdate:!0,data:t}),i(!0)},className:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition",children:"Edit"})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-gray-500",children:"No subcategories found."})})})]})}),u?.pagination&&e.jsx(K,{currentPage:b,handlePageChange:j,pageSize:l,handlePageSizeChange:h,totalCount:u.pagination.total}),e.jsx($,{isOpen:p,onClose:()=>{i(!1),y({isUpdate:!1,data:null})},categories:x?.results??[],isCategoriesLoading:m,onSubmit:L,isUpdate:c?.isUpdate,data:c?.data,isDisabled:o.isPending})]})};export{Z as default};
