import{u as z,o as S,m as _,a as w,x as F,e as y,j as e,k as $,z as b}from"./index.DlsZ5bxu.js";import{V as K}from"./VariantImagesUploader.B3LgL212.js";const Q=t=>z({queryKey:["product-variant",t],queryFn:async()=>(console.log("Fetching product variants for:",t),(await w.get(`/get-product-variant?product_id=${t}`)).data),enabled:!!t}),U=()=>{const t=S();return _({mutationFn:async({id:a,payload:r})=>(await w.put(`/update-product-variant/${a}`,r)).data,onSuccess:()=>{t.invalidateQueries({queryKey:["product-variant"]})}})},H=()=>{const t=S();return _({mutationFn:async({id:a,payload:r})=>(await w.put(`/update-product-variant-item/${a}`,r)).data,onSuccess:()=>{t.invalidateQueries({queryKey:["product-variant"]})}})},R=()=>{const{productId:t}=F(),{data:a,isLoading:r}=Q(t??""),{mutate:l}=H(),{mutate:n}=U(),[c,p]=y.useState({}),[d,u]=y.useState({}),[o,g]=y.useState({}),[j,f]=y.useState({});if(r)return e.jsx($,{});const v=a?.results||[];if(v.length===0)return e.jsx("p",{className:"text-center mt-10 text-gray-500",children:"No variants available"});const V=(s,i,m)=>p(h=>({...h,[s]:{...h[s],[i]:m}})),k=s=>{if(!s)return b.error("Invalid variant item!");l({id:s,payload:{sell_price:c[s]?.price,stock:c[s]?.stock}},{onSuccess:()=>b.success("Size updated!"),onError:()=>b.error("Failed!")})},I=(s,i,m)=>u(h=>({...h,[s]:{...h[s],[i]:m}})),E=s=>{const i=d[s._id??""]||{};n({id:s._id??"",payload:{color:i.color??s.color,colorCode:i.colorCode??s.colorCode,highlights:i.highlights?i.highlights.split(",").map(m=>m.trim()):s.sizes?.[0]?.highlights||[]}},{onSuccess:()=>{b.success("Variant updated!"),g(m=>({...m,[s._id??""]:!1}))}})},P=s=>{const i=d[s._id??""]||{};n({id:s._id??"",payload:{...s,images:i.images||s.images}},{onSuccess:()=>{b.success("Images updated!"),f(m=>({...m,[s._id??""]:!1}))}})};return e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-10",children:v.map((s,i)=>{const m=Array.from(new Set(s.sizes.flatMap(x=>x.attributes.map(N=>N.name.trim())))),h=d[s._id??""]||{},C=o[s._id??""]||!1,q=j[s._id??""]||!1;return e.jsxs("div",{className:"bg-white shadow-lg rounded-3xl p-6 md:p-8 transition hover:shadow-xl",children:[e.jsx(L,{variant:s,isEditing:C,onEdit:()=>g(x=>({...x,[s._id??""]:!0})),onSave:()=>E(s),onCancel:()=>g(x=>({...x,[s._id??""]:!1}))}),e.jsx(M,{isEditing:C,edit:h,variant:s,onChange:(x,N)=>I(s._id??"",x,N)}),e.jsx(O,{variant:s,eIndex:i,editVariant:d,isEditingImg:q,onEdit:()=>f(x=>({...x,[s._id??""]:!0})),onSave:()=>P(s),onCancel:()=>f(x=>({...x,[s._id??""]:!1})),setEditVariant:u}),e.jsx(A,{variant:s,variantKeys:m,editedValues:c,onChange:V,onSave:k})]},s._id)})})},L=({variant:t,isEditing:a,onEdit:r,onSave:l,onCancel:n})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:t.color}),e.jsx("span",{className:"w-6 h-6 rounded-full border",style:{backgroundColor:t.colorCode}})]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["Variant ID: ",t._id]})]}),a?e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,className:"bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700 text-sm",children:"ðŸ’¾ Save"}),e.jsx("button",{onClick:n,className:"bg-gray-300 px-4 py-1 rounded text-sm",children:"âŒ Cancel"})]}):e.jsx("button",{onClick:r,className:"bg-gray-100 border px-4 py-1 rounded hover:bg-gray-200 text-sm",children:"âœï¸ Edit Variant"})]}),M=({isEditing:t,edit:a,variant:r,onChange:l})=>e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Color"}),e.jsx("input",{type:"text",disabled:!t,value:a.color??r.color,onChange:n=>l("color",n.target.value),className:`border px-3 py-2 w-full rounded ${t?"":"bg-gray-100 cursor-not-allowed"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Color Code"}),e.jsx("input",{type:"text",disabled:!t,value:a.colorCode??r.colorCode,onChange:n=>l("colorCode",n.target.value),className:`border px-3 py-2 w-full rounded ${t?"":"bg-gray-100 cursor-not-allowed"}`})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Highlights (comma separated)"}),e.jsx("textarea",{disabled:!t,value:a.highlights??r.sizes?.[0]?.highlights?.join(", ")??"",onChange:n=>l("highlights",n.target.value),className:`border px-3 py-2 w-full rounded min-h-[80px] ${t?"":"bg-gray-100 cursor-not-allowed"}`})]})]}),O=({variant:t,eIndex:a,editVariant:r,isEditingImg:l,onEdit:n,onSave:c,onCancel:p,setEditVariant:d})=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Images"}),l?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:c,className:"bg-green-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-green-700 transition",children:"ðŸ’¾ Save"}),e.jsx("button",{onClick:p,className:"bg-gray-300 text-gray-800 px-3 py-1 rounded-lg text-sm hover:bg-gray-400 transition",children:"âŒ Cancel"})]}):e.jsx("button",{onClick:n,className:"bg-gray-100 border px-3 py-1 rounded-lg text-sm hover:bg-gray-200 transition",children:"ðŸ–¼ Edit Images"})]}),!l&&e.jsx("div",{className:"flex flex-wrap gap-3 mb-4",children:(r[t._id??""]?.images??t.images)?.map((u,o)=>e.jsx("div",{className:"relative w-24 h-24 border-2 rounded-xl overflow-hidden",children:e.jsx("img",{src:u,alt:"",className:"object-cover w-full h-full"})},o))}),l&&e.jsx(K,{vIndex:a,setValue:(u,o)=>{d(g=>({...g,[t._id??""]:{...g[t._id??""],images:o}}))},getValues:()=>r[t._id??""]?.images??t.images??[]})]}),A=({variant:t,variantKeys:a,editedValues:r,onChange:l,onSave:n})=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6",children:t.sizes.map((c,p)=>{const d=c._id??"",u=r[d]||{price:c.sell_price,stock:c.stock};return e.jsxs("div",{className:"border border-gray-200 rounded-2xl bg-white shadow-sm p-4 flex flex-col justify-between hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 text-sm",children:["Size ",p+1]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["SKU: ",c.sku||"â€”"]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:a.slice(0,3).map(o=>{const g=c.attributes.find(j=>j.name.trim()===o);return e.jsxs("div",{className:"flex justify-between text-sm text-gray-700 border-b border-dashed pb-1",children:[e.jsx("span",{className:"font-medium text-gray-600",children:o}),e.jsx("span",{className:"text-gray-900",children:g?.value||"â€”"})]},o)})}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Original Price"}),e.jsxs("span",{className:"text-sm text-gray-900 font-medium",children:["â‚¹",c.original_price??"â€”"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Sell Price"}),e.jsx("input",{type:"number",value:u.price,onChange:o=>l(d,"price",Number(o.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 outline-none"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Stock"}),e.jsx("input",{type:"number",value:u.stock,onChange:o=>l(d,"stock",Number(o.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 outline-none"})]})]}),e.jsx("button",{onClick:()=>n(d),className:"w-full mt-4 bg-green-600 text-white text-sm py-1.5 rounded-lg hover:bg-green-700 transition-all",children:"Save"})]},p)})});export{R as default};
