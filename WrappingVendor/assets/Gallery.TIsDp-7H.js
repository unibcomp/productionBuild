import{u as E,m as w,a as m,n as P,e as j,j as e}from"./index.CSCVunL6.js";const M=async()=>m.post("/galley-list").then(t=>t.data),U=()=>E({queryKey:["gallery"],queryFn:M}),_=async t=>m.post("/create-galley",t).then(s=>s.data),$=()=>w({mutationFn:_}),q=async({id:t,data:s})=>m.put(`/galley-update/${t}`,s).then(n=>n.data),A=()=>w({mutationFn:q}),D=async t=>m.delete(`/galley-delete/${t}`).then(s=>s.data),L=()=>w({mutationFn:D}),O=()=>w({mutationFn:async t=>{if(!t||t.length===0)throw new Error("No files provided");const s=new FormData;return t.forEach(d=>s.append("products",d)),(await m.post("/products/uploads",s)).data}}),V=({open:t,onClose:s,editData:n,onSuccess:d})=>{const{mutate:N,isPending:x}=$(),{mutate:i,isPending:p}=A(),{mutate:g,isPending:v}=O(),{register:h,handleSubmit:l,setValue:b,reset:o}=P({defaultValues:{title:"",description:"",images:[]}}),[y,f]=j.useState([]);if(j.useMemo(()=>{if(!t)return;const a=n||{title:"",description:"",images:[]};o(a),f(a.images||[])},[t,n,o]),!t)return null;const C=a=>a&&g(Array.from(a),{onSuccess:r=>{const c=[...y,...r.data.map(u=>u.url)];f(c),b("images",c)}}),S=a=>{const{title:r,description:c,images:u}=a,G=()=>{o(),f([]),s(),d()},k={title:r,description:c,images:u};n?._id?i({id:n._id,data:k},{onSuccess:G}):N(k,{onSuccess:G})},F=a=>{const r=y.filter((c,u)=>u!==a);f(r),b("images",r)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-xl w-full max-w-lg relative",children:[e.jsx("button",{onClick:s,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-800",children:"âœ•"}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:n?"âœï¸ Update Gallery":"ðŸ“¸ Create Gallery"}),e.jsxs("form",{onSubmit:l(S),className:"space-y-4",children:[e.jsx("input",{...h("title",{required:!0}),placeholder:"Gallery Title",className:"border p-2 rounded w-full"}),e.jsx("textarea",{...h("description"),placeholder:"Description (optional)",className:"border p-2 rounded w-full"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:a=>C(a.target.files),disabled:v}),!!y.length&&e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((a,r)=>e.jsxs("div",{className:"relative w-24 h-24 border rounded overflow-hidden",children:[e.jsx("img",{src:a,className:"object-cover w-full h-full"}),e.jsx("button",{type:"button",onClick:()=>F(r),className:"absolute top-1 right-1 bg-red-500 text-white rounded px-1 text-xs",children:"âœ•"})]},r))}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x||p,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:n?p?"Updating...":"Update":x?"Creating...":"Create"})]})]})]})})},I=()=>{const{data:t,isLoading:s,refetch:n}=U(),{mutate:d,isPending:N}=L(),[x,i]=j.useState(!1),[p,g]=j.useState(null),v=l=>window.confirm("Delete this gallery?")&&d(l,{onSuccess:()=>n()}),h=l=>{g(l),i(!0)};return e.jsxs("div",{className:"max-w-6xl mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"ðŸ“¸ Gallery Management"}),e.jsx("button",{onClick:()=>{g(null),i(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Add Gallery"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"All Galleries"}),s?e.jsx("p",{children:"Loading..."}):t?.results?.length?e.jsx("div",{className:"flex flex-col gap-4",children:t.results.map(l=>e.jsxs("div",{className:"flex flex-col justify-between border rounded-lg overflow-hidden shadow-sm bg-white dark:bg-gray-700",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-600 p-3 text-center font-semibold flex justify-between",children:[e.jsx("div",{children:l.title}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(l),className:"bg-green-500 text-white text-sm px-3 py-1 rounded hover:bg-green-600 w-[48%]",children:e.jsx("span",{className:"material-symbols-outlined",children:"update"})}),e.jsx("button",{onClick:()=>v(l._id),disabled:N,className:"bg-red-500 text-white text-sm px-3 py-1 rounded hover:bg-red-600 w-[48%]",children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})})]})]}),e.jsx("div",{className:"flex gap-1 p-2 relative custom-scroll",children:l.images?.map((b,o)=>e.jsx("img",{src:b,alt:`${l.title}-${o}`,className:"w-full h-32 object-contain rounded border border-gray-300"},o))}),e.jsx("div",{className:"flex flex-col justify-between flex-grow p-3",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3 line-clamp-2",children:l.description||"No description"})})]},l._id))}):e.jsx("p",{children:"No galleries found."})]}),e.jsx(V,{open:x,onClose:()=>i(!1),editData:p,onSuccess:()=>{n(),i(!1)}})]})};export{I as default};
