import{e as y,j as a,a as A}from"./index.7wMPYj0k.js";const w=({vIndex:d,setValue:s,getValues:t})=>{const n=`variants.${d}.images`,[p,u]=y.useState(!1),x=typeof t=="function"?(()=>{try{if(t.length>0){const e=t(n);return Array.isArray(e)?e:[]}const r=t();return Array.isArray(r)?r:[]}catch{return[]}})():[],[c,f]=y.useState(x),h=()=>{try{if(t.length>0){const r=t(n);return Array.isArray(r)?r:[]}return t()}catch{return[]}},v=r=>{const e=h();e.splice(r,1),s.length>2?s(n,e,{shouldValidate:!0}):s(n,e),f(e)},b=r=>{if(Array.isArray(r))return r.map(e=>typeof e=="string"?e:e.url).filter(Boolean);if(typeof r=="object"&&r!==null&&"data"in r){const e=r.data;return Array.isArray(e)?e.map(i=>i.url).filter(Boolean):[]}return[]},j=async r=>{if(!r||r.length===0)return;const e=Array.from(r),i=h();if(i.length+e.length>10){alert("You can upload a maximum of 10 images per variant.");return}const g=new FormData;e.forEach(o=>g.append("products",o));try{u(!0);const o=await A.post("/products/uploads",g),l=b(o.data),m=[...i,...l].slice(0,10);s.length>2?s(n,m,{shouldValidate:!0}):s(n,m),f(m)}catch(o){const l=o;alert(l.message||l.error||"Upload failed"),console.error("Variant upload error:",l)}finally{u(!1)}};return a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block font-medium mb-2",children:"Variant Images (max 10)"}),a.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:r=>j(r.target.files),disabled:p,className:"mb-2"}),p&&a.jsx("div",{className:"text-sm mb-2",children:"Uploading..."}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:c.length>0?c.map((r,e)=>a.jsxs("div",{className:"relative w-24 h-24 border rounded overflow-hidden",children:[a.jsx("img",{src:r,alt:`variant-${d}-img-${e}`,className:"object-cover w-full h-full"}),a.jsx("button",{type:"button",onClick:()=>v(e),className:"absolute top-1 right-1 bg-red-500 text-white rounded px-1 text-xs",children:"âœ•"})]},e)):a.jsx("div",{className:"text-sm text-gray-500",children:"No images uploaded yet for this variant."})}),a.jsx("input",{type:"text",value:c.join(", "),readOnly:!0,className:"border p-2 rounded w-full",placeholder:"Variant Image URLs (comma separated)"})]})};export{w as V};
