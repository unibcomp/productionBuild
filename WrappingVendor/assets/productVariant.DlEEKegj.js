import{u as Q,o as S,m as V,a as f,x as A,e as h,j as e,k as D,z as u}from"./index.Bsxud7Gi.js";const L=l=>Q({queryKey:["product-variant",l],queryFn:async()=>(console.log("Fetching product variants for:",l),(await f.get(`/get-product-variant?product_id=${l}`)).data),enabled:!!l}),M=()=>{const l=S();return V({mutationFn:async({id:d,payload:m})=>(await f.put(`/update-product-variant/${d}`,m)).data,onSuccess:()=>{l.invalidateQueries({queryKey:["product-variant"]})}})},U=()=>{const l=S();return V({mutationFn:async({id:d,payload:m})=>(await f.put(`/update-product-variant-item/${d}`,m)).data,onSuccess:()=>{l.invalidateQueries({queryKey:["product-variant"]})}})},O=()=>{const{productId:l}=A(),{data:d,isLoading:m}=L(l??""),{mutate:p}=U(),{mutate:_}=M(),[k,E]=h.useState({}),[g,z]=h.useState({}),[N,I]=h.useState({}),[$,b]=h.useState({});if(m)return e.jsx(D,{});const v=d?.results||[];if(v.length===0)return e.jsx("p",{className:"text-center mt-10 text-gray-500",children:"No variants available"});const w=(s,a,o)=>{z(r=>({...r,[s]:{...r[s],[a]:o}}))},q=s=>{if(!s)return u.error("Invalid variant item!");const a={id:s,sell_price:g[s]?.price,stock:g[s]?.stock};p({id:s,payload:a},{onSuccess:()=>u.success("Size updated successfully!"),onError:()=>u.error("Failed to update size")})},y=(s,a,o)=>{I(r=>({...r,[s]:{...r[s],[a]:o}}))},F=s=>{if(!s._id)return u.error("Invalid variant ID!");const a=N[s._id]||{},o={color:a.color??s.color,colorCode:a.colorCode??s.colorCode,images:a.images??s.images,highlights:a.highlights?a.highlights.split(",").map(r=>r.trim()):s.sizes?.[0]?.highlights||[],attributes:s.sizes?.[0]?.attributes.map(r=>({name:r.name,value:r.value}))||[]};_({id:s._id,payload:o},{onSuccess:()=>{u.success("Variant updated successfully!"),b(r=>({...r,[s._id]:!1}))},onError:()=>u.error("Failed to update variant")})};return e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-10",children:v.map((s,a)=>{const o=Array.from(new Set(s.sizes.flatMap(t=>t.attributes.map(x=>x.name.trim())))),r=k[a]||s.images?.[0]||"",j=N[s._id??""]||{},c=$[s._id??""]||!1;return e.jsxs("div",{className:"bg-white shadow-lg rounded-3xl p-6 md:p-8 transition hover:shadow-xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:s.color}),e.jsx("span",{className:"w-6 h-6 rounded-full border",style:{backgroundColor:s.colorCode}})]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["Variant ID: ",s._id]})]}),c?e.jsxs("div",{className:"flex gap-3 self-start md:self-auto",children:[e.jsx("button",{onClick:()=>F(s),className:"bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700 text-sm",children:"ðŸ’¾ Save"}),e.jsx("button",{onClick:()=>b(t=>({...t,[s._id]:!1})),className:"bg-gray-300 px-4 py-1 rounded text-sm",children:"âŒ Cancel"})]}):e.jsx("button",{onClick:()=>b(t=>({...t,[s._id]:!0})),className:"bg-gray-100 border px-4 py-1 rounded hover:bg-gray-200 text-sm self-start md:self-auto",children:"âœï¸ Edit Variant"})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Color"}),e.jsx("input",{type:"text",disabled:!c,value:j.color??s.color,onChange:t=>y(s._id??"","color",t.target.value),className:`border px-3 py-2 w-full rounded ${c?"":"bg-gray-100 cursor-not-allowed"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Color Code"}),e.jsx("input",{type:"text",disabled:!c,value:j.colorCode??s.colorCode,onChange:t=>y(s._id??"","colorCode",t.target.value),className:`border px-3 py-2 w-full rounded ${c?"":"bg-gray-100 cursor-not-allowed"}`})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Highlights (comma separated)"}),e.jsx("textarea",{disabled:!c,value:j.highlights??(s.sizes?.[0]?.highlights?.join(", ")||""),onChange:t=>y(s._id??"","highlights",t.target.value),className:`border px-3 py-2 w-full rounded min-h-[80px] ${c?"":"bg-gray-100 cursor-not-allowed"}`})]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto mb-6 scrollbar-thin scrollbar-thumb-gray-400",children:s.images.map((t,x)=>e.jsx("button",{onClick:()=>E(n=>({...n,[a]:t})),className:`w-24 h-24 flex-shrink-0 border-2 rounded-xl overflow-hidden transition ${r===t?"border-blue-600":"border-gray-200"}`,children:e.jsx("img",{src:t,alt:"",className:"w-full h-full object-cover"})},x))}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border border-gray-200 text-sm rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-gray-700 uppercase text-xs",children:[o.map(t=>e.jsx("th",{className:"p-3 text-left whitespace-nowrap",children:t},t)),e.jsx("th",{className:"p-3 text-left",children:"Price"}),e.jsx("th",{className:"p-3 text-left",children:"Stock"}),e.jsx("th",{className:"p-3 text-left",children:"Action"})]})}),e.jsx("tbody",{children:s.sizes.map((t,x)=>{const n=t._id??"",C=g[n]||{price:t.sell_price,stock:t.stock};return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[o.map(i=>{const P=t.attributes.find(K=>K.name.trim()===i);return e.jsx("td",{className:"p-3",children:P?.value||"-"},i)}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:C.price,onChange:i=>w(n,"price",Number(i.target.value)),className:"w-24 px-2 py-1 border rounded"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:C.stock,onChange:i=>w(n,"stock",Number(i.target.value)),className:"w-24 px-2 py-1 border rounded"})}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>q(n),className:"bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700",children:"Save"})})]},x)})})]})})]},s._id)})})};export{O as default};
