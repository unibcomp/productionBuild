import{o as y,u as f,m as N,a as j,e as p,j as e,x as w,f as S,k as v}from"./index.CSCVunL6.js";import{u as A,P}from"./usePagination.B8WAV1TO.js";import{L as _}from"./loader-circle.CWWTuJHy.js";import{P as k}from"./PageHeadline.Rm5uUsZq.js";const C=async a=>(await j.get("/orders/details",{params:a})).data,O=async({orderId:a,orderStatus:r})=>(await j.patch(`/orders/${a}/status`,{orderStatus:r})).data,z=({pageSize:a=10,pageNumber:r=1,status:d,userId:c})=>{const l=y(),i={pageNumber:r,pageSize:a,...d&&{status:d},...c&&{userId:c}},n=f({queryKey:["orders",i],queryFn:()=>C(i),staleTime:1e3*60}),o=N({mutationFn:O,onSuccess:()=>{l.invalidateQueries({queryKey:["orders"]})}});return{...n,updateOrderStatus:o.mutateAsync}},b=[{label:"Pending",color:"bg-blue-100 text-blue-700 border-blue-300"},{label:"Processing",color:"bg-indigo-100 text-indigo-700 border-indigo-300"},{label:"Shipped",color:"bg-teal-100 text-teal-700 border-teal-300"},{label:"Out for Delivery",color:"bg-orange-100 text-orange-700 border-orange-300"},{label:"Delivered",color:"bg-green-100 text-green-700 border-green-300"},{label:"Placed",color:"bg-sky-100 text-sky-700 border-sky-300"},{label:"Cancelled",color:"bg-red-100 text-red-700 border-red-300"},{label:"Returned",color:"bg-pink-100 text-pink-700 border-pink-300"},{label:"Failed",color:"bg-gray-100 text-gray-700 border-gray-300"},{label:"Refunded",color:"bg-yellow-100 text-yellow-700 border-yellow-300"}],L=({orders:a,startItem:r,updateOrderStatus:d,isSuperAdmin:c})=>{const[l,i]=p.useState(null),[n,o]=p.useState(null),[u,g]=p.useState(a);p.useEffect(()=>{g(a)},[a]);const x=async(s,m)=>{o(s);try{g(t=>t.map(h=>h._id===s?{...h,orderStatus:m}:h)),await d({orderId:s,orderStatus:m})}catch(t){console.error("Failed to update order status:",t),alert("Failed to update order status."),g(a)}finally{o(null)}};return u.length===0?e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-4 text-gray-500",children:"No Orders Found"})})}):e.jsx("tbody",{children:u.map((s,m)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"p-3 border text-center text-sm align-middle",children:m+r}),e.jsx("td",{className:"p-3 border font-mono text-xs sm:text-sm text-gray-800 break-words align-middle",children:s.transaction_id||"N/A"}),e.jsx("td",{className:"p-3 border text-sm align-middle",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"break-words",children:[e.jsx("strong",{children:"ID:"})," ",s.user._id]}),e.jsxs("div",{className:"break-words",children:[e.jsx("strong",{children:"Name:"})," ",s.user.username]}),e.jsxs("div",{className:"break-words",children:[e.jsx("strong",{children:"Email:"})," ",s.user.email]})]})}),e.jsxs("td",{className:"p-3 border font-semibold text-gray-900 align-middle text-center",children:["₹ ",s.totalAmount]}),e.jsx("td",{className:"p-3 border text-center align-middle",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.paymentStatus==="Paid"?"bg-green-100 text-green-700":s.paymentStatus==="Pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:s.paymentStatus})}),e.jsx("td",{className:"p-3 border text-center align-middle",children:c?e.jsxs("div",{className:"relative inline-flex items-center w-full max-w-[150px]",children:[e.jsx("select",{value:s.orderStatus,disabled:n===s._id,onChange:t=>x(s._id,t.target.value),className:`appearance-none w-full rounded-full pl-3 pr-8 py-1.5 text-xs font-semibold border shadow-sm cursor-pointer transition-all duration-200 focus:ring-2 focus:ring-indigo-400 focus:outline-none ${b.find(t=>t.label===s.orderStatus)?.color||"bg-gray-100 text-gray-700 border-gray-300"} ${n===s._id?"opacity-60 cursor-wait":""}`,children:b.map(t=>e.jsx("option",{value:t.label,children:t.label},t.label))}),e.jsx("span",{className:"material-symbols-outlined absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500 text-base",children:"arrow_drop_down"}),n===s._id&&e.jsx(_,{className:"w-4 h-4 text-gray-500 animate-spin absolute right-6 top-1/2 -translate-y-1/2"})]}):s.orderStatus}),e.jsxs("td",{className:"p-3 border text-xs sm:text-sm text-center align-middle",children:[e.jsx("button",{onClick:()=>i(l===s._id?null:s._id),className:"px-3 py-1 rounded-md bg-indigo-50 text-indigo-600 hover:bg-indigo-100 text-xs font-medium transition",children:l===s._id?"Hide Items":`View Items (${s.items.length})`}),l===s._id&&e.jsx("div",{className:"mt-3 flex flex-col gap-3",children:s.items.map(t=>e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50 flex flex-col items-center text-center",children:[t.productDetails.images.length>0&&e.jsx("img",{src:t.productDetails.images[0],alt:t.name,className:"w-20 h-20 object-cover rounded border mb-2"}),e.jsx("div",{className:"font-semibold text-gray-900 text-sm break-words",children:t.name}),e.jsxs("div",{className:"text-gray-600 text-xs mt-1",children:[t.quantity," pcs · ₹",t.size.sell_price," each"]}),e.jsxs("div",{className:"text-gray-500 text-xs break-words",children:["Color: ",t.color," | Size: ",t.size.sizeName]}),e.jsxs("div",{className:"text-gray-800 text-xs font-medium mt-1",children:["Total: ₹",t.total]})]},t._id))})]}),e.jsx("td",{className:"p-3 border text-xs sm:text-sm align-middle",children:e.jsxs("div",{className:"flex flex-col gap-1 text-gray-700 break-words",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Name:"})," ",s.shippingAddress?.name]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Address:"})," ",s.shippingAddress?.addressLine1,","," ",s.shippingAddress?.addressLine2]}),e.jsxs("span",{children:[e.jsx("strong",{children:"City:"})," ",s.shippingAddress?.city]}),e.jsxs("span",{children:[e.jsx("strong",{children:"State:"})," ",s.shippingAddress?.state]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Postal Code:"})," ",s.shippingAddress?.postalCode]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Country:"})," ",s.shippingAddress?.country]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Phone:"})," ",s.shippingAddress?.phone]})]})})]},s._id))})},E=({status:a})=>{const{startItem:r,handlePageChange:d,handlePageSizeChange:c,pageNumber:l,pageSizeValue:i}=A(),{userId:n,email:o}=w(),{user:u}=S(),g=u?.role==="ADMIN",{data:x,isLoading:s,updateOrderStatus:m}=z({pageSize:i,pageNumber:l,...a!=="All"&&{status:a},...n&&{userId:n}});return s?e.jsx(v,{}):e.jsxs("div",{className:"p-4",children:[e.jsx(k,{title:`Order List ${o?`of ${o}`:""}`}),e.jsx("div",{className:"overflow-x-auto overflow-y-auto border rounded-lg shadow-sm bg-white",children:e.jsxs("table",{className:"min-w-full border border-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700 sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border font-semibold",children:"S.No"}),e.jsx("th",{className:"p-3 border font-semibold",children:"Order ID"}),e.jsx("th",{className:"p-3 border font-semibold",children:"User"}),e.jsx("th",{className:"p-3 border font-semibold",children:"Total Amount"}),e.jsx("th",{className:"p-3 border font-semibold",children:"Payment Status"}),e.jsx("th",{className:"p-3 border font-semibold",children:"Order Status"}),e.jsx("th",{className:"p-3 border font-semibold",children:"Items"}),e.jsx("th",{className:"p-3 border font-semibold",children:"Shipping Address"})]})}),e.jsx(L,{orders:x?.results||[],startItem:r,updateOrderStatus:m,isSuperAdmin:g})]})}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("span",{className:"text-gray-600 text-sm",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:x?.results?.length||0})," of"," ",e.jsx("span",{className:"font-medium",children:x?.pagination?.total||0})," ","orders"]}),e.jsx(P,{currentPage:l,handlePageChange:d,pageSize:i,handlePageSizeChange:c,totalCount:x?.pagination?.total||0})]})]})};export{E as default};
