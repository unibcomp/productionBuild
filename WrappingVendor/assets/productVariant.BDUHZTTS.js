import{u as F,o as S,m as _,a as w,x as P,e as y,j as e,k as $,z as b}from"./index.CSCVunL6.js";import{V as K}from"./VariantImagesUploader.D9xRcY4q.js";const Q=t=>F({queryKey:["product-variant",t],queryFn:async()=>(console.log("Fetching product variants for:",t),(await w.get(`/get-product-variant?product_id=${t}`)).data),enabled:!!t}),U=()=>{const t=S();return _({mutationFn:async({id:a,payload:r})=>(await w.put(`/update-product-variant/${a}`,r)).data,onSuccess:()=>{t.invalidateQueries({queryKey:["product-variant"]})}})},H=()=>{const t=S();return _({mutationFn:async({id:a,payload:r})=>(await w.put(`/update-product-variant-item/${a}`,r)).data,onSuccess:()=>{t.invalidateQueries({queryKey:["product-variant"]})}})},R=()=>{const{productId:t}=P(),{data:a,isLoading:r}=Q(t??""),{mutate:l}=H(),{mutate:o}=U(),[d,p]=y.useState({}),[i,x]=y.useState({}),[n,g]=y.useState({}),[j,f]=y.useState({});if(r)return e.jsx($,{});const v=a?.results||[];if(v.length===0)return e.jsx("p",{className:"text-center mt-10 text-gray-500",children:"No variants available"});const V=(s,c,u)=>p(h=>({...h,[s]:{...h[s],[c]:u}})),k=s=>{if(!s)return b.error("Invalid variant item!");l({id:s,payload:{sell_price:d[s]?.price,stock:d[s]?.stock}},{onSuccess:()=>b.success("Size updated!"),onError:()=>b.error("Failed!")})},I=(s,c,u)=>x(h=>({...h,[s]:{...h[s],[c]:u}})),E=s=>{const c=i[s._id??""]||{};o({id:s._id??"",payload:{color:c.color??s.color,colorCode:c.colorCode??s.colorCode,highlights:c.highlights?c.highlights.split(",").map(u=>u.trim()):s.sizes?.[0]?.highlights||[]}},{onSuccess:()=>{b.success("Variant updated!"),g(u=>({...u,[s._id??""]:!1}))}})},z=s=>{const c=i[s._id??""]||{};o({id:s._id??"",payload:{...s,images:c.images||s.images}},{onSuccess:()=>{b.success("Images updated!"),f(u=>({...u,[s._id??""]:!1}))}})};return e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-10",children:v.map((s,c)=>{const u=Array.from(new Set(s.sizes.flatMap(m=>m.attributes.map(N=>N.name.trim())))),h=i[s._id??""]||{},C=n[s._id??""]||!1,q=j[s._id??""]||!1;return e.jsxs("div",{className:"bg-white shadow-lg rounded-3xl p-6 md:p-8 transition hover:shadow-xl",children:[e.jsx(L,{variant:s,isEditing:C,onEdit:()=>g(m=>({...m,[s._id??""]:!0})),onSave:()=>E(s),onCancel:()=>g(m=>({...m,[s._id??""]:!1}))}),e.jsx(M,{isEditing:C,edit:h,variant:s,onChange:(m,N)=>I(s._id??"",m,N)}),e.jsx(A,{variant:s,eIndex:c,editVariant:i,isEditingImg:q,onEdit:()=>f(m=>({...m,[s._id??""]:!0})),onSave:()=>z(s),onCancel:()=>f(m=>({...m,[s._id??""]:!1})),setEditVariant:x}),e.jsx(D,{variant:s,variantKeys:u,editedValues:d,onChange:V,onSave:k})]},s._id)})})},L=({variant:t,isEditing:a,onEdit:r,onSave:l,onCancel:o})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800",children:t.color}),e.jsx("span",{className:"w-6 h-6 rounded-full border",style:{backgroundColor:t.colorCode}})]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["Variant ID: ",t._id]})]}),a?e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,className:"bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700 text-sm",children:"ðŸ’¾ Save"}),e.jsx("button",{onClick:o,className:"bg-gray-300 px-4 py-1 rounded text-sm",children:"âŒ Cancel"})]}):e.jsx("button",{onClick:r,className:"bg-gray-100 border px-4 py-1 rounded hover:bg-gray-200 text-sm",children:"âœï¸ Edit Variant"})]}),M=({isEditing:t,edit:a,variant:r,onChange:l})=>e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Color"}),e.jsx("input",{type:"text",disabled:!t,value:a.color??r.color,onChange:o=>l("color",o.target.value),className:`border px-3 py-2 w-full rounded ${t?"":"bg-gray-100 cursor-not-allowed"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Color Code"}),e.jsx("input",{type:"text",disabled:!t,value:a.colorCode??r.colorCode,onChange:o=>l("colorCode",o.target.value),className:`border px-3 py-2 w-full rounded ${t?"":"bg-gray-100 cursor-not-allowed"}`})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-gray-600 text-sm",children:"Highlights (comma separated)"}),e.jsx("textarea",{disabled:!t,value:a.highlights??r.sizes?.[0]?.highlights?.join(", ")??"",onChange:o=>l("highlights",o.target.value),className:`border px-3 py-2 w-full rounded min-h-[80px] ${t?"":"bg-gray-100 cursor-not-allowed"}`})]})]}),A=({variant:t,eIndex:a,editVariant:r,isEditingImg:l,onEdit:o,onSave:d,onCancel:p,setEditVariant:i})=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Images"}),l?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:d,className:"bg-green-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-green-700 transition",children:"ðŸ’¾ Save"}),e.jsx("button",{onClick:p,className:"bg-gray-300 text-gray-800 px-3 py-1 rounded-lg text-sm hover:bg-gray-400 transition",children:"âŒ Cancel"})]}):e.jsx("button",{onClick:o,className:"bg-gray-100 border px-3 py-1 rounded-lg text-sm hover:bg-gray-200 transition",children:"ðŸ–¼ Edit Images"})]}),!l&&e.jsx("div",{className:"flex flex-wrap gap-3 mb-4",children:(r[t._id??""]?.images??t.images)?.map((x,n)=>e.jsx("div",{className:"relative w-24 h-24 border-2 rounded-xl overflow-hidden",children:e.jsx("img",{src:x,alt:"",className:"object-cover w-full h-full"})},n))}),l&&e.jsx(K,{vIndex:a,setValue:(x,n)=>{i(g=>({...g,[t._id??""]:{...g[t._id??""],images:n}}))},getValues:()=>r[t._id??""]?.images??t.images??[]})]}),D=({variant:t,variantKeys:a,editedValues:r,onChange:l,onSave:o})=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6",children:t.sizes.map((d,p)=>{const i=d._id??"",x=r[i]||{price:d.sell_price,stock:d.stock};return e.jsxs("div",{className:"border border-gray-200 rounded-2xl bg-white shadow-sm p-4 flex flex-col justify-between hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 text-sm",children:["Size ",p+1]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["SKU: ",d.sku||"â€”"]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:a.slice(0,3).map(n=>{const g=d.attributes.find(j=>j.name.trim()===n);return e.jsxs("div",{className:"flex justify-between text-sm text-gray-700 border-b border-dashed pb-1",children:[e.jsx("span",{className:"font-medium text-gray-600",children:n}),e.jsx("span",{className:"text-gray-900",children:g?.value||"â€”"})]},n)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Sell Price"}),e.jsx("input",{type:"number",value:x.price,onChange:n=>l(i,"price",Number(n.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 outline-none"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Stock"}),e.jsx("input",{type:"number",value:x.stock,onChange:n=>l(i,"stock",Number(n.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 outline-none"})]})]}),e.jsx("button",{onClick:()=>o(i),className:"w-full mt-4 bg-green-600 text-white text-sm py-1.5 rounded-lg hover:bg-green-700 transition-all",children:"Save"})]},p)})});export{R as default};
