import{r as P,j as e,i as U,k as $,t as z,C as H,z as V}from"./index.Cj5zF2mn.js";import{u as M,a as O,b as R,c as q}from"./useCreateProduct.BjHRoScj.js";const B=({vIndex:a,setValue:p,getValues:C})=>{const b=`variants.${a}.images`,[g,v]=P.useState(!1),[j,x]=P.useState([]),w=()=>{try{const t=C(b);return t?Array.isArray(t)?t:[]:[]}catch{return[]}},c=t=>{const n=w();n.splice(t,1),p(b,n,{shouldValidate:!0}),x(n)},m=t=>{if(Array.isArray(t))return t.map(n=>typeof n=="string"?n:n.url).filter(Boolean);if(typeof t=="object"&&t!==null&&"data"in t){const n=t.data;return Array.isArray(n)?n.map(A=>A.url).filter(Boolean):[]}return[]},h=async t=>{if(!t||t.length===0)return;const n=Array.from(t),A=w();if(A.length+n.length>10){alert("You can upload a maximum of 10 images per variant.");return}const S=new FormData;n.forEach(f=>S.append("products",f));try{v(!0);const f=await U.post("/products/uploads",S),y=m(f.data),_=[...A,...y].slice(0,10);p(b,_,{shouldValidate:!0}),x(_)}catch(f){const y=f;alert(y.message||y.error||"Upload failed"),console.error("Variant upload error:",y)}finally{v(!1)}};return e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block font-medium mb-2",children:"Variant Images (max 10)"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:t=>h(t.target.files),disabled:g,className:"mb-2"}),g&&e.jsx("div",{className:"text-sm mb-2",children:"Uploading..."}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:j.length>0?j.map((t,n)=>e.jsxs("div",{className:"relative w-24 h-24 border rounded overflow-hidden",children:[e.jsx("img",{src:t,alt:`variant-${a}-img-${n}`,className:"object-cover w-full h-full"}),e.jsx("button",{type:"button",onClick:()=>c(n),className:"absolute top-1 right-1 bg-red-500 text-white rounded px-1 text-xs",children:"✕"})]},n)):e.jsx("div",{className:"text-sm text-gray-500",children:"No images uploaded yet for this variant."})}),e.jsx("input",{type:"text",value:j.join(", "),readOnly:!0,className:"border p-2 rounded w-full",placeholder:"Variant Image URLs (comma separated)"})]})},D=({setValue:a})=>{const p="images",[C,b]=P.useState(!1),[g,v]=P.useState(null),j=c=>{if(Array.isArray(c))return c.map(m=>typeof m=="string"?m:m.url).filter(Boolean);if(typeof c=="object"&&c!==null&&"data"in c){const m=c.data;return Array.isArray(m)?m.map(h=>h.url).filter(Boolean):[]}return[]},x=async c=>{if(!c)return;const m=new FormData;m.append("products",c);try{b(!0);const h=await U.post("/products/uploads",m),t=j(h.data);t.length>0&&(a(p,t,{shouldValidate:!0}),v(t[0]))}catch(h){const t=h;console.error("Main image upload error:",t),alert(t.message||t.error||"Upload failed")}finally{b(!1)}},w=()=>{a(p,[],{shouldValidate:!0}),v(null)};return e.jsxs("div",{className:"col-span-2 mb-3",children:[e.jsx("label",{className:"block font-medium mb-2",children:"Main Product Image (1 only)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:c=>x(c.target.files?.[0]||null),disabled:C,className:"mb-2"}),C&&e.jsx("div",{className:"text-sm mb-2",children:"Uploading..."}),g?e.jsxs("div",{className:"relative w-32 h-32 border rounded overflow-hidden mb-2",children:[e.jsx("img",{src:g,alt:"Product Main",className:"object-cover w-full h-full"}),e.jsx("button",{type:"button",onClick:w,className:"absolute top-1 right-1 bg-red-500 text-white rounded px-1 text-xs",children:"✕"})]}):e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"No main product image uploaded yet."}),e.jsx("input",{type:"text",value:g||"",readOnly:!0,className:"border p-2 rounded w-full",placeholder:"Product Image URL"})]})},G=()=>{const{register:a,control:p,handleSubmit:C,reset:b,setValue:g,getValues:v,watch:j}=$({defaultValues:{name:"",category_id:"",brand_id:"",subCategory_id:"",description:"",images:[],isActive:!0,attributes:[{name:"",value:""}],manufacturingInfo:{genericName:"",countryOfOrigin:"",manufacturer:{name:"",address:"",contact:""},importer:{name:"",address:"",contact:""},packer:{name:"",address:"",contact:""}},variants:[{color:"",colorCode:"#000000",images:[],sizes:[{size:"",sizeName:"",label:"",sku:"",stock:0,original_price:0,sell_price:0,highlights:[""],attributes:[{name:"",value:""}],isActive:!0}]}]}}),x=j("category_id"),w=!0,{data:c}=M();console.log("Category API response:",c);const{data:m}=O(x,w),{data:h}=R({categoryId:x}),{mutate:t,isPending:n}=q(),{fields:A,append:S,remove:f}=z({control:p,name:"attributes"}),{fields:y,append:_,remove:F}=z({control:p,name:"variants"}),I=r=>{const d={...r,tax:Number(r.tax),images:r.images.filter(s=>s.trim()!==""),variants:r.variants.map(s=>({...s,images:Array.isArray(s.images)?s.images.filter(u=>u.trim()!==""):[],sizes:s.sizes.map(u=>({...u,attributes:u.attributes.filter(i=>i.name&&i.value),highlights:u.highlights.filter(i=>i.trim()!=="")}))})),attributes:r.attributes.filter(s=>s.name&&s.value)};t(d,{onSuccess:s=>{V.success(s?.message||"Product created successfully"),b()},onError:s=>{V.error(s?.message||"Something went wrong")}})};return e.jsx("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:e.jsxs("form",{onSubmit:C(I),className:"bg-white rounded-xl shadow-lg p-4 sm:p-6 lg:p-8 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx("h2",{className:"col-span-1 sm:col-span-2 lg:col-span-3 text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6",children:"Add Product"}),e.jsx("div",{className:"col-span-1 sm:col-span-2 lg:col-span-3",children:e.jsx("input",{...a("name",{required:!0}),placeholder:"Product Name",className:"w-full border p-2 sm:p-3 rounded text-sm sm:text-base"})}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{...a("hsn",{required:"HSN Code is required",pattern:{value:/^[0-9]+$/,message:"HSN Code must contain only numbers"},minLength:{value:6,message:"HSN Code must be at least 6 digits"},maxLength:{value:8,message:"HSN Code cannot exceed 8 digits"}}),placeholder:"HSN Code",maxLength:8,inputMode:"numeric",className:"border p-2 sm:p-3 rounded text-sm sm:text-base w-full",onInput:r=>{const d=r.target;d.value=d.value.replace(/\D/g,"")}}),e.jsxs("select",{...a("tax",{required:!0}),className:"border p-2 sm:p-3 rounded text-sm sm:text-base w-full",children:[e.jsx("option",{value:"",children:"Select Tax Rate (GST)"}),e.jsx("option",{value:"0",children:"0%"}),e.jsx("option",{value:"5",children:"5%"}),e.jsx("option",{value:"12",children:"12%"}),e.jsx("option",{value:"18",children:"18%"}),e.jsx("option",{value:"18",children:"28%"})]})]}),e.jsxs("select",{...a("category_id",{required:!0}),className:"border p-2 sm:p-3 rounded text-sm sm:text-base w-full",children:[e.jsx("option",{value:"",children:"Select Category"}),c?.results?.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),e.jsxs("select",{...a("subCategory_id"),disabled:!x,className:"border p-2 sm:p-3 rounded text-sm sm:text-base w-full",children:[e.jsx("option",{value:"",children:"Select Subcategory"}),m?.results?.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),e.jsxs("select",{...a("brand_id",{required:!0}),disabled:!x,className:"border p-2 sm:p-3 rounded text-sm sm:text-base w-full",children:[e.jsx("option",{value:"",children:"Select Brand"}),h?.results?.map(r=>e.jsx("option",{value:r._id,children:r.name},r._id))]}),e.jsx("textarea",{...a("description"),placeholder:"Description",className:"col-span-1 sm:col-span-2 lg:col-span-3 border p-2 sm:p-3 rounded text-sm sm:text-base",rows:4}),e.jsx("div",{className:"col-span-1 sm:col-span-2 lg:col-span-3",children:e.jsx(D,{setValue:g})}),e.jsxs("fieldset",{className:"col-span-1 sm:col-span-2 lg:col-span-3 border p-3 sm:p-4 rounded",children:[e.jsx("legend",{className:"text-sm sm:text-base font-medium",children:"Attributes"}),A.map((r,d)=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-2",children:[e.jsx("input",{...a(`attributes.${d}.name`),placeholder:"Name",className:"border p-2 rounded flex-1 text-sm"}),e.jsx("input",{...a(`attributes.${d}.value`),placeholder:"Value",className:"border p-2 rounded flex-1 text-sm"}),e.jsx("button",{type:"button",onClick:()=>f(d),className:"bg-red-500 text-white px-3 py-1 rounded text-sm",children:"✕"})]},r.id)),e.jsx("button",{type:"button",onClick:()=>S({name:"",value:""}),className:"bg-green-500 text-white px-3 py-1 rounded text-sm",children:"+ Add Attribute"})]}),e.jsxs("fieldset",{className:"col-span-1 sm:col-span-2 lg:col-span-3 border p-3 sm:p-4 rounded",children:[e.jsx("legend",{className:"text-sm sm:text-base font-medium",children:"Manufacturing Info"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("input",{...a("manufacturingInfo.genericName"),placeholder:"Generic Name",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.countryOfOrigin"),placeholder:"Country of Origin",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.manufacturer.name"),placeholder:"Manufacturer Name",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.manufacturer.address"),placeholder:"Manufacturer Address",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.manufacturer.contact"),placeholder:"Manufacturer Contact",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.importer.name"),placeholder:"Importer Name",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.importer.address"),placeholder:"Importer Address",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.importer.contact"),placeholder:"Importer Contact",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.packer.name"),placeholder:"Packer Name",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.packer.address"),placeholder:"Packer Address",className:"border p-2 rounded text-sm"}),e.jsx("input",{...a("manufacturingInfo.packer.contact"),placeholder:"Packer Contact",className:"border p-2 rounded text-sm"})]})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-sm sm:text-base",children:"Variants"}),y.map((r,d)=>e.jsxs("div",{className:"border rounded p-3 sm:p-4 mb-4 bg-gray-50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-2",children:[e.jsx("input",{...a(`variants.${d}.color`),placeholder:"Color Name",className:"border p-2 rounded flex-1 text-sm"}),e.jsx("input",{type:"color",...a(`variants.${d}.colorCode`),className:"w-12 h-12 border rounded"})]}),e.jsx(B,{vIndex:d,setValue:g,getValues:v}),e.jsx(H,{control:p,name:`variants.${d}.sizes`,render:({field:s})=>e.jsxs("div",{className:"mt-3",children:[s.value.map((u,i)=>e.jsxs("div",{className:"border rounded p-3 mb-3 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-2",children:[e.jsx("input",{value:u.size,onChange:o=>{const l=[...s.value];l[i].size=o.target.value,s.onChange(l)},placeholder:"Size",className:"border p-2 rounded text-sm"}),e.jsx("input",{value:u.sizeName,onChange:o=>{const l=[...s.value];l[i].sizeName=o.target.value,s.onChange(l)},placeholder:"Size Name",className:"border p-2 rounded text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-2",children:[e.jsx("input",{type:"number",onChange:o=>{const l=[...s.value];l[i].original_price=Number(o.target.value),s.onChange(l)},placeholder:"Original Price",className:"border p-2 rounded text-sm"}),e.jsx("input",{type:"number",onChange:o=>{const l=[...s.value];l[i].sell_price=Number(o.target.value),s.onChange(l)},placeholder:"Sell Price",className:"border p-2 rounded text-sm"}),e.jsx("input",{type:"number",onChange:o=>{const l=[...s.value];l[i].stock=Number(o.target.value),s.onChange(l)},placeholder:"Stock",className:"border p-2 rounded text-sm"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block font-medium text-xs sm:text-sm mb-1",children:"Highlights"}),u.highlights?.map((o,l)=>e.jsx("input",{value:o,onChange:k=>{const N=[...s.value];N[i].highlights[l]=k.target.value,s.onChange(N)},placeholder:"Highlight",className:"border p-2 rounded w-full mb-1 text-sm"},l)),e.jsx("button",{type:"button",onClick:()=>{const o=[...s.value];o[i].highlights.push(""),s.onChange(o)},className:"bg-green-500 text-white px-2 py-1 rounded text-xs sm:text-sm",children:"+ Add Highlight"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-xs sm:text-sm mb-1",children:"Attributes"}),u.attributes?.map((o,l)=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-2",children:[e.jsx("input",{value:o.name,onChange:k=>{const N=[...s.value];N[i].attributes[l].name=k.target.value,s.onChange(N)},placeholder:"Attr Name",className:"border p-2 rounded flex-1 text-sm"}),e.jsx("input",{value:o.value,onChange:k=>{const N=[...s.value];N[i].attributes[l].value=k.target.value,s.onChange(N)},placeholder:"Attr Value",className:"border p-2 rounded flex-1 text-sm"})]},l)),e.jsx("button",{type:"button",onClick:()=>{const o=[...s.value];o[i].attributes.push({name:"",value:""}),s.onChange(o)},className:"bg-green-500 text-white px-2 py-1 rounded text-xs sm:text-sm",children:"+ Add Attribute"})]})]},i)),e.jsx("button",{type:"button",onClick:()=>s.onChange([...s.value,{size:"",sizeName:"",label:"",sku:"",stock:0,original_price:0,sell_price:0,highlights:[""],attributes:[{name:"",value:""}],isActive:!0}]),className:"bg-blue-500 text-white px-3 py-1 rounded text-sm mt-2",children:"+ Add Size"})]})}),e.jsx("button",{type:"button",onClick:()=>F(d),className:"bg-red-500 text-white px-3 py-1 mt-3 rounded text-sm",children:"Remove Variant"})]},r.id)),e.jsx("button",{type:"button",onClick:()=>_({color:"",colorCode:"#000000",images:[],sizes:[{size:"",sizeName:"",label:"",sku:"",stock:0,original_price:0,sell_price:0,highlights:[""],attributes:[{name:"",value:""}],isActive:!0}]}),className:"bg-blue-600 text-white px-4 py-2 rounded text-sm sm:text-base",children:"+ Add Variant"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-3 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",...a("isActive")}),e.jsx("label",{className:"text-sm sm:text-base",children:"Active"})]}),e.jsx("button",{type:"submit",disabled:n,className:"col-span-1 sm:col-span-2 lg:col-span-3 bg-blue-600 text-white py-2 sm:py-3 rounded text-sm sm:text-base",children:n?"Saving...":"Create Product"})]})})};export{G as default};
