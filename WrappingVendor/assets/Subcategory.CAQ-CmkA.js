import{o as U,m as k,z as C,a as A,e as o,j as e,k as _,q}from"./index.BKgSVtDm.js";import{u as z,a as D}from"./useCreateProduct.BTbAg1wz.js";import{u as I,P as T}from"./usePagination.baahLJht.js";import{X as E}from"./x.BWloLBIT.js";import{K as j}from"./transition.CcNEcUdy.js";import{h as v}from"./dialog.y9ZADTrG.js";import{h as N}from"./queryToast.BwL_GRjp.js";import{m as S}from"./proxy.0hlKgC4n.js";const O=()=>{const r=U();return k({mutationFn:async a=>{const i=new FormData;return i.append("name",a.name),i.append("category",a.category),a.image&&i.append("image",a.image),(await A.post("/subcategory",i,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:()=>{C.success("Subcategory created successfully!"),r.invalidateQueries({queryKey:["sub-category"]})},onError:a=>{C.error(a?.response?.data?.error||a?.message||"Failed to create subcategory")}})},K=()=>k({mutationFn:async({id:r,data:a})=>{const i=new FormData;return Object.keys(a).forEach(s=>{i.append(s,String(a[s]??""))}),(await A.put(`/update-subcategory/${r}`,i)).data}}),M=({isOpen:r,categories:a,isCategoriesLoading:i,isUpdate:l=!1,data:s,isDisabled:f,onSubmit:h,onClose:u})=>{const[d,x]=o.useState(""),[c,m]=o.useState(""),[g,p]=o.useState(null);o.useEffect(()=>{r||(x(""),m(""),p(null)),s&&l&&(x(s.name||""),m(s?.category?._id||""),p(null))},[r,s,l]);const y=async n=>{if(n.preventDefault(),!d||!c){alert("Please fill all required fields");return}await h({name:d,category:c,image:g||void 0,isActive:s?.isActive||!0})};return e.jsx(j,{appear:!0,show:r,as:o.Fragment,children:e.jsxs(v,{as:"div",className:"relative z-50",onClose:u,children:[e.jsx(j.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(j.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(v.Panel,{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(v.Title,{className:"text-lg font-semibold",children:"Add New Subcategory"}),e.jsx("button",{type:"button",onClick:u,className:"rounded-full p-1 hover:bg-gray-100",children:e.jsx(E,{size:20})})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcategory Name"}),e.jsx("input",{type:"text",value:d,onChange:n=>x(n.target.value),placeholder:"Enter subcategory name",className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category"}),i?e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading categories..."}):e.jsxs("select",{value:c,onChange:n=>m(n.target.value),className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),a.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcategory Image (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:n=>p(n.target.files?.[0]||null),className:"w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-pink-500"}),g&&e.jsx("img",{src:URL.createObjectURL(g),alt:"Preview",className:"w-20 h-20 object-cover rounded-lg mt-2 border"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"px-4 py-2 rounded-lg text-white bg-pink-600 hover:bg-pink-700 transition",children:"Add Subcategory"})]})]})]})})})]})})},J=()=>{const[r,a]=o.useState(""),[i,l]=o.useState(!1),[s,f]=o.useState({isUpdate:!1,data:null}),{data:h,isLoading:u}=z(),{data:d,isLoading:x,refetch:c}=D(r),m=O(),{pageNumber:g,pageSizeValue:p,handlePageChange:y,handlePageSizeChange:n}=I(),{mutateAsync:w,isPending:F}=K(),P=async(t,b)=>{w({id:t,data:{isActive:!b}},N(c)),C.success("Status updated successfully!"),q.invalidateQueries({queryKey:["sub-category"]})},L=async t=>{s.isUpdate&&s?.data?._id?w({id:s.data?._id,data:t},N(c,()=>l(!1))):m.mutate(t,N(c,()=>l(!1)))};return u||x?e.jsx(_,{}):e.jsxs("div",{className:"sm:p-4 p-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("select",{value:r,onChange:t=>a(t.target.value),className:"border rounded-md p-2",children:[e.jsx("option",{value:"",children:"All Categories"}),h?.results.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx("button",{onClick:()=>l(!0),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md font-medium transition",children:"+ Add Subcategory"})]}),e.jsx("div",{className:"overflow-x-auto max-h-[400px] rounded-lg shadow-sm",children:e.jsxs("table",{className:"min-w-full text-sm bg-white",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left font-medium",children:"S.No"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Image"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Name"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Category"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"p-3 text-left font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:d?.results.map((t,b)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 transition-all duration-200",children:[e.jsx("td",{className:"p-3",children:(g-1)*p+(b+1)}),e.jsx("td",{className:"p-3",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-12 h-12 object-cover rounded-md border"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md flex items-center justify-center text-gray-500 text-xs",children:"No Image"})}),e.jsx("td",{className:"p-3 font-medium",children:t.name}),e.jsx("td",{className:"p-3 font-medium",children:t?.category?.name}),e.jsx("td",{className:"p-3",children:e.jsxs(S.label,{whileTap:{scale:.9},className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:!!t.isActive,onChange:()=>P(t._id,!!t.isActive),disabled:F}),e.jsx(S.div,{layout:!0,transition:{type:"spring",stiffness:500,damping:30},className:`w-11 h-6 rounded-full relative transition-colors duration-300 ${t.isActive?"bg-green-500":"bg-gray-300"}`,children:e.jsx(S.div,{layout:!0,transition:{type:"spring",stiffness:400,damping:25},className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow ${t.isActive?"left-[22px]":"left-[2px]"}`})})]})}),e.jsx("td",{className:"p-3 ",children:e.jsx("button",{onClick:()=>{f({isUpdate:!0,data:t}),l(!0)},className:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition",children:"Edit"})})]},t._id))})]})}),d?.pagination&&e.jsx(T,{currentPage:g,handlePageChange:y,pageSize:p,handlePageSizeChange:n,totalCount:d.pagination.total}),e.jsx(M,{isOpen:i,onClose:()=>l(!1),categories:h?.results??[],isCategoriesLoading:u,onSubmit:L,isUpdate:s?.isUpdate,data:s?.data,isDisabled:m.isPending})]})};export{J as default};
