import{d as M,e as Q,r as p,j as e,t as U,E as L}from"./index.BNJSppEy.js";import{u as V,P as H}from"./usePagination.bWlYJ0eN.js";import{P as q}from"./PageHeadline.CG_ofrIJ.js";import{u as B}from"./useModal.v0S6QYWh.js";import{C as G}from"./copy.BqbFyPqA.js";import{X as K}from"./x.DUQwiwRc.js";import{K as y}from"./transition.DPGECD_O.js";import{h}from"./dialog.CH8CcuPB.js";const $=(r={})=>{const d=r.pageNumber??1,t=r.pageSize??10,l=r.status??"all",n=r.searchQuery??"";return M({queryKey:["withdrawals",l,n,d,t],queryFn:async()=>{const i={pageNumber:d,pageSize:t};return l&&l!=="all"&&(i.status=l),n&&n.trim()&&(i.searchQuery=n.trim()),(await Q.get("/withdrawals",{params:i})).data}})},b=r=>typeof r!="number"?"N/A":new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(r),W=({isOpen:r,onClose:d,orderData:t})=>{const[l,n]=p.useState(!1),i=async a=>{if(a)try{await navigator.clipboard.writeText(a),n(!0),setTimeout(()=>n(!1),1500)}catch(x){console.error("Failed to copy text: ",x)}};return t?e.jsx(y,{appear:!0,show:r,as:p.Fragment,children:e.jsxs(h,{as:"div",className:"relative z-50",onClose:d,children:[e.jsx(y.Child,{as:p.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-900/50"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(y.Child,{as:p.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(h.Panel,{className:"w-full max-w-2xl rounded-lg bg-white shadow-2xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx(h.Title,{className:"text-lg font-semibold text-gray-900",children:"Order Details"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Details from the selected order"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>i(t._id),title:"Copy Order ID",className:"flex items-center gap-1 px-3 py-1 rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 text-xs transition-colors",children:[e.jsx(G,{size:14}),e.jsx("span",{children:l?"Copied!":"Copy ID"})]}),e.jsx("button",{type:"button",onClick:d,className:"p-1 rounded-full hover:bg-gray-200",children:e.jsx(K,{size:20,className:"text-gray-600"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Order ID"}),e.jsx("div",{className:"font-medium text-gray-900 break-all",title:t._id,children:t._id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Transaction ID"}),e.jsx("div",{className:"font-medium text-gray-900 break-all",title:t.transaction_id,children:t.transaction_id??"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total Amount"}),e.jsx("div",{className:"font-medium text-gray-900",children:b(t.totalAmount)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Payment Status"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.paymentStatus??"N/A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Order Status"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.orderStatus??"N/A"})]})]}),t.shippingAddress&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Shipping Address"}),e.jsxs("div",{className:"text-gray-900",children:[e.jsx("div",{className:"font-medium",children:t.shippingAddress.name}),e.jsx("div",{className:"text-sm text-gray-600 break-words",children:[t.shippingAddress.addressLine1,t.shippingAddress.addressLine2,t.shippingAddress.city,t.shippingAddress.state,t.shippingAddress.postalCode,t.shippingAddress.country].filter(Boolean).join(", ")}),t.shippingAddress.phone&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Phone: ",t.shippingAddress.phone]})]})]}),t.items&&t.items.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Items"}),e.jsx("div",{className:"space-y-4 max-h-64 overflow-y-auto",children:t.items.map((a,x)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden bg-white border",children:a.image?e.jsx("img",{src:a.image,alt:a.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full text-xs text-gray-400",children:"No image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 line-clamp-2 break-words",title:a.name,children:a.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1 flex flex-wrap gap-3",children:[e.jsxs("div",{children:["Qty: ",a.quantity??"N/A"]}),a.invoiceNo&&e.jsxs("div",{children:["Invoice: ",e.jsx("span",{className:"break-all",children:a.invoiceNo})]}),typeof a.price=="number"&&e.jsxs("div",{children:["Price: ",b(a.price)]})]})]})]},x))})]}):e.jsx("div",{className:"text-xs text-gray-500",children:"No items info available"})]}),e.jsx("div",{className:"flex justify-end p-4 bg-gray-50 border-t border-gray-200",children:e.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Close"})})]})})})]})}):null},ae=()=>{const[r,d]=p.useState("all"),[t,l]=p.useState(""),{startItem:n,handlePageChange:i,handlePageSizeChange:a,pageNumber:x,pageSizeValue:N}=V(),v=r==="all"?void 0:r,{data:f,isLoading:A,isError:C,error:S}=$({pageNumber:x,pageSize:N,status:v,searchQuery:t}),{data:P,isModalOpen:j,openModal:I,closeModal:T}=B();if(A)return e.jsx(U,{});if(C)return e.jsx(L,{message:S?.message||"Failed to load transactions"});const u=f?.withdrawals||[],o=f?.pagination,O=s=>{switch(s?.toLowerCase()){case"success":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},F=s=>{const m={RAZORPAY:"bg-blue-100 text-blue-800",PAYTM:"bg-indigo-100 text-indigo-800",STRIPE:"bg-purple-100 text-purple-800",OTHER:"bg-gray-100 text-gray-800"};return m[s||"OTHER"]||m.OTHER},R=s=>s?new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",g=s=>typeof s!="number"?"N/A":new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(s),k=s=>s?typeof s=="string"?s:s.orderNumber||s.items?.[0]?.invoiceNo||s.transaction_id||s._id||"N/A":"N/A",w=s=>s.amount>0?s.amount:s.orderId?.totalAmount||0,z=s=>{if(s.userId?.username)return s.userId.username;const c=s.orderId?.user;return c?typeof c=="object"?c.username||String(c._id)||"N/A":String(c):"N/A"},E=s=>{if(s.userId?.email)return s.userId.email;const c=s.orderId?.user;return c&&typeof c=="object"&&c.email||"N/A"},_=s=>{s.preventDefault(),i(1,o?.totalPages||1)};return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(q,{title:"Transactions"}),e.jsx("form",{onSubmit:_,className:"mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:s=>l(s.target.value),placeholder:"Search by Transaction ID, Gateway, or UTR Number...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Search"}),t&&e.jsx("button",{type:"button",onClick:()=>{l(""),i(1,o?.totalPages||1)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Clear"})]})}),e.jsx("div",{className:"mb-6 flex gap-2 border-b",children:["all","pending","success","failed"].map(s=>e.jsx("button",{onClick:()=>{d(s),i(1,o?.totalPages||1)},className:`px-4 py-2 font-medium capitalize transition-colors ${r===s?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:s},s))}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Transaction ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Charge"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Gateway"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"UTR"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-8 text-center text-gray-500",children:"No transactions found"})}):u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:s.transactionId}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:z(s)}),e.jsx("div",{className:"text-xs text-gray-400",children:E(s)})]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:k(s.orderId)}),e.jsx("div",{className:"text-xs text-gray-400",children:g(w(s))})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold",children:g(s.amount)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-red-600 font-medium",children:["-",g(s.charge)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs font-semibold rounded-full ${F(s.gatewayName)}`,children:s.gatewayName})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.utrNumber||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs font-semibold rounded-full ${O(s.status)}`,children:s.status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:R(s.createdAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:m=>{m.stopPropagation(),I({isUpdate:!0},s)},className:"p-2 rounded hover:bg-gray-100",title:"View",children:e.jsx("span",{className:"material-symbols-outlined text-gray-600",children:"visibility"})})})]},s._id))})]})}),o&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",n," to ",Math.min(n+u.length-1,o.totalRecords)," of ",o.totalRecords," results"]}),e.jsx("div",{children:e.jsx(H,{currentPage:x,handlePageChange:s=>i(s,o.totalPages),pageSize:N,handlePageSizeChange:s=>{a(s)},totalCount:o.totalRecords})})]}),e.jsx(W,{isOpen:!!(j.isCreate||j.isUpdate),onClose:()=>T({isCreate:!1,isUpdate:!1}),orderData:P?.orderId})]})};export{ae as default};
