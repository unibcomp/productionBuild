import{e as g,o as C,u as h,m as A,z as i,a as c,j as e,k as D,E as q}from"./index.saRe6un4.js";import{P as R}from"./PageHeadline.DEQVQ-lh.js";const E=()=>{const[p,o]=g.useState(!1),[s,a]=g.useState({userId:"",orderId:"",amount:0,charge:0,transactionId:"",gatewayName:"RAZORPAY",utrNumber:"",status:"pending"}),u=C(),{data:b}=h({queryKey:["withdrawal-stats"],queryFn:async()=>(await c.get("/withdrawals/stats")).data}),{data:y,isLoading:f,isError:N,error:j}=h({queryKey:["settlements"],queryFn:async()=>(await c.get("/withdrawals",{params:{status:"success",pageNumber:1,pageSize:50}})).data}),d=A({mutationFn:async t=>(await c.post("/withdrawals",t)).data,onSuccess:()=>{i.success("Withdrawal request created successfully"),u.invalidateQueries({queryKey:["settlements"]}),u.invalidateQueries({queryKey:["withdrawal-stats"]}),o(!1),x()},onError:t=>{i.error(t?.response?.data?.message||"Failed to create withdrawal request")}}),x=()=>{a({userId:"",orderId:"",amount:0,charge:0,transactionId:"",gatewayName:"RAZORPAY",utrNumber:"",status:"pending"})},v=t=>{if(t.preventDefault(),!s.userId||!s.orderId||!s.transactionId){i.error("Please fill all required fields");return}if(s.amount<=0){i.error("Amount must be greater than 0");return}const l={...s};l.utrNumber||delete l.utrNumber,d.mutate(l)};if(f)return e.jsx(D,{});if(N)return e.jsx(q,{message:j?.message||"Failed to load settlements"});const m=y?.withdrawals||[],n=b||{counts:{pending:0,success:0,failed:0},amounts:{totalAmountDisbursed:0,totalChargesCollected:0}},r=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t),w=t=>new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),I=(t,l)=>t-l;return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(R,{title:"Settlements"}),e.jsx("button",{onClick:()=>o(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Create Withdrawal"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Total Disbursed"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r(n.amounts.totalAmountDisbursed)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[n.counts.success," successful withdrawals"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Total Charges"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r(n.amounts.totalChargesCollected)}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Platform fees collected"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:n.counts.pending}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Awaiting processing"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Failed"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.counts.failed}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Failed transactions"})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Transaction ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Charge"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Net Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Gateway"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"UTR Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Settlement Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-8 text-center text-gray-500",children:"No successful settlements found"})}):m.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.transactionId}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:t.userId?.username||"N/A"}),e.jsx("div",{className:"text-xs text-gray-400",children:t.orderId?.transaction_id||t.orderId?._id||"N/A"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold",children:t.orderId?.totalAmount?r(t.orderId.totalAmount):"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-red-600 font-medium",children:["-",r(t.charge)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-green-600 font-bold",children:r(I(t.amount,t.charge))}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-semibold",children:t.gatewayName})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.utrNumber||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:w(t.updatedAt)})]},t._id))})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create Withdrawal Request"}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["User ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.userId,onChange:t=>a({...s,userId:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter user ID"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Order ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.orderId,onChange:t=>a({...s,orderId:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter order ID"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Amount (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:s.amount,onChange:t=>a({...s,amount:parseFloat(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter amount"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Charge (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:s.charge,onChange:t=>a({...s,charge:parseFloat(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter charge"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Transaction ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:s.transactionId,onChange:t=>a({...s,transactionId:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter transaction ID"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Gateway ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:s.gatewayName,onChange:t=>a({...s,gatewayName:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"RAZORPAY",children:"Razorpay"}),e.jsx("option",{value:"PAYTM",children:"Paytm"}),e.jsx("option",{value:"STRIPE",children:"Stripe"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"UTR Number"}),e.jsx("input",{type:"text",value:s.utrNumber,onChange:t=>a({...s,utrNumber:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter UTR number (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>a({...s,status:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"failed",children:"Failed"})]})]})]}),s.amount>0&&s.charge>=0&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Net Amount to Disburse:"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:r(s.amount-s.charge)})]})}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{o(!1),x()},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:d.isPending,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d.isPending,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:d.isPending?"Creating...":"Create Withdrawal"})]})]})]})})]})};export{E as default};
