import{u as K,o as B,m as G,z as w,a as P,e as m,j as e,i as $,E as Y}from"./index.BotYvSpe.js";import{u as X,P as Z}from"./usePagination.BaXlVQtp.js";import{P as J}from"./PageHeadline.DB_YZffS.js";import{u as A}from"./useModal.2i5g76cV.js";import{C as D}from"./copy.B3A66zAe.js";import{X as ee}from"./x.B7ELbNjt.js";import{K as b}from"./transition.0iHX1zZq.js";import{h as f}from"./dialog.CXerei8I.js";const se=(a={})=>{const i=a.pageNumber??1,t=a.pageSize??10,d=a.status??"all",l=a.searchQuery??"";return K({queryKey:["withdrawals",d,l,i,t],queryFn:async()=>{const r={pageNumber:i,pageSize:t};return d&&d!=="all"&&(r.status=d),l&&l.trim()&&(r.searchQuery=l.trim()),(await P.get("/withdrawals",{params:r})).data}})},te=()=>{const a=B();return G({mutationFn:async i=>(await P.post("/withdrawals",{amount:i})).data,onSuccess:()=>{w.success("Withdrawal created successfully"),a.invalidateQueries({queryKey:["withdrawals"],exact:!1}),a.invalidateQueries({queryKey:["withdrawal-stats"],exact:!1})},onError:i=>{const t=i?.response?.data?.message||i?.response?.data?.error||"Failed to create withdrawal";w.error(t)}})},S=a=>typeof a!="number"?"N/A":new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(a),ae=({isOpen:a,onClose:i,orderData:t})=>{const[d,l]=m.useState(!1),r=async n=>{if(n)try{await navigator.clipboard.writeText(n),l(!0),setTimeout(()=>l(!1),1500)}catch(c){console.error("Failed to copy text: ",c)}};return t?e.jsx(b,{appear:!0,show:a,as:m.Fragment,children:e.jsxs(f,{as:"div",className:"relative z-50",onClose:i,children:[e.jsx(b.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-900/50"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(b.Child,{as:m.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(f.Panel,{className:"w-full max-w-2xl rounded-lg bg-white shadow-2xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx(f.Title,{className:"text-lg font-semibold text-gray-900",children:"Order Details"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Details from the selected order"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>r(t._id),title:"Copy Order ID",className:"flex items-center gap-1 px-3 py-1 rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 text-xs transition-colors",children:[e.jsx(D,{size:14}),e.jsx("span",{children:d?"Copied!":"Copy ID"})]}),e.jsx("button",{type:"button",onClick:i,className:"p-1 rounded-full hover:bg-gray-200",children:e.jsx(ee,{size:20,className:"text-gray-600"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Order ID"}),e.jsx("div",{className:"font-medium text-gray-900 break-all",title:t._id,children:t._id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Transaction ID"}),e.jsx("div",{className:"font-medium text-gray-900 break-all",title:t.transaction_id,children:t.transaction_id??"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Total Amount"}),e.jsx("div",{className:"font-medium text-gray-900",children:S(t.totalAmount)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Payment Status"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.paymentStatus??"N/A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Order Status"}),e.jsx("div",{className:"font-medium text-gray-900",children:t.orderStatus??"N/A"})]})]}),t.shippingAddress&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Shipping Address"}),e.jsxs("div",{className:"text-gray-900",children:[e.jsx("div",{className:"font-medium",children:t.shippingAddress.name}),e.jsx("div",{className:"text-sm text-gray-600 break-words",children:[t.shippingAddress.addressLine1,t.shippingAddress.addressLine2,t.shippingAddress.city,t.shippingAddress.state,t.shippingAddress.postalCode,t.shippingAddress.country].filter(Boolean).join(", ")}),t.shippingAddress.phone&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Phone: ",t.shippingAddress.phone]})]})]}),t.items&&t.items.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Items"}),e.jsx("div",{className:"space-y-4 max-h-64 overflow-y-auto",children:t.items.map((n,c)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden bg-white border",children:n.image?e.jsx("img",{src:n.image,alt:n.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full text-xs text-gray-400",children:"No image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 line-clamp-2 break-words",title:n.name,children:n.name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1 flex flex-wrap gap-3",children:[e.jsxs("div",{children:["Qty: ",n.quantity??"N/A"]}),n.invoiceNo&&e.jsxs("div",{children:["Invoice: ",e.jsx("span",{className:"break-all",children:n.invoiceNo})]}),typeof n.price=="number"&&e.jsxs("div",{children:["Price: ",S(n.price)]})]})]})]},c))})]}):e.jsx("div",{className:"text-xs text-gray-500",children:"No items info available"})]}),e.jsx("div",{className:"flex justify-end p-4 bg-gray-50 border-t border-gray-200",children:e.jsx("button",{onClick:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Close"})})]})})})]})}):null},re=({isOpen:a,onClose:i,onSuccess:t})=>{const[d,l]=m.useState(""),r=te();if(!a)return null;const n=u=>{u.preventDefault();const g=parseFloat(d);!d||isNaN(g)||g<=0||r.mutate(g,{onSuccess:()=>{l(""),t(),i()}})},c=()=>{r.isPending||(l(""),i())};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:c}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New Withdrawal"}),e.jsx("button",{onClick:c,disabled:r?.isPending,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),e.jsxs("form",{onSubmit:n,className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-2",children:["Amount (â‚¹) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"amount",type:"number",step:"0.01",min:"0",value:d,onChange:u=>l(u.target.value),placeholder:"Enter withdrawal amount",disabled:r?.isPending,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",autoFocus:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter the amount you want to withdraw"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4",children:[e.jsx("button",{type:"button",onClick:c,disabled:r?.isPending,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:r?.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined animate-spin",children:"progress_activity"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Create Withdrawal"]})})]})]})]})]})},ue=()=>{const[a,i]=m.useState("all"),[t,d]=m.useState(""),{startItem:l,handlePageChange:r,handlePageSizeChange:n,pageNumber:c,pageSizeValue:u}=X(),g=a==="all"?void 0:a,{data:N,isLoading:F,isError:I,error:T,refetch:j}=se({pageNumber:c,pageSize:u,status:g,searchQuery:t}),{data:k,isModalOpen:v,openModal:O,closeModal:M}=A(),{isModalOpen:z,openModal:R,closeModal:C}=A();if(F)return e.jsx($,{});if(I)return e.jsx(Y,{message:T?.message||"Failed to load transactions"});const h=N?.withdrawals||[],x=N?.pagination,E=s=>{switch(s?.toLowerCase()){case"success":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},_=s=>{const p={RAZORPAY:"bg-blue-100 text-blue-800",PAYTM:"bg-indigo-100 text-indigo-800",STRIPE:"bg-purple-100 text-purple-800",OTHER:"bg-gray-100 text-gray-800"};return p[s||"OTHER"]||p.OTHER},Q=s=>s?new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",y=s=>typeof s!="number"?"N/A":new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(s),W=s=>s?typeof s=="string"?s:s.orderNumber||s.items?.[0]?.invoiceNo||s.transaction_id||s._id||"N/A":"N/A",U=s=>s.amount>0?s.amount:s.orderId?.totalAmount||0,V=s=>{if(s.userId?.username)return s.userId.username;const o=s.orderId?.user;return o?typeof o=="object"?o.username||String(o._id)||"N/A":String(o):"N/A"},q=s=>{if(s.userId?.email)return s.userId.email;const o=s.orderId?.user;return o&&typeof o=="object"&&o.email||"N/A"},L=s=>{s.preventDefault(),r(1,x?.totalPages||1)},H=()=>{C({isCreate:!1}),j&&j()};return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(J,{title:"Transactions"}),e.jsxs("button",{onClick:()=>R({isCreate:!0}),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Add Withdrawal"]})]}),e.jsx("form",{onSubmit:L,className:"mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:s=>d(s.target.value),placeholder:"Search by Transaction ID, Gateway, or UTR Number...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Search"}),t&&e.jsx("button",{type:"button",onClick:()=>{d(""),r(1,x?.totalPages||1)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Clear"})]})}),e.jsx("div",{className:"mb-6 flex gap-2 border-b",children:["all","pending","success","failed"].map(s=>e.jsx("button",{onClick:()=>{i(s),r(1,x?.totalPages||1)},className:`px-4 py-2 font-medium capitalize transition-colors ${a===s?"border-b-2 border-blue-500 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:s},s))}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Transaction ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Charge"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Gateway"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"UTR"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-8 text-center text-gray-500",children:"No transactions found"})}):h.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:s.transactionId}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:V(s)}),e.jsx("div",{className:"text-xs text-gray-400",children:q(s)})]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:W(s.orderId)}),e.jsx("div",{className:"text-xs text-gray-400",children:y(U(s))})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold",children:y(s.amount)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-red-600 font-medium",children:["-",y(s.charge)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs font-semibold rounded-full ${_(s.gatewayName)}`,children:s.gatewayName})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.utrNumber||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs font-semibold rounded-full ${E(s.status)}`,children:s.status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:Q(s.createdAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:p=>{p.stopPropagation(),O({isUpdate:!0},s)},className:"p-2 rounded hover:bg-gray-100",title:"View",children:e.jsx("span",{className:"material-symbols-outlined text-gray-600",children:"visibility"})})})]},s._id))})]})}),x&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",l," to ",Math.min(l+h.length-1,x.totalRecords)," of ",x.totalRecords," results"]}),e.jsx("div",{children:e.jsx(Z,{currentPage:c,handlePageChange:s=>r(s,x.totalPages),pageSize:u,handlePageSizeChange:s=>{n(s)},totalCount:x.totalRecords})})]}),e.jsx(ae,{isOpen:!!(v.isCreate||v.isUpdate),onClose:()=>M({isCreate:!1,isUpdate:!1}),orderData:k?.orderId}),e.jsx(re,{isOpen:!!z.isCreate,onClose:()=>C({isCreate:!1}),onSuccess:H})]})};export{ue as default};
