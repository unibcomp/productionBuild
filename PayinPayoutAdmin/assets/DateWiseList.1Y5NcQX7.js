import{q as G,j as e,z as P,r as S,s as N,x as U,f as Q,g as L,P as k,L as B,o as W,p as Y,u as K,h as $,e as H,l as J,a as X,m as z,c as Z,S as _,N as ee,d as se,C as te,V as T}from"./index.Da7InqlT.js";import{a as ae,d as re,u as ne}from"./useDeposit._rqXxrup.js";import{D as ie}from"./DateWiseTableBody.BsFTW4MZ.js";import{a as oe,M as le}from"./MpinVerifyModal.Bu-RyFZj.js";import{u as ce}from"./useManualPayin.CDnJqPiJ.js";import"./permission.BxkFSEB9.js";import"./useMpin.Cr-08znS.js";const de=({transaction_id:n,closeModal:r,isOpen:c})=>{const{register:d,handleSubmit:j,formState:{errors:h}}=G(),{createUpdateUtrMutation:s}=ce(),w=C=>{s.mutate({transaction_id:n,data:C},{onError:m=>{var t;const a=(t=m.response)==null?void 0:t.data;U.error((a==null?void 0:a.message)||(a==null?void 0:a.error)),r()},onSuccess:m=>{U.success(m.message||"SuccesFully Updated")}})};return e.jsx(P,{appear:!0,show:c,as:S.Fragment,children:e.jsxs(N,{as:"div",className:"relative z-50",onClose:r,children:[e.jsx(P.Child,{as:S.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(N.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded bg-white p-6 shadow-xl transition-all",children:[e.jsx(N.Title,{className:"text-lg font-medium text-gray-900 mb-4",children:"Update Utr"}),e.jsxs("form",{onSubmit:j(w),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("input",{type:"number",...d("utr",{required:"Utr is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter Utr Number"}),h.utr&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:h.utr.message})]}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-[#185e91] hover:bg-[#144e7a] text-white font-semibold rounded-md transition cursor-pointer",children:s.isPending?"Processing...":"Submit"})]})]})})})]})})},ue=(n,r,c=!0)=>Q({queryKey:["taxReportByTransaction",n,r],enabled:c&&!!n&&!!r,queryFn:async()=>{const d=await L.get("/tax-report-specific-transaction",{params:{transaction_id:n,type:r}});if(!d.data.success||!d.data.data)throw new Error("No tax data found");return d.data.data}});function pe({isOpen:n,onClose:r,type:c,transaction_id:d}){const{data:j,isLoading:h}=ue(d,c,n),s=j,w=((s==null?void 0:s.companyTaxAmount)??0)+((s==null?void 0:s.gstApplyAmount)??0)+((s==null?void 0:s.resellerTaxAmount)??0)+((s==null?void 0:s.resellerGstAmount)??0);return e.jsx(P,{appear:!0,show:n,as:S.Fragment,children:e.jsxs(N,{as:"div",className:"relative z-50",onClose:r,children:[e.jsx(P.Child,{as:S.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-6",children:e.jsx(N.Panel,{className:"w-full max-w-xl transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all border border-blue-100",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsx(k,{title:"ðŸ§¾ Tax Transaction Details"}),e.jsxs("div",{className:"my-6 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 font-semibold mb-1",children:["Type: ",e.jsx("span",{className:"text-gray-800",children:c})]}),e.jsxs("div",{className:"text-sm text-gray-600 font-semibold",children:["Transaction ID:"," ",e.jsx("span",{className:"text-gray-800",children:d})]})]}),h?e.jsx(B,{}):e.jsxs("div",{className:"grid grid-cols-1 gap-2 max-h-[58vh] overflow-y-auto",children:[e.jsx(M,{label:"Total Amount",value:w||0}),e.jsx(M,{label:"Gateway Charges",value:(s==null?void 0:s.companyTaxAmount)||0}),e.jsx(M,{label:"Gateway GST",value:(s==null?void 0:s.gstApplyAmount)||0}),e.jsx(M,{label:"Company Charges",value:(s==null?void 0:s.resellerTaxAmount)||0}),e.jsx(M,{label:"Company GST",value:(s==null?void 0:s.resellerGstAmount)||0})]}),e.jsx("div",{className:"flex justify-end pt-10",children:e.jsx("button",{onClick:r,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md shadow-sm text-sm font-medium transition",children:"Close"})})]})})})})]})})}function M({label:n,value:r}){return e.jsxs("div",{className:"bg-white border border-gray-200 p-3 rounded-xl shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1",children:n}),e.jsxs("p",{className:"text-base text-gray-800 font-medium",children:["â‚¹ ",(r==null?void 0:r.toFixed(2))??"â€”"]})]})}const me=()=>{const n=W();return Y({mutationFn:async r=>(await L.put("/mannaul-paydollar-update-deposit/",r)).data,onSuccess:()=>{n.invalidateQueries({queryKey:["AllDeposits"]})}})},xe=({transaction_id:n,isOpen:r,closeModal:c,amount:d,payMethod:j,action:h,payRef:s,utr:w,completedAt:C,MannualBy:m})=>{const{register:a,handleSubmit:t,formState:{errors:i},watch:u}=G({defaultValues:{action:h,payRef:s,payMethod:j,utr:w,completedAt:C,MannualBy:m},shouldUnregister:!1}),y=me(),f=u("action"),E=x=>{const g={transaction_id:n,amount:d,action:x.action};(x.action==="SUCCESS"||x.action==="FAILED")&&(g.MannualBy=x.MannualBy),x.action==="SUCCESS"&&(g.payMethod=x.payMethod,g.payRef=x.payRef,g.utr=x.utr,g.completedAt=x.completedAt),y.mutate(g,{onSuccess:v=>{U.success(v.message||"Deposit updated successfully!"),c()},onError:v=>{var o;const b=(o=v.response)==null?void 0:o.data;U.error((b==null?void 0:b.message)||(b==null?void 0:b.error)||"Something went wrong"),c()}})};return e.jsx(P,{appear:!0,show:r,as:S.Fragment,children:e.jsxs(N,{as:"div",className:"relative z-50",onClose:c,children:[e.jsx(P.Child,{as:S.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(N.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded bg-white p-6 shadow-xl transition-all",children:[e.jsx(N.Title,{className:"text-lg font-medium text-gray-900 mb-2",children:"Manual Update Deposit"}),e.jsxs("form",{onSubmit:t(E),className:"space-y-5",children:[e.jsx("div",{children:e.jsx("input",{type:"text",value:n,disabled:!0,className:"w-full py-2 px-3 rounded-md bg-gray-100 text-gray-700 border border-gray-300 focus:outline-none",placeholder:"Transaction ID"})}),e.jsx("div",{children:e.jsx("input",{type:"number",value:d,disabled:!0,className:"w-full py-2 px-3 rounded-md bg-gray-100 text-gray-700 border border-gray-300 focus:outline-none",placeholder:"Amount"})}),e.jsxs("div",{children:[e.jsxs("select",{...a("action",{required:"Action is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Action"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"INITIATED",children:"INITIATED"}),e.jsx("option",{value:"PROCESSING",children:"PROCESSING"}),e.jsx("option",{value:"FAILED",children:"FAILED"}),e.jsx("option",{value:"SUCCESS",children:"SUCCESS"})]}),i.action&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.action.message})]}),(f==="SUCCESS"||f==="FAILED")&&e.jsxs("div",{children:[e.jsx("input",{type:"text",...a("MannualBy",{required:"Please enter your name"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter Your Name"}),i.MannualBy&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.MannualBy.message})]}),f==="SUCCESS"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("select",{...a("payMethod",{required:"Pay Method is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Pay Method"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"UPICC",children:"UPICC"}),e.jsx("option",{value:"Debit Card",children:"Debit Card"}),e.jsx("option",{value:"Credit Card",children:"Credit Card"}),e.jsx("option",{value:"wallet",children:"Wallet"})]}),i.payMethod&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.payMethod.message})]}),e.jsxs("div",{children:[e.jsx("input",{type:"text",...a("payRef",{required:"Pay Reference is required"}),defaultValue:s,className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter Pay Reference"}),i.payRef&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.payRef.message})]}),e.jsxs("div",{children:[e.jsx("input",{type:"text",...a("utr",{required:"UTR is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter UTR Number"}),i.utr&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.utr.message})]}),e.jsxs("div",{children:[e.jsx("input",{type:"datetime-local",...a("completedAt",{required:"Completed At is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none"}),i.completedAt&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:i.completedAt.message})]})]}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-[#185e91] hover:bg-[#144e7a] text-white font-semibold rounded-md transition cursor-pointer",children:y.isPending?"Processing...":"Submit"})]})]})})})]})})},we=()=>{var q,V;const[n,r]=S.useState("All"),c=["All","GATEPAY","PAYU"],{handlePageChange:d,handlePageSizeChange:j,pageNumber:h,pageSizeValue:s,startItem:w}=K(),{openModal:C,isModalOpen:m,closeModal:a,data:t}=$(),{date:i,status:u,type:y}=H(),{user:f}=J(),E=y==="Pay-In",{setSearchQuery:x,searchQuery:g}=X(),{updateDepositMutation:v}=ae(),{updateReverseMutation:b}=re(),{data:o,isError:D,isLoading:I,refetch:R}=y==="Pay-In"?ne({searchQuery:g,pageNumber:h,pageSize:s,date:i,status:u==null?void 0:u.toUpperCase(),gateway:n},E):oe({searchQuery:g,pageNumber:h,pageSize:s,date:i,status:u==null?void 0:u.toUpperCase()}),O=l=>{l!=null&&l.transaction_id&&(l!=null&&l.isReverse)?b.mutate(l.transaction_id,{onSuccess:()=>{R(),T.success("Action  Completed SuccessFully"),a({isVerifyMpin:!1})},onError:F=>{var A;const p=(A=F.response)==null?void 0:A.data;T.error((p==null?void 0:p.message)||(p==null?void 0:p.error)),a({isVerifyMpin:!1})}}):v.mutate(l,{onSuccess:()=>{R(),T.success("Action  Completed SuccessFully"),a({isVerifyMpin:!1})},onError:F=>{var A;const p=(A=F.response)==null?void 0:A.data;T.error((p==null?void 0:p.message)||(p==null?void 0:p.error)),a({isVerifyMpin:!1})}})};return e.jsxs(z.div,{className:"bg-white shadow-lg rounded-2xl",variants:Z,initial:"hidden",animate:"visible",children:[e.jsx(k,{title:`${y} ${u} List`,searchComponent:e.jsx(_,{handlePageSizeChange:j,pageSizeOptions:[10,20,30],pageSize:s,setSearchQuery:x})}),y==="Pay-In"&&!["mannualsuccess","manualpending","manualfailed"].includes((u==null?void 0:u.toLowerCase())||"")&&(f==null?void 0:f.role)==="SUPERADMIN"&&e.jsx("div",{className:"flex justify-end mr-2 mt-2 mb-2",children:e.jsx("select",{value:n,onChange:l=>r(l.target.value),className:"p-2 pr-8 rounded-xl border border-gray-300 shadow-sm bg-gradient-to-r from-blue-100 to-blue-200 text-gray-700 font-medium hover:from-blue-200 hover:to-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition",children:c.map(l=>e.jsx("option",{value:l,children:l},l))})}),e.jsxs("div",{className:"custom-scroll h-[72vh] overflow-auto",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 border-b text-xs uppercase text-gray-500 sticky top-0 z-40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"S.N"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Mobile"}),((q=f==null?void 0:f.role)==null?void 0:q.toUpperCase())==="SUPERADMIN"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Reseller Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Mode"}),y==="Pay-In"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Type"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Utr"}),y==="Pay-In"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Ref"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"file"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled Date"})]}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Transaction Id"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Initiated At"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Completed At"}),e.jsx("th",{className:"px-4 py-3 text-center text-nowrap",children:"Actions"})]})}),!D&&((V=o==null?void 0:o.results)==null?void 0:V.length)!=0&&!I&&e.jsx(ie,{data:(o==null?void 0:o.results)||[],openModal:C,isPending:I,type:y,status:u,start_number:w})]}),I?e.jsx(B,{}):(D||(o==null?void 0:o.results.length)===0)&&e.jsx(ee,{})]}),e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.3},children:[e.jsx(se,{currentPage:h,handlePageChange:d,pageSize:s,handlePageSizeChange:j,totalCount:(o==null?void 0:o.pagination.total)||1}),e.jsx(te,{isOpen:m.confirm||!1,onClose:()=>a({confirm:!1}),onConfirm:()=>C({isVerifyMpin:!0},t),disabled:v.isPending,title:"Transaction",description:"Are you sure you want to Change this Transaction ?"}),e.jsx(le,{isOpen:m.isVerifyMpin||!1,closeModal:()=>a({isVerifyMpin:!1}),onVerify:()=>O(t),isNextTaskPending:v.isPending}),e.jsx(de,{transaction_id:t==null?void 0:t.transaction_id,isOpen:m.isUtr||!1,closeModal:()=>a({isUtr:!1})}),e.jsx(xe,{isOpen:m.isMannualUpdateDeposit||!1,closeModal:()=>a({isMannualUpdateDeposit:!1}),transaction_id:t==null?void 0:t.transaction_id,amount:t==null?void 0:t.amount,payMethod:t==null?void 0:t.payMethod,payRef:t==null?void 0:t.payRef}),e.jsx(pe,{isOpen:m.isTaxDetails||!1,onClose:()=>a({isTaxDetails:!1}),type:t==null?void 0:t.type,transaction_id:t==null?void 0:t.transaction_id})]})]})};export{we as default};
