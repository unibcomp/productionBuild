import{r as w,Z as L,s as B,_ as A,$ as U,a0 as T,a1 as K,j as r,L as O,P as D}from"./index.DG_WvTOT.js";const _=()=>{const f=w.useMemo(()=>L,[]),{user_id:h}=B(),{data:N=[],isLoading:p}=A(h||""),u=Array.isArray(N)?N:[],g=U(),j=T(),b=K(),P=d=>{h&&(d.create.length>0&&g.mutate({user_id:h,create:d.create}),d.update.length>0&&j.mutate({user_id:h,update:d.update}),d.delete.length>0&&b.mutate({delete:d.delete}))};return p?r.jsx(O,{}):r.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8",children:[r.jsx("div",{className:"sticky top-0",children:r.jsx(D,{title:"Permissions Control",showBackButton:!1})}),r.jsx(R,{navLinks:f,userLinks:u,onSave:P})]})},R=({navLinks:f,userLinks:h,onSave:N})=>{const[p,u]=w.useState({}),[g,j]=w.useState({}),[b,P]=w.useState({});w.useEffect(()=>{const e={},t={},o={},c=(s,a)=>{const i=a?`${a}/${s.name}|${s.path}`:`${s.name}|${s.path}`,n=h.find(l=>l.path===s.path&&l.name.includes("/")?l.name.split("/")[0]:l.name===s.name);e[i]=!!n,t[i]={read:(n==null?void 0:n.read)||!1,write:(n==null?void 0:n.write)||!1},o[i]=s.path};f.forEach(s=>{var a;c(s),(a=s.children)==null||a.forEach(i=>c(i,s.name))}),u(e),j(t),P(o)},[f,h]),console.log(p);const d=(e,t,o)=>{j(c=>({...c,[e]:{read:t,write:o}}))},C=(e,t,o=[])=>{u(c=>{const s={...c,[e]:t};return o.forEach(a=>s[a]=t),s}),d(e,t,t),o.forEach(c=>d(c,t,t))},$=(e,t,o)=>{p[o]?(u(c=>({...c,[e]:t})),d(e,t,t)):(u(c=>({...c,[e]:t,[o]:!0})),d(o,!0,!0),d(e,t,t))},v=(e,t,o)=>{j(c=>{var a,i;const s={...c,[e]:{...c[e],[t]:o}};if(u(n=>({...n,[e]:s[e].read||s[e].write})),e.includes("/")){const n=e.split("/")[0],l=Object.keys(b).find(m=>m.startsWith(n)&&!m.includes("-"));if(l){const S=Object.keys(b).filter(x=>x.startsWith(n+"-")).some(x=>s[x].read||s[x].write),E=((a=s[l])==null?void 0:a.read)||((i=s[l])==null?void 0:i.write)||S;u(x=>({...x,[l]:E}))}}return s})},M=()=>{const e=[],t=[],o=[],c=new Map(h.map(s=>[s.path,s]));Object.entries(p).forEach(([s,a])=>{const i=b[s],[n]=s.split("|"),l=g[s],m=c.get(i);a?m?(l.read!==m.read||l.write!==m.write)&&t.push({id:m.id,name:n,path:i,read:l.read,write:l.write}):e.push({name:n,path:i,read:l.read,write:l.write}):m&&o.push({id:m.id})}),N({create:e,update:t,delete:o})};return r.jsxs("div",{className:"p-4 max-w-5xl mx-auto text-sm",children:[r.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Permissions Management"}),r.jsx("div",{className:"space-y-3",children:f.map(e=>{var c,s;const t=`${e.name}|${e.path}`,o=((c=e.children)==null?void 0:c.map(a=>`${e.name}/${a.name}|${a.path}`))||[];return r.jsxs("div",{className:"border rounded p-3 bg-white shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"flex items-center gap-2 font-medium",children:[r.jsx("input",{type:"checkbox",checked:p[t]||!1,onChange:a=>C(t,a.target.checked,o)}),e.name]}),r.jsx("div",{className:"flex gap-4",children:["read","write"].map(a=>{var i;return r.jsxs("label",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:((i=g[t])==null?void 0:i[a])||!1,onChange:n=>v(t,a,n.target.checked)}),a.charAt(0).toUpperCase()+a.slice(1)]},a)})})]}),((s=e.children)==null?void 0:s.length)&&r.jsx("div",{className:"ml-6 mt-3 space-y-2",children:e.children.map(a=>{const i=`${e.name}/${a.name}|${a.path}`;return r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:p[i]||!1,onChange:n=>$(i,n.target.checked,t)}),a.name]}),r.jsx("div",{className:"flex gap-4",children:["read","write"].map(n=>{var l;return r.jsxs("label",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:((l=g[i])==null?void 0:l[n])||!1,onChange:m=>v(i,n,m.target.checked)}),n.charAt(0).toUpperCase()+n.slice(1)]},n)})})]},i)})})]},t)})}),r.jsx("button",{onClick:M,className:"mt-6 px-5 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save Changes"})]})};export{_ as default};
