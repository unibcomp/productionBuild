import{p as _,g as O,q as z,o as G,r as f,j as e,z as U,s as R,V as w,Q as K,f as $,u as V,l as F,m as T,P as L,L as B,N as M,d as W,a as J,t as H,h as Q,c as q,S as Z,X,B as Y,C as ee}from"./index.Chx49pLa.js";import{u as se}from"./useDeleteAndSuspendUser.CVDh05NO.js";import{K as te,V as ae}from"./ViewUserDetailsModal.BvOpqUbW.js";import{u as le,C as ne}from"./RegisterUserModal.CeY8oA8A.js";import{D as ie}from"./DepWithModal.lwrbpfxt.js";import{A as re}from"./AdminSetting.tB66wUZW.js";import{u as oe}from"./permission.BiFjzmjz.js";import"./useManualPayin.y7HtERTz.js";import"./useTransaction.CwhqZVJe.js";import"./useSetting.BP-L-zhE.js";const ce=u=>O.put("/user/update/",u).then(m=>m.data),de=()=>_({mutationFn:ce,mutationKey:["update-kyc"]});function ue({isOpen:u,data:m,isUser:c,closeModal:g}){const{register:r,handleSubmit:I,reset:j,formState:{errors:i}}=z({defaultValues:m}),v=G(),{mutate:A}=de();f.useEffect(()=>{m&&j(m)},[m,j]);const o=s=>{c&&A(s,{onSuccess:l=>{const b=(l==null?void 0:l.message)||"KYC updated successfully!";g(),w.success(b),v.invalidateQueries({queryKey:["Allusers"]})},onError:l=>{var y,S,D,t;const b=((S=(y=l==null?void 0:l.response)==null?void 0:y.data)==null?void 0:S.error)||((t=(D=l==null?void 0:l.response)==null?void 0:D.data)==null?void 0:t.message)||"Something went wrong";w.error(b)}})};return e.jsx(U,{appear:!0,show:u,as:f.Fragment,children:e.jsxs(R,{as:"div",className:"relative z-1000",onClose:g,children:[e.jsx(U.Child,{as:f.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm","aria-hidden":"true"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(R.Panel,{className:"w-full max-w-3xl transform overflow-hidden rounded bg-white p-6 shadow-xl transition-all",children:[e.jsx(R.Title,{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User Account"}),e.jsxs("form",{onSubmit:I(o),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name (Kyc)"}),e.jsx("input",{...r("firstName",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name (Kyc)"}),e.jsx("input",{...r("lastName",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{...r("full_name",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"mobile"}),e.jsx("input",{...r("mobile",{valueAsNumber:!1}),type:"number",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"email"}),e.jsx("input",{...r("email",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{...r("address",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PersonalInformation Status"}),e.jsxs("select",{...r("personalInformationStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Aadhar Number"}),e.jsx("input",{...r("aadharNumber",{validate:s=>s?/^\d{12}$/.test(s)||"Aadhar Number must be exactly 12 digits":!0}),type:"text",maxLength:12,inputMode:"numeric",className:"input",placeholder:"Enter 12-digit Aadhar Number"}),(i==null?void 0:i.aadharNumber)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.aadharNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Aadhaar Status"}),e.jsxs("select",{...r("aadharStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PAN Number"}),e.jsx("input",{...r("panNumber",{setValueAs:s=>s==null?void 0:s.toUpperCase(),validate:s=>s?/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(s)||"Invalid PAN format":!0}),type:"text",maxLength:10,className:"input",onInput:s=>{s.currentTarget.value=s.currentTarget.value.toUpperCase()},placeholder:"ABCDE1234F"}),(i==null?void 0:i.panNumber)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.panNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pan Status"}),e.jsxs("select",{...r("panStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{...r("accountNumber",{pattern:{value:/^\d+$/,message:"Account Number must contain digits only"},minLength:{value:9,message:"Account Number must be at least 9 digits"},maxLength:{value:18,message:"Account Number must be at most 18 digits"}}),type:"text",inputMode:"numeric",className:"input",placeholder:"Enter Account Number"}),(i==null?void 0:i.accountNumber)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.accountNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"IFSC Code"}),e.jsx("input",{...r("ifscCode",{setValueAs:s=>s==null?void 0:s.toUpperCase(),validate:s=>s?/^[A-Z]{4}0[A-Z0-9]{6}$/.test(s)||"Invalid IFSC code":!0}),type:"text",maxLength:11,className:"input",onInput:s=>{s.currentTarget.value=s.currentTarget.value.toUpperCase()},placeholder:"e.g. SBIN0001234"}),(i==null?void 0:i.ifscCode)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:i.ifscCode.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{...r("bankName",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Status"}),e.jsxs("select",{...r("bankStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remark"}),e.jsx("input",{...r("remark",{valueAsNumber:!0}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Status"}),e.jsxs("select",{...r("businessStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end space-x-4 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"rounded border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700",children:"Save"})]})]})]})})})]})})}const me=u=>{const m=K();return new URLSearchParams(m.search).get(u)},xe=async u=>(await O.post("/operational-users/assign",u)).data,pe=()=>({assignUserMutation:_({mutationFn:m=>xe(m)})}),he=async u=>(await O.get("/operational-users/assign-list",{params:u})).data,Ne=u=>$({queryKey:["operationalAssignedUsers",u],queryFn:()=>he(u),enabled:!!u.user_id||!!u.operational_user_id});function ge({isOpen:u,onClose:m,data:c}){var d;const{handlePageChange:g,handlePageSizeChange:r,pageNumber:I,pageSizeValue:j}=V(),{user:i}=F(),v=(i==null?void 0:i.role)==="SUPERADMIN",{assignUserMutation:A}=pe(),[o,s]=f.useState({assignedOperational:[],removedOperational:[]}),{data:a}=Ne({user_id:c==null?void 0:c.user_id}),{data:l,isLoading:b,isError:y}=le({role:"OPERATIONAL",pageNumber:I,pageSize:j,...v&&{reseller_name:c==null?void 0:c.reseller_name}}),S=n=>{const x=a==null?void 0:a.result.find(p=>p.operational_user_id===n);return x?{data:x,success:!0}:{success:!1}},D=n=>{const x=S(n).success;return o.assignedOperational.includes(n)||x&&!o.removedOperational.includes(n)},t=(n,x)=>{s(p=>{const E=S(n);return x?{assignedOperational:E.success?p.assignedOperational:[...new Set([...p.assignedOperational,n])],removedOperational:p.removedOperational.filter(C=>C!==n)}:{assignedOperational:p.assignedOperational.filter(C=>C!==n),removedOperational:E.success?[...new Set([...p.removedOperational,n])]:p.removedOperational}})},h=()=>{c!=null&&c.user_id&&A.mutate({user_id:c==null?void 0:c.user_id,...o},{onSuccess:()=>{w.success("User assigned successfully"),m(),s({assignedOperational:[],removedOperational:[]})},onError:n=>{var E;const x=(E=n.response)==null?void 0:E.data,p=(x==null?void 0:x.message)||(x==null?void 0:x.error)||"Failed to assign";w.error(p)}})};return e.jsx(U,{appear:!0,show:u,as:f.Fragment,children:e.jsxs(R,{as:"div",className:"relative z-50",onClose:m,children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(U.Child,{as:f.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(R.Panel,{as:T.div,initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},className:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-2xl",children:[e.jsx(L,{title:"Assign User To Operational",showBackButton:!1}),b?e.jsx(B,{}):y||(l==null?void 0:l.data.length)===0?e.jsx(M,{}):e.jsx("div",{className:"grid grid-cols-2 gap-3 max-h-80 overflow-y-auto pr-2 mt-2",children:(d=l==null?void 0:l.data)==null?void 0:d.map(n=>e.jsxs("label",{className:"flex items-center justify-between p-2 border rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:`${n.full_name} ${v&&`(${n==null?void 0:n.reseller_name})`}`}),e.jsx("input",{type:"checkbox",checked:D(n.user_id),onChange:x=>t(n.user_id,x.target.checked),className:"w-5 h-5 accent-blue-600"})]},n.user_id))}),e.jsx("div",{className:"mt-4 border-t pt-3",children:e.jsx(W,{currentPage:I,handlePageChange:g,pageSize:j,handlePageSizeChange:r,totalCount:(l==null?void 0:l.pagination.total)||1})}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{disabled:A.isPending,onClick:m,className:"px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{disabled:A.isPending,onClick:h,className:"px-5 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",children:"Save"})]})]})})})]})})}const Ce=()=>{var x,p,E,C,k;const{handlePageChange:u,handlePageSizeChange:m,pageNumber:c,pageSizeValue:g}=V(),{setSearchQuery:r,searchQuery:I}=J(),[j,i]=f.useState(""),[v,A]=f.useState(!0),{user:o}=F(),s=me("userAction"),{data:a,isError:l,isLoading:b,refetch:y}=H({pageNumber:c,pageSize:g,searchQuery:I,...s&&{userAction:s},...(o==null?void 0:o.role)==="SUPERADMIN"&&j&&{reseller_name:j}}),{mutate:S}=se(),{openModal:D,isModalOpen:t,closeModal:h,data:d}=Q(),{allUsers:n}=oe();return f.useEffect(()=>{const N=setInterval(()=>{A(P=>!P)},2e3);return()=>clearInterval(N)},[]),e.jsxs(T.div,{className:"bg-white shadow-lg rounded-2xl",variants:q,initial:"hidden",animate:"visible",children:[e.jsx(L,{title:"All Users",searchComponent:e.jsxs(e.Fragment,{children:[(o==null?void 0:o.role)==="SUPERADMIN"&&e.jsxs("div",{className:"hidden sm:flex items-center gap-3 bg-gradient-to-r from-purple-100 to-blue-50 text-gray-800 border border-gray-300 px-4 py-1.5 rounded-xl text-xs font-medium shadow-sm relative",children:[e.jsxs("div",{className:"flex items-center gap-1 absolute -top-2 -right-3 bg-white px-2 py-[1px] rounded-full border border-gray-300 shadow-sm",children:[e.jsxs("span",{className:"relative flex w-2 h-2",children:[e.jsx("span",{className:`animate-ping absolute inline-flex h-full w-full rounded-full ${v?"bg-green-500":"bg-red-500"} opacity-75`}),e.jsx("span",{className:`relative inline-flex rounded-full h-2 w-2 ${v?"bg-green-600":"bg-red-600"}`})]}),e.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"LIVE"})]}),e.jsx("span",{className:"material-symbols-outlined text-sm text-blue-600",children:"groups_2"}),e.jsxs("span",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"font-semibold text-purple-700",children:["Settled ₹",(((x=a==null?void 0:a.walletTotals)==null?void 0:x.settled_amount)||0).toLocaleString("en-IN")]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("span",{className:"text-red-600",children:["Unsettled ₹",(((p=a==null?void 0:a.walletTotals)==null?void 0:p.un_settled_amount)||0).toLocaleString("en-IN")]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("span",{className:"text-orange-600",children:["Hold ₹",(((E=a==null?void 0:a.walletTotals)==null?void 0:E.holdAmount)||0).toLocaleString("en-IN")]})]})]}),e.jsx(Z,{handlePageSizeChange:m,pageSizeOptions:[10,20,30],pageSize:g,setSearchQuery:r}),(o==null?void 0:o.role)==="SUPERADMIN"&&e.jsx("div",{className:"flex gap-4 items-center",children:e.jsxs("select",{className:"border p-2 rounded",value:j,onChange:N=>i(N.target.value),children:[e.jsx("option",{value:"",children:"All Resellers"}),Object.keys(X).map((N,P)=>e.jsx("option",{value:N,children:N},P))]})}),n.write&&e.jsx(Y,{buttons:[{label:" Create User",onClick:()=>D({isRegister:!0},d),variant:"primary"}]})]})}),e.jsxs("div",{className:"custom-scroll h-[72vh] overflow-auto",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 border-b text-xs uppercase text-gray-500 sticky top-0 z-40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"S.N"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Full Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Mobile"}),(o==null?void 0:o.role)==="SUPERADMIN"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"reseller Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"A/C No"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Aadhar No"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Pan No"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Kyc Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"User Type"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"UnSettled"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Hold"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Wallet Frozen"}),e.jsx("th",{className:"px-4 py-3 text-center text-nowrap min-w-[160px]",children:"Actions"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"View"})]})}),!l&&(a==null?void 0:a.data.length)!=0&&!b&&e.jsx(te,{data:(a==null?void 0:a.data)||[],isAll:!0,openModal:D,role:o==null?void 0:o.role},`All_${c}-${(C=a==null?void 0:a.data)==null?void 0:C.length}_${b}`)]}),b?e.jsx(B,{}):(l||((k=a==null?void 0:a.data)==null?void 0:k.length)===0)&&e.jsx(M,{})]}),e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.3},children:[e.jsx(W,{currentPage:c,handlePageChange:u,pageSize:g,handlePageSizeChange:m,totalCount:(a==null?void 0:a.pagination.total)||1}),e.jsx(ue,{isOpen:t.editUser||!1,closeModal:()=>h({editUser:!1}),data:d,isUser:!0}),e.jsx(ee,{isOpen:t.confirm||!1,onClose:()=>h({confirm:!1}),onConfirm:()=>{d!=null&&d.user_id&&S({user_id:d.user_id,isDeleted:!0},{onSuccess:N=>{h({confirm:!1}),w.success(N.message||"User deleted successfully")},onError:N=>{w.error(N.message)}})},title:"Delete User",description:"Are you sure you want to delete this user ?"}),e.jsx(ge,{isOpen:t.isAssign||!1,onClose:()=>h({isAssign:!1}),data:d}),e.jsx(ae,{isOpen:t.view||!1,onClose:()=>h({view:!1}),data:d}),e.jsx(ne,{isOpen:(t==null?void 0:t.isRegister)||!1,closeModal:()=>h({isRegister:!1}),refetch:y}),e.jsx(ie,{isOpen:t.isWithdraw||t.isDeposit||t.isHold||!1,onClose:()=>h({...t!=null&&t.isWithdraw?{isWithdraw:!1}:{},...t!=null&&t.isDeposit?{isDeposit:!1}:{},...t!=null&&t.isHold?{isHold:!1}:{}}),isHold:t.isHold||!1,refetch:y,user_id:d==null?void 0:d.user_id,isWithdraw:t.isWithdraw||!1,isRealesed:t.isRealesed||!1}),e.jsx(re,{isOpen:(t==null?void 0:t.isAdminSetting)||!1,user_id:(d==null?void 0:d.user_id)||null,closeModal:()=>h({isAdminSetting:!1}),isUser:!0,refetch:y,role:d==null?void 0:d.role})]})]})};export{Ce as default};
