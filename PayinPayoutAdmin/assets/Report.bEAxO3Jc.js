import{u as C,c as L,l as P,r as f,j as e,m as T,P as q,V as h,x as I,y as _,A as O}from"./index.DL0rDYlX.js";import{u as U}from"./useUsers.Wbdycatb.js";const M=o=>{const{startDate:r="",endDate:l="",actions:a=[],type:n="",date:c="",user_id:p="",enabled:x=!0}=o,d={...r&&{startDate:r},...l&&{endDate:l},...n&&{type:n},...c&&{date:c},...p&&{user_id:p},...a.length&&{actions:a.join(",")}};return C({queryKey:["transaction-report",d],queryFn:async()=>{const g=new URLSearchParams(d);return(await L.get(`/file/downloding/?${g.toString()}`)).data.data},enabled:x&&!!r&&!!l&&!!a.length&&!!n&&!!c,staleTime:5*60*1e3})},V=["ALL","SUCCESS","PENDING","PROCESSING","REJECTED","REVERSE"],D=o=>{const r=new Date,l=r.toISOString().split("T")[0];let a;switch(o){case"today":a=l;break;case"7d":a=new Date(r.setDate(r.getDate()-7)).toISOString().split("T")[0];break;case"14d":a=new Date(r.setDate(r.getDate()-14)).toISOString().split("T")[0];break;case"1m":a=new Date(r.setMonth(r.getMonth()-1)).toISOString().split("T")[0];break;default:a=""}return{start:a,end:l}},F=()=>{const{register:o,handleSubmit:r,setValue:l,watch:a,formState:{errors:n}}=P({defaultValues:{dateRange:"",startDate:"",endDate:"",actions:[],format:"",type:""}}),[c,p]=f.useState(null),x=a("search"),{data:d}=U({pageNumber:1,pageSize:10,searchQuery:(x==null?void 0:x.trim())??""}),[g,j]=f.useState(!1),[w,N]=f.useState(!1),m=a("actions"),b=a("dateRange"),v=a("startDate"),S=a("endDate"),k=t=>{let s=[...m];t==="ALL"?s=["ALL"]:(s=s.filter(i=>i!=="ALL"),s.includes(t)?s=s.filter(i=>i!==t):s.push(t)),l("actions",s),N(!1)},y=async t=>{if(!u||u.length===0){h.error("No data available to export.");return}const s=`${b||"report"}_${Date.now()}`;switch(t){case"pdf":await O(u,s);break;case"excel":await _(u,s);break;case"csv":await I(u,s);break;default:h.error("Invalid format selected.");return}h.success("Report downloaded successfully.")},R=t=>{if(t.actions.length===0){h.error("Please select at least one action.");return}if(t.dateRange!=="custom"){const{start:s,end:i}=D(t.dateRange);t.startDate=s,t.endDate=i,l("startDate",s),l("endDate",i)}j(!0)},{data:u,isLoading:A}=M({startDate:v,endDate:S,actions:m,date:b,type:a("type"),...c&&{user_id:c},enabled:g});return e.jsxs(T.div,{className:"bg-white shadow-lg rounded-2xl min-h-screen",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx(q,{title:"All Report"}),e.jsxs("form",{onSubmit:r(R),className:"p-6 space-y-8 text-gray-800 bg-white rounded-2xl shadow",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Date Range"}),e.jsxs("select",{...o("dateRange",{required:"Date range is required"}),onChange:t=>{const s=t.target.value;if(l("dateRange",s),s!=="custom"){const{start:i,end:E}=D(s);l("startDate",i),l("endDate",E)}else l("startDate",""),l("endDate","")},className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"14d",children:"Last 14 Days"}),e.jsx("option",{value:"1m",children:"Last 1 Month"}),e.jsx("option",{value:"custom",children:"Custom"})]}),n.dateRange&&e.jsx("p",{className:"text-sm text-red-600",children:n.dateRange.message})]}),b==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",...o("startDate",{required:"Start date is required"}),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"}),n.startDate&&e.jsx("p",{className:"text-sm text-red-600",children:n.startDate.message})]}),b==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",...o("endDate",{required:"End date is required"}),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"}),n.endDate&&e.jsx("p",{className:"text-sm text-red-600",children:n.endDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{...o("type",{required:!0}),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500",defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,hidden:!0,children:"Please select type"}),e.jsx("option",{value:"ALL",children:"All"}),e.jsx("option",{value:"PAYIN",children:"Payin"}),e.jsx("option",{value:"PAYOUT",children:"Payout"}),e.jsx("option",{value:"SETTLED",children:"Settlement"})]}),n.type&&e.jsx("p",{className:"text-sm text-red-600",children:"Please select a type"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Actions"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 cursor-pointer bg-white",onClick:()=>N(!w),children:m.length>0?m.join(", "):"Select actions"}),w&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow p-3",children:V.map(t=>e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:m.includes(t),onChange:()=>k(t),className:"accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t})]},t))}),m.length===0&&e.jsx("p",{className:"text-sm text-red-600",children:"Please select at least one action"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Search (Mobile or Name)"}),e.jsx("input",{type:"text",placeholder:"Enter mobile or name",...o("search"),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"}),x&&Array.isArray(d==null?void 0:d.data)&&d.data.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:d.data.map(t=>e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-800 hover:bg-blue-100 cursor-pointer",onClick:()=>{l("search",`${t.full_name} (${t.mobile})`),p(t.user_id)},children:[e.jsx("div",{className:"font-medium",children:t.full_name||"Unnamed User"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.mobile})]},t.user_id))})]})]}),e.jsx("div",{className:"flex justify-end",children:g?A?e.jsxs("button",{type:"button",disabled:!0,className:"bg-gray-300 text-gray-700 font-semibold px-6 py-3 rounded-xl shadow flex items-center gap-2 cursor-not-allowed",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Loading..."]}):e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>y("pdf"),className:"bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"picture_as_pdf"}),"PDF"]}),e.jsxs("button",{type:"button",onClick:()=>y("excel"),className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_on"}),"Excel"]}),e.jsxs("button",{type:"button",onClick:()=>y("csv"),className:"bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"description"}),"CSV"]})]}):e.jsxs("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),"Generate Report"]})})]})]})};export{F as default};
