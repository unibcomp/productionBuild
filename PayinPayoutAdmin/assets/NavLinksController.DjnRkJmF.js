import{r as w,_ as L,s as B,$ as U,a0 as A,a1 as O,a2 as T,j as r,L as K,P as R}from"./index.Bweg_k96.js";const _=()=>{const x=w.useMemo(()=>L,[]),{user_id:h}=B(),{data:v=[],isLoading:p}=U(h||""),u=Array.isArray(v)?v:[],g=A(),j=O(),b=T(),N=d=>{h&&(d.create.length>0&&g.mutate({user_id:h,create:d.create}),d.update.length>0&&j.mutate({user_id:h,update:d.update}),d.delete.length>0&&b.mutate({delete:d.delete}))};return p?r.jsx(K,{}):r.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8",children:[r.jsx("div",{className:"sticky top-0",children:r.jsx(R,{title:"Permissions Control",showBackButton:!1})}),r.jsx(D,{navLinks:x,userLinks:u,onSave:N})]})},D=({navLinks:x,userLinks:h,onSave:v})=>{const[p,u]=w.useState({}),[g,j]=w.useState({}),[b,N]=w.useState({});w.useEffect(()=>{const s={},t={},o={},c=(e,a)=>{const i=a?`${a}/${e.name}|${e.path}`:`${e.name}|${e.path}`,n=h.find(l=>l.path===e.path&&l.name.includes("/")?l.name.split("/")[0]:l.name===e.name);s[i]=!!n,t[i]={read:(n==null?void 0:n.read)||!1,write:(n==null?void 0:n.write)||!1},o[i]=e.path};x.forEach(e=>{var a;c(e),(a=e.children)==null||a.forEach(i=>c(i,e.name))}),u(s),j(t),N(o)},[x,h]),console.log(p);const d=(s,t,o)=>{j(c=>({...c,[s]:{read:t,write:o}}))},C=(s,t,o=[])=>{u(c=>{const e={...c,[s]:t};return o.forEach(a=>e[a]=t),e}),d(s,t,t),o.forEach(c=>d(c,t,t))},P=(s,t,o)=>{p[o]?(u(c=>({...c,[s]:t})),d(s,t,t)):(u(c=>({...c,[s]:t,[o]:!0})),d(o,!0,!0),d(s,t,t))},$=(s,t,o)=>{j(c=>{var a,i;const e={...c,[s]:{...c[s],[t]:o}};if(u(n=>({...n,[s]:e[s].read||e[s].write})),s.includes("/")){const n=s.split("/")[0],l=Object.keys(b).find(m=>m.startsWith(n)&&!m.includes("-"));if(l){const M=Object.keys(b).filter(f=>f.startsWith(n+"-")).some(f=>e[f].read||e[f].write),E=((a=e[l])==null?void 0:a.read)||((i=e[l])==null?void 0:i.write)||M;u(f=>({...f,[l]:E}))}}return e})},S=()=>{const s=[],t=[],o=[],c=new Map(h.map(e=>[e.path==="#"?`${e.name}|${e.path}`:e.path,e]));Object.entries(p).forEach(([e,a])=>{const i=e.includes("#")?e:b[e],[n]=e.split("|"),l=g[e],m=c.get(i);a?m?(l.read!==m.read||l.write!==m.write)&&t.push({id:m.id,name:n,path:i,read:l.read,write:l.write}):s.push({name:n,path:i,read:l.read,write:l.write}):m&&o.push({id:m.id})}),v({create:s,update:t,delete:o})};return r.jsxs("div",{className:"p-4  mx-auto text-sm",children:[r.jsx("div",{className:"custom-scroll h-[72vh] overflow-auto ",children:r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:x.map(s=>{var c,e;const t=`${s.name}|${s.path}`,o=((c=s.children)==null?void 0:c.map(a=>`${s.name}/${a.name}|${a.path}`))||[];return!["Reseller","Operational User","External Settings"].includes(s.name)&&r.jsxs("div",{className:"border rounded p-3 bg-white shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"flex items-center gap-2 font-medium",children:[r.jsx("input",{type:"checkbox",checked:p[t]||!1,onChange:a=>C(t,a.target.checked,o)}),s.name]}),r.jsx("div",{className:"flex gap-4",children:["read","write"].map(a=>{var i;return r.jsxs("label",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:((i=g[t])==null?void 0:i[a])||!1,onChange:n=>$(t,a,n.target.checked)}),a.charAt(0).toUpperCase()+a.slice(1)]},a)})})]}),((e=s.children)==null?void 0:e.length)&&r.jsx("div",{className:"ml-6 mt-3 space-y-2",children:s.children.map(a=>{const i=`${s.name}/${a.name}|${a.path}`;return r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:p[i]||!1,onChange:n=>P(i,n.target.checked,t)}),a.name]}),r.jsx("div",{className:"flex gap-4",children:["read","write"].map(n=>{var l;return r.jsxs("label",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:((l=g[i])==null?void 0:l[n])||!1,onChange:m=>$(i,n,m.target.checked)}),n.charAt(0).toUpperCase()+n.slice(1)]},n)})})]},i)})})]},t)})})}),r.jsx("button",{onClick:S,className:"mt-6 px-5 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save Changes"})]})};export{_ as default};
