import{k as T,l as P,o as B,i as W,r as A,j as e,z as R,p as C,V as S,Q as M,h as z,u as O,n as k,m as w,P as V,L as F,N as _,d as L,b as K,q as G,a as J,x as $,c as H,S as Q,B as q,C as Z}from"./index.BlDP0ua6.js";import{u as Y}from"./useDeleteAndSuspendUser.C9U99ZFi.js";import{K as X,V as ee}from"./ViewUserDetailsModal.DPlZPNt7.js";import{u as se,C as te}from"./RegisterUserModal.BF53i62C.js";import{D as ae}from"./DepWithModal.DH227QSi.js";import{A as ne}from"./AdminSetting.CzSak0RN.js";import"./useManualPayin.CYQ0pNY8.js";import"./useTransaction.D02xS02D.js";import"./useSetting.B2uMhCL_.js";const ie=c=>P.put("/user/update/",c).then(u=>u.data),le=()=>T({mutationFn:ie,mutationKey:["update-kyc"]});function re({isOpen:c,data:u,isUser:o,closeModal:h}){const{register:l,handleSubmit:y,reset:j,formState:{errors:s}}=B({defaultValues:u}),b=W(),{mutate:N}=le();A.useEffect(()=>{u&&j(u)},[u,j]);const g=a=>{o&&N(a,{onSuccess:n=>{const t=(n==null?void 0:n.message)||"KYC updated successfully!";h(),S.success(t),b.invalidateQueries({queryKey:["Allusers"]})},onError:n=>{var m,i,f,E;const t=((i=(m=n==null?void 0:n.response)==null?void 0:m.data)==null?void 0:i.error)||((E=(f=n==null?void 0:n.response)==null?void 0:f.data)==null?void 0:E.message)||"Something went wrong";S.error(t)}})};return e.jsx(R,{appear:!0,show:c,as:A.Fragment,children:e.jsxs(C,{as:"div",className:"relative z-1000",onClose:h,children:[e.jsx(R.Child,{as:A.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm","aria-hidden":"true"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(C.Panel,{className:"w-full max-w-3xl transform overflow-hidden rounded bg-white p-6 shadow-xl transition-all",children:[e.jsx(C.Title,{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User Account"}),e.jsxs("form",{onSubmit:y(g),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name (Kyc)"}),e.jsx("input",{...l("firstName",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name (Kyc)"}),e.jsx("input",{...l("lastName",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{...l("full_name",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"mobile"}),e.jsx("input",{...l("mobile",{valueAsNumber:!1}),type:"number",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"email"}),e.jsx("input",{...l("email",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{...l("address",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PersonalInformation Status"}),e.jsxs("select",{...l("personalInformationStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Aadhar Number"}),e.jsx("input",{...l("aadharNumber",{validate:a=>a?/^\d{12}$/.test(a)||"Aadhar Number must be exactly 12 digits":!0}),type:"text",maxLength:12,inputMode:"numeric",className:"input",placeholder:"Enter 12-digit Aadhar Number"}),(s==null?void 0:s.aadharNumber)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:s.aadharNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Aadhaar Status"}),e.jsxs("select",{...l("aadharStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PAN Number"}),e.jsx("input",{...l("panNumber",{setValueAs:a=>a==null?void 0:a.toUpperCase(),validate:a=>a?/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(a)||"Invalid PAN format":!0}),type:"text",maxLength:10,className:"input",onInput:a=>{a.currentTarget.value=a.currentTarget.value.toUpperCase()},placeholder:"ABCDE1234F"}),(s==null?void 0:s.panNumber)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:s.panNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pan Status"}),e.jsxs("select",{...l("panStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{...l("accountNumber",{pattern:{value:/^\d+$/,message:"Account Number must contain digits only"},minLength:{value:9,message:"Account Number must be at least 9 digits"},maxLength:{value:18,message:"Account Number must be at most 18 digits"}}),type:"text",inputMode:"numeric",className:"input",placeholder:"Enter Account Number"}),(s==null?void 0:s.accountNumber)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:s.accountNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"IFSC Code"}),e.jsx("input",{...l("ifscCode",{setValueAs:a=>a==null?void 0:a.toUpperCase(),validate:a=>a?/^[A-Z]{4}0[A-Z0-9]{6}$/.test(a)||"Invalid IFSC code":!0}),type:"text",maxLength:11,className:"input",onInput:a=>{a.currentTarget.value=a.currentTarget.value.toUpperCase()},placeholder:"e.g. SBIN0001234"}),(s==null?void 0:s.ifscCode)&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:s.ifscCode.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{...l("bankName",{valueAsNumber:!1}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bank Status"}),e.jsxs("select",{...l("bankStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remark"}),e.jsx("input",{...l("remark",{valueAsNumber:!0}),type:"text",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Status"}),e.jsxs("select",{...l("businessStatus"),className:"input",defaultValue:"",children:[e.jsx("option",{value:"",children:"Select Status (Optional)"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"SUBMITTED",children:"SUBMITTED"}),e.jsx("option",{value:"UNDER_REVIEW",children:"UNDER REVIEW"}),e.jsx("option",{value:"APPROVED",children:"APPROVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"}),e.jsx("option",{value:"NEEDS_CLARIFICATION",children:"NEEDS CLARIFICATION"})]})]})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end space-x-4 pt-4",children:[e.jsx("button",{type:"button",onClick:h,className:"rounded border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700",children:"Save"})]})]})]})})})]})})}const oe=c=>{const u=M();return new URLSearchParams(u.search).get(c)},ce=async c=>(await P.post("/operational-users/assign",c)).data,ue=()=>({assignUserMutation:T({mutationFn:u=>ce(u)})}),de=async c=>(await P.get("/operational-users/assign-list",{params:c})).data,me=c=>z({queryKey:["operationalAssignedUsers",c],queryFn:()=>de(c),enabled:!!c.user_id||!!c.operational_user_id});function xe({isOpen:c,onClose:u,data:o}){var v;const{handlePageChange:h,handlePageSizeChange:l,pageNumber:y,pageSizeValue:j}=O(),{user:s}=k(),b=(s==null?void 0:s.role)==="SUPERADMIN",{assignUserMutation:N}=ue(),[g,a]=A.useState({assignedOperational:[],removedOperational:[]}),{data:x}=me({user_id:o==null?void 0:o.user_id}),{data:n,isLoading:t,isError:m}=se({role:"OPERATIONAL",pageNumber:y,pageSize:j,...b&&{reseller_name:o==null?void 0:o.reseller_name}}),i=r=>{const d=x==null?void 0:x.result.find(p=>p.operational_user_id===r);return d?{data:d,success:!0}:{success:!1}},f=r=>{const d=i(r).success;return g.assignedOperational.includes(r)||d&&!g.removedOperational.includes(r)},E=(r,d)=>{a(p=>{const D=i(r);return d?{assignedOperational:D.success?p.assignedOperational:[...new Set([...p.assignedOperational,r])],removedOperational:p.removedOperational.filter(U=>U!==r)}:{assignedOperational:p.assignedOperational.filter(U=>U!==r),removedOperational:D.success?[...new Set([...p.removedOperational,r])]:p.removedOperational}})},I=()=>{o!=null&&o.user_id&&N.mutate({user_id:o==null?void 0:o.user_id,...g},{onSuccess:()=>{S.success("User assigned successfully"),u(),a({assignedOperational:[],removedOperational:[]})},onError:r=>{var D;const d=(D=r.response)==null?void 0:D.data,p=(d==null?void 0:d.message)||(d==null?void 0:d.error)||"Failed to assign";S.error(p)}})};return e.jsx(R,{appear:!0,show:c,as:A.Fragment,children:e.jsxs(C,{as:"div",className:"relative z-50",onClose:u,children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(R.Child,{as:A.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(C.Panel,{as:w.div,initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},className:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-2xl",children:[e.jsx(V,{title:"Assign User To Operational",showBackButton:!1}),t?e.jsx(F,{}):m||(n==null?void 0:n.data.length)===0?e.jsx(_,{}):e.jsx("div",{className:"grid grid-cols-2 gap-3 max-h-80 overflow-y-auto pr-2 mt-2",children:(v=n==null?void 0:n.data)==null?void 0:v.map(r=>e.jsxs("label",{className:"flex items-center justify-between p-2 border rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:`${r.full_name} ${b&&`(${r==null?void 0:r.reseller_name})`}`}),e.jsx("input",{type:"checkbox",checked:f(r.user_id),onChange:d=>E(r.user_id,d.target.checked),className:"w-5 h-5 accent-blue-600"})]},r.user_id))}),e.jsx("div",{className:"mt-4 border-t pt-3",children:e.jsx(L,{currentPage:y,handlePageChange:h,pageSize:j,handlePageSizeChange:l,totalCount:(n==null?void 0:n.pagination.total)||1})}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{disabled:N.isPending,onClick:u,className:"px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{disabled:N.isPending,onClick:I,className:"px-5 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition",children:"Save"})]})]})})})]})})}const ve=()=>{var E,I;const{handlePageChange:c,handlePageSizeChange:u,pageNumber:o,pageSizeValue:h}=O(),{setSearchQuery:l,searchQuery:y}=K(),j=oe("userAction"),{data:s,isError:b,isLoading:N,refetch:g}=G({pageNumber:o,pageSize:h,searchQuery:y,...j&&{userAction:j}}),{mutate:a}=Y(),{user:x}=k(),{openModal:n,isModalOpen:t,closeModal:m,data:i}=J(),{allUsers:f}=$();return e.jsxs(w.div,{className:"bg-white shadow-lg rounded-2xl",variants:H,initial:"hidden",animate:"visible",children:[e.jsx(V,{title:"All Users",searchComponent:e.jsxs(e.Fragment,{children:[e.jsx(Q,{handlePageSizeChange:u,pageSizeOptions:[10,20,30],pageSize:h,setSearchQuery:l}),f.write&&e.jsx(q,{buttons:[{label:" Create User",onClick:()=>n({isRegister:!0},i),variant:"primary"}]})]})}),e.jsxs("div",{className:"custom-scroll h-[72vh] overflow-auto",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 border-b text-xs uppercase text-gray-500 sticky top-0 z-40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"S.N"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Full Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Mobile"}),(x==null?void 0:x.role)==="SUPERADMIN"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"reseller Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"A/C No"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Aadhar No"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Pan No"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Kyc Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"User Type"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"UnSettled"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Hold"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Wallet Frozen"}),e.jsx("th",{className:"px-4 py-3 text-center text-nowrap min-w-[160px]",children:"Actions"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"View"})]})}),!b&&(s==null?void 0:s.data.length)!=0&&!N&&e.jsx(X,{data:(s==null?void 0:s.data)||[],isAll:!0,openModal:n,role:x==null?void 0:x.role},`All_${o}-${(E=s==null?void 0:s.data)==null?void 0:E.length}_${N}`)]}),N?e.jsx(F,{}):(b||((I=s==null?void 0:s.data)==null?void 0:I.length)===0)&&e.jsx(_,{})]}),e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.3},children:[e.jsx(L,{currentPage:o,handlePageChange:c,pageSize:h,handlePageSizeChange:u,totalCount:(s==null?void 0:s.pagination.total)||1}),e.jsx(re,{isOpen:t.editUser||!1,closeModal:()=>m({editUser:!1}),data:i,isUser:!0}),e.jsx(Z,{isOpen:t.confirm||!1,onClose:()=>m({confirm:!1}),onConfirm:()=>{i!=null&&i.user_id&&a({user_id:i.user_id,isDeleted:!0},{onSuccess:v=>{m({confirm:!1}),S.success(v.message||"User deleted successfully")},onError:v=>{S.error(v.message)}})},title:"Delete User",description:"Are you sure you want to delete this user ?"}),e.jsx(xe,{isOpen:t.isAssign||!1,onClose:()=>m({isAssign:!1}),data:i}),e.jsx(ee,{isOpen:t.view||!1,onClose:()=>m({view:!1}),data:i}),e.jsx(te,{isOpen:(t==null?void 0:t.isRegister)||!1,closeModal:()=>m({isRegister:!1}),refetch:g}),e.jsx(ae,{isOpen:t.isWithdraw||t.isDeposit||t.isHold||!1,onClose:()=>m({...t!=null&&t.isWithdraw?{isWithdraw:!1}:{},...t!=null&&t.isDeposit?{isDeposit:!1}:{},...t!=null&&t.isHold?{isHold:!1}:{}}),isHold:t.isHold||!1,refetch:g,user_id:i==null?void 0:i.user_id,isWithdraw:t.isWithdraw||!1,isRealesed:t.isRealesed||!1}),e.jsx(ne,{isOpen:(t==null?void 0:t.isAdminSetting)||!1,user_id:(i==null?void 0:i.user_id)||null,closeModal:()=>m({isAdminSetting:!1}),isUser:!0,refetch:g,role:i==null?void 0:i.role})]})]})};export{ve as default};
