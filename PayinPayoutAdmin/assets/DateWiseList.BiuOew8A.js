import{l as B,j as e,z as S,r as N,n as b,w as I,u as D,c as Q,P as R,L as k,e as W,d as Y,p as $,h as H,f as K,m as E,i as J,S as X,N as Z,k as _,C as ee,V as v}from"./index.BVLUjDox.js";import{a as se,d as te,u as ae}from"./useDeposit.BbiyOoaT.js";import{D as ne}from"./DateWiseTableBody.D7zQMc7_.js";import{a as re,M as ie}from"./MpinVerifyModal.BSdeZjEr.js";import{u as oe}from"./useManualPayin.BaNmABt_.js";import"./useMpin.B5AmIsEl.js";const le=({transaction_id:i,closeModal:t,isOpen:m})=>{const{register:d,handleSubmit:h,formState:{errors:p}}=B(),{createUpdateUtrMutation:s}=oe(),f=w=>{s.mutate({transaction_id:i,data:w},{onError:x=>{var n;const a=(n=x.response)==null?void 0:n.data;I.error((a==null?void 0:a.message)||(a==null?void 0:a.error)),t()},onSuccess:x=>{I.success(x.message||"SuccesFully Updated")}})};return e.jsx(S,{appear:!0,show:m,as:N.Fragment,children:e.jsxs(b,{as:"div",className:"relative z-50",onClose:t,children:[e.jsx(S.Child,{as:N.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(b.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded bg-white p-6 shadow-xl transition-all",children:[e.jsx(b.Title,{className:"text-lg font-medium text-gray-900 mb-4",children:"Update Utr"}),e.jsxs("form",{onSubmit:h(f),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("input",{type:"number",...d("utr",{required:"Utr is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter Utr Number"}),p.utr&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:p.utr.message})]}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-[#185e91] hover:bg-[#144e7a] text-white font-semibold rounded-md transition cursor-pointer",children:s.isPending?"Processing...":"Submit"})]})]})})})]})})},ce=(i,t,m=!0)=>D({queryKey:["taxReportByTransaction",i,t],enabled:m&&!!i&&!!t,queryFn:async()=>{const d=await Q.get("/tax-report-specific-transaction",{params:{transaction_id:i,type:t}});if(!d.data.success||!d.data.data)throw new Error("No tax data found");return d.data.data}});function de({isOpen:i,onClose:t,type:m,transaction_id:d}){const{data:h,isLoading:p}=ce(d,m,i),s=h,f=((s==null?void 0:s.companyTaxAmount)??0)+((s==null?void 0:s.gstApplyAmount)??0)+((s==null?void 0:s.resellerTaxAmount)??0)+((s==null?void 0:s.resellerGstAmount)??0);return e.jsx(S,{appear:!0,show:i,as:N.Fragment,children:e.jsxs(b,{as:"div",className:"relative z-50",onClose:t,children:[e.jsx(S.Child,{as:N.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-6",children:e.jsx(b.Panel,{className:"w-full max-w-xl transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all border border-blue-100",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsx(R,{title:"ðŸ§¾ Tax Transaction Details"}),e.jsxs("div",{className:"my-6 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 font-semibold mb-1",children:["Type: ",e.jsx("span",{className:"text-gray-800",children:m})]}),e.jsxs("div",{className:"text-sm text-gray-600 font-semibold",children:["Transaction ID:"," ",e.jsx("span",{className:"text-gray-800",children:d})]})]}),p?e.jsx(k,{}):e.jsxs("div",{className:"grid grid-cols-1 gap-2 max-h-[58vh] overflow-y-auto",children:[e.jsx(g,{label:"Total Amount",value:f||0}),e.jsx(g,{label:"Gateway Charges",value:(s==null?void 0:s.companyTaxAmount)||0}),e.jsx(g,{label:"Gateway GST",value:(s==null?void 0:s.gstApplyAmount)||0}),e.jsx(g,{label:"Company Charges",value:(s==null?void 0:s.resellerTaxAmount)||0}),e.jsx(g,{label:"Company GST",value:(s==null?void 0:s.resellerGstAmount)||0})]}),e.jsx("div",{className:"flex justify-end pt-10",children:e.jsx("button",{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md shadow-sm text-sm font-medium transition",children:"Close"})})]})})})})]})})}function g({label:i,value:t}){return e.jsxs("div",{className:"bg-white border border-gray-200 p-3 rounded-xl shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1",children:i}),e.jsxs("p",{className:"text-base text-gray-800 font-medium",children:["â‚¹ ",(t==null?void 0:t.toFixed(2))??"â€”"]})]})}const fe=()=>{var V,z;const[i,t]=N.useState("All"),m=["All","GATEPAY","PAYU"],{handlePageChange:d,handlePageSizeChange:h,pageNumber:p,pageSizeValue:s,startItem:f}=W(),{openModal:w,isModalOpen:x,closeModal:a,data:n}=Y(),{date:C,status:c,type:u}=$(),{user:y}=H(),G=u==="Pay-In",{setSearchQuery:L,searchQuery:M}=K(),{updateDepositMutation:P}=se(),{updateReverseMutation:O}=te(),{data:l,isError:U,isLoading:T,refetch:F}=u==="Pay-In"?ae({searchQuery:M,pageNumber:p,pageSize:s,date:C,status:c==null?void 0:c.toUpperCase(),gateway:i},G):re({searchQuery:M,pageNumber:p,pageSize:s,date:C,status:c==null?void 0:c.toUpperCase()}),q=r=>{r!=null&&r.transaction_id&&(r!=null&&r.isReverse)?O.mutate(r.transaction_id,{onSuccess:()=>{F(),v.success("Action  Completed SuccessFully"),a({isVerifyMpin:!1})},onError:A=>{var j;const o=(j=A.response)==null?void 0:j.data;v.error((o==null?void 0:o.message)||(o==null?void 0:o.error)),a({isVerifyMpin:!1})}}):P.mutate(r,{onSuccess:()=>{F(),v.success("Action  Completed SuccessFully"),a({isVerifyMpin:!1})},onError:A=>{var j;const o=(j=A.response)==null?void 0:j.data;v.error((o==null?void 0:o.message)||(o==null?void 0:o.error)),a({isVerifyMpin:!1})}})};return e.jsxs(E.div,{className:"bg-white shadow-lg rounded-2xl",variants:J,initial:"hidden",animate:"visible",children:[e.jsx(R,{title:`${u} ${c} List`,searchComponent:e.jsx(X,{handlePageSizeChange:h,pageSizeOptions:[10,20,30],pageSize:s,setSearchQuery:L})}),u==="Pay-In"&&!["mannualsuccess","manualpending","manualfailed"].includes((c==null?void 0:c.toLowerCase())||"")&&(y==null?void 0:y.role)==="SUPERADMIN"&&e.jsx("div",{className:"flex justify-end mr-2 mt-2 mb-2",children:e.jsx("select",{value:i,onChange:r=>t(r.target.value),className:"p-2 pr-8 rounded-xl border border-gray-300 shadow-sm bg-gradient-to-r from-blue-100 to-blue-200 text-gray-700 font-medium hover:from-blue-200 hover:to-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition",children:m.map(r=>e.jsx("option",{value:r,children:r},r))})}),e.jsxs("div",{className:"custom-scroll h-[72vh] overflow-auto",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 border-b text-xs uppercase text-gray-500 sticky top-0 z-40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"S.N"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Mobile"}),((V=y==null?void 0:y.role)==null?void 0:V.toUpperCase())==="SUPERADMIN"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Reseller Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Mode"}),u==="Pay-In"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Type"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Utr"}),u==="Pay-In"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Ref"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"file"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled Date"})]}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Transaction Id"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Initiated At"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Completed At"}),e.jsx("th",{className:"px-4 py-3 text-center text-nowrap",children:"Actions"})]})}),!U&&((z=l==null?void 0:l.results)==null?void 0:z.length)!=0&&!T&&e.jsx(ne,{data:(l==null?void 0:l.results)||[],openModal:w,isPending:T,type:u,status:c,start_number:f})]}),T?e.jsx(k,{}):(U||(l==null?void 0:l.results.length)===0)&&e.jsx(Z,{})]}),e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.3},children:[e.jsx(_,{currentPage:p,handlePageChange:d,pageSize:s,handlePageSizeChange:h,totalCount:(l==null?void 0:l.pagination.total)||1}),e.jsx(ee,{isOpen:x.confirm||!1,onClose:()=>a({confirm:!1}),onConfirm:()=>w({isVerifyMpin:!0},n),disabled:P.isPending,title:"Transaction",description:"Are you sure you want to Change this Transaction ?"}),e.jsx(ie,{isOpen:x.isVerifyMpin||!1,closeModal:()=>a({isVerifyMpin:!1}),onVerify:()=>q(n),isNextTaskPending:P.isPending}),e.jsx(le,{transaction_id:n==null?void 0:n.transaction_id,isOpen:x.isUtr||!1,closeModal:()=>a({isUtr:!1})}),e.jsx(de,{isOpen:x.isTaxDetails||!1,onClose:()=>a({isTaxDetails:!1}),type:n==null?void 0:n.type,transaction_id:n==null?void 0:n.transaction_id})]})]})};export{fe as default};
