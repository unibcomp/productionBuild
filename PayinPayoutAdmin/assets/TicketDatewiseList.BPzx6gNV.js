import{j as e,m as j,p as v,i as f,l as w,r as x,z as y,n as p,V as g,k as T,a as C,b as E,o as S,h as R,f as D,P as k,L as P,N,g as F}from"./index.D6RXDbm3.js";import{a as I,b as L}from"./useTicket.CUcVtwQ0.js";import{B as A}from"./ActionButton.DIO2fgsd.js";const z=({data:c,start_number:n,openModal:s})=>e.jsx("tbody",{className:"custom-scroll",children:c.map((t,l)=>{var r;return e.jsxs(j.tr,{className:"hover:bg-gray-50 transition-all duration-150",variants:v,initial:"hidden",animate:"visible",custom:l,children:[e.jsx("td",{className:"px-4 py-3 w-[5%] text-center",children:n+l}),e.jsx("td",{className:"px-4 py-3 w-[10%]",children:((r=t.user)==null?void 0:r.full_name)||"N/A"}),e.jsx("td",{className:"px-4 py-3 w-[10%]",children:t.type}),e.jsx("td",{className:"px-4 py-3 w-[15%]",children:t.transaction_id}),e.jsx("td",{className:"px-4 py-3 w-[20%] truncate",children:t.description}),e.jsx("td",{className:"px-4 py-3 w-[10%]",children:t.status}),e.jsx("td",{className:"px-4 py-3 w-[20%]",children:t.adminComment||"-"}),e.jsx("td",{className:"px-4 py-3 w-[10%]",children:t.createdAt?new Date(t.createdAt).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-3 w-[10%] text-right",children:e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800 transition",title:"Edit Ticket",onClick:()=>s==null?void 0:s({isTicket:!0},t),children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"edit_note"})}),e.jsx("button",{className:"text-green-600 hover:text-green-800 transition",title:"Reply to Ticket",onClick:()=>s==null?void 0:s({isReplyTicket:!0},t),children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"reply"})})]})})]},t.id||l)})});function V({isOpen:c,closeModal:n,ticket:s}){const t=f(),{register:l,handleSubmit:r,reset:d}=w(),{mutate:h}=I();x.useEffect(()=>{s&&d(s)},[s,d]);const m=o=>{s&&h({id:s.id,status:o.status,adminComment:o.adminComment},{onSuccess:a=>{g.success((a==null?void 0:a.message)||"Ticket updated successfully!"),n(),t.invalidateQueries({queryKey:["ticket-list"]})},onError:a=>{var i,u;g.error(((u=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:u.message)||(a==null?void 0:a.message)||"Update failed")}})};return s?e.jsx(y,{appear:!0,show:c,as:x.Fragment,children:e.jsxs(p,{as:"div",className:"relative z-50",onClose:n,children:[e.jsx(y.Child,{as:x.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center px-4 py-6 text-center",children:e.jsx(y.Child,{as:x.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(p.Panel,{className:"w-full max-w-lg transform overflow-hidden rounded-xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(p.Title,{as:"h3",className:"text-lg font-semibold text-gray-900",children:"Update Ticket"}),e.jsx(A,{buttons:[{label:"Close",onClick:()=>n(),variant:"danger"}]})]}),e.jsxs("form",{onSubmit:r(m),className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ticket Type"}),e.jsx("input",{type:"text",value:s.type||"",disabled:!0,className:"input bg-gray-100 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction ID"}),e.jsx("input",{type:"text",value:s.transaction_id||"",disabled:!0,className:"input bg-gray-100 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:s.description||"",disabled:!0,className:"input bg-gray-100 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{...l("status"),defaultValue:s.status,className:"input",children:[e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"IN_PROGRESS",children:"IN PROGRESS"}),e.jsx("option",{value:"RESOLVED",children:"RESOLVED"}),e.jsx("option",{value:"REJECTED",children:"REJECTED"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Comment"}),e.jsx("textarea",{...l("adminComment"),className:"input min-h-[100px]",placeholder:"Write admin comment here"})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:n,className:"rounded border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700",children:"Save"})]})]})]})})})})]})}):null}const O=c=>{const n=f();return T({mutationFn:async s=>{const{data:t}=await C.post("/ticket-reply/",s);return t.data},onSuccess:()=>{g.success("Reply sent successfully"),n.invalidateQueries({queryKey:["ticket-replies",c]}),n.invalidateQueries({queryKey:["ticket-list"]})},onError:s=>{var t,l;g.error(((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to send reply")}})};function _({isOpen:c,closeModal:n,ticket:s}){var o;if(!s)return e.jsx(e.Fragment,{});const[t,l]=x.useState(""),r=x.useRef(null),{mutate:d,isPending:h}=O(s.id),m=()=>{t.trim()&&(d({ticketId:s.id,senderRole:"ADMIN",message:t.trim()}),l(""),n())};return x.useEffect(()=>{const a=r.current;a&&(a.scrollTop=a.scrollHeight)},[s.replies]),e.jsx(y,{appear:!0,show:c,as:x.Fragment,children:e.jsxs(p,{as:"div",className:"relative z-50",onClose:n,children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm"}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsxs(p.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded-xl bg-white text-left shadow-xl transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-green-600 text-white",children:[e.jsxs("div",{children:[e.jsx(p.Title,{className:"text-lg font-semibold",children:"Ticket Chat"}),e.jsx("p",{className:"text-sm text-green-100",children:s.transaction_id||"No Transaction ID"})]}),e.jsx("button",{onClick:n,children:e.jsx("span",{className:"material-symbols-outlined text-xl",children:"close"})})]}),e.jsxs("div",{className:"px-4 py-2 bg-green-50 text-sm text-gray-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",s.type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.description]})]}),e.jsx("div",{ref:r,className:"px-4 py-3 h-[400px] overflow-y-auto space-y-3 bg-gray-100",children:(o=s.replies)!=null&&o.length?s.replies.map(a=>{const i=a.senderRole==="ADMIN";return e.jsx("div",{className:`flex ${i?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`rounded-2xl px-4 py-2 max-w-xs text-sm shadow-md ${i?"bg-green-600 text-white rounded-br-none":"bg-white text-gray-800 rounded-bl-none"}`,children:[e.jsx("p",{className:"mb-1",children:a.message}),e.jsx("p",{className:"text-[10px] text-right opacity-70",children:new Date(a.createdAt).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!0,day:"numeric",month:"short"})})]})},a.id)}):e.jsx("p",{className:"text-center text-sm text-gray-500",children:"No replies yet."})}),e.jsxs("div",{className:"flex items-center gap-2 p-4 border-t bg-white",children:[e.jsx("input",{type:"text",placeholder:"Type a message...",className:"flex-1 border rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500",value:t,onChange:a=>l(a.target.value),onKeyDown:a=>a.key==="Enter"&&m()}),e.jsx("button",{onClick:m,disabled:h||!t.trim(),className:"bg-green-600 hover:bg-green-700 text-white rounded-full p-2 disabled:opacity-50",children:e.jsx("span",{className:"material-symbols-outlined",children:"send"})})]})]})})})]})})}const B=()=>{const{handlePageChange:c,handlePageSizeChange:n,pageNumber:s,pageSizeValue:t,startItem:l}=E(),{date:r,status:d}=S(),{openModal:h,isModalOpen:m,closeModal:o,data:a}=R(),{data:i,isLoading:u,isError:b}=L({...d!=="All"&&{status:d==="Pending"?"PENDING":"RESOLVED"},date:r,pageNumber:s,pageSize:t});return e.jsxs(j.div,{className:"bg-white shadow-lg rounded-2xl",variants:D,initial:"hidden",animate:"visible",children:[e.jsx(k,{title:`Tickets List ${d} - ${r}`}),e.jsxs("div",{className:"custom-scroll h-[72vh] overflow-auto",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 border-b text-xs uppercase text-gray-500 sticky top-0 z-40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"S.N"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"User Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"TX ID"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"description"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"admin Reply"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-nowrap text-right",children:"Actions"})]})}),!b&&!u&&i&&i.results.length!==0&&e.jsx(z,{data:i.results,start_number:l,openModal:h})]}),u&&e.jsx(P,{}),!u&&(!(i!=null&&i.results)||i.results.length===0)&&e.jsx(N,{}),b&&!u&&e.jsx(N,{})]}),e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.3},children:[e.jsx(F,{currentPage:s,handlePageChange:c,pageSize:t,handlePageSizeChange:n,totalCount:(i==null?void 0:i.pagination.total)||0}),e.jsx(V,{isOpen:m.isTicket||!1,closeModal:()=>o({isTicket:!1}),ticket:a}),e.jsx(_,{isOpen:m.isReplyTicket||!1,closeModal:()=>o({isReplyTicket:!1}),ticket:a})]})]})};export{B as default};
