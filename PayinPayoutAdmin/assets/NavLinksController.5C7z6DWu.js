import{u as A,a as N,b as S,V as b,c as C,r as P,Z as F,p as L,j as c,L as B,P as U}from"./index.huOq2yLe.js";const Q=async r=>{const{data:e}=await C.get("/permission",{params:{user_id:r}});return e},T=async r=>{const{data:e}=await C.post("/create-permission",r);return e},O=async r=>{const{data:e}=await C.put("/update-permission",r);return e},D=r=>A({queryKey:["permissions",r],queryFn:async()=>(await Q(r)).data||[],enabled:!!r}),R=()=>{const r=N();return S({mutationFn:T,onSuccess:(e,l)=>{b.success(e.message||"Permissions created successfully"),r.invalidateQueries({queryKey:["permissions",l.user_id]})},onError:e=>{var l,p;b.error(((p=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:p.message)||"Failed to create permissions")}})},V=()=>{const r=N();return S({mutationFn:O,onSuccess:(e,l)=>{b.success(e.message||"Permissions updated successfully"),r.invalidateQueries({queryKey:["permissions",l.user_id]})},onError:e=>{var l,p;b.error(((p=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:p.message)||"Failed to update permissions")}})},W=()=>{const r=N();return S({mutationFn:async e=>{const{data:l}=await C.delete("/delete-permission",{data:e});return l},onSuccess:e=>{r.invalidateQueries({queryKey:["permissions"]}),b.success(e.message||"Permissions deleted successfully")},onError:e=>{var l,p;b.error(((p=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:p.message)||"Failed to delete permissions")}})},Z=()=>{const r=P.useMemo(()=>F,[]),{user_id:e}=L(),{data:l=[],isLoading:p}=D(e||""),x=Array.isArray(l)?l:[],j=R(),w=V(),y=W(),v=f=>{e&&(f.create.length>0&&j.mutate({user_id:e,create:f.create}),f.update.length>0&&w.mutate({user_id:e,update:f.update}),f.delete.length>0&&y.mutate({delete:f.delete}))};return p?c.jsx(B,{}):c.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8",children:[c.jsx("div",{className:"sticky top-0",children:c.jsx(U,{title:"Permissions Control",showBackButton:!1})}),c.jsx(G,{navLinks:r,userLinks:x,onSave:v})]})},G=({navLinks:r,userLinks:e,onSave:l})=>{const[p,x]=P.useState({}),[j,w]=P.useState({}),[y,v]=P.useState({});P.useEffect(()=>{const t={},n={},d={},u=(s,a)=>{const o=a?`${a}-${s.name}|${s.path}`:`${s.name}|${s.path}`,i=e.find(m=>m.path===s.path);t[o]=!!i,n[o]={read:(i==null?void 0:i.read)||!1,write:(i==null?void 0:i.write)||!1},d[o]=s.path};r.forEach(s=>{var a;u(s),(a=s.children)==null||a.forEach(o=>u(o,s.name))}),x(t),w(n),v(d)},[r,e]);const f=(t,n,d)=>{w(u=>({...u,[t]:{read:n,write:d}}))},M=(t,n,d=[])=>{x(u=>{const s={...u,[t]:n};return d.forEach(a=>s[a]=n),s}),f(t,n,n),d.forEach(u=>f(u,n,n))},E=(t,n)=>{x(d=>({...d,[t]:n})),f(t,n,n)},$=(t,n,d)=>{w(u=>{var a,o;const s={...u,[t]:{...u[t],[n]:d}};if(x(i=>({...i,[t]:s[t].read||s[t].write})),t.includes("-")){const i=t.split("-")[0],m=Object.keys(y).find(h=>h.startsWith(i)&&!h.includes("-"));if(m){const K=Object.keys(y).filter(g=>g.startsWith(i+"-")).some(g=>s[g].read||s[g].write),q=((a=s[m])==null?void 0:a.read)||((o=s[m])==null?void 0:o.write)||K;x(g=>({...g,[m]:q}))}}return s})},k=()=>{const t=[],n=[],d=[],u=new Map(e.map(s=>[s.path,s]));Object.entries(p).forEach(([s,a])=>{const o=y[s],[i]=s.split("|"),m=j[s],h=u.get(o);a?h?(m.read!==h.read||m.write!==h.write)&&n.push({id:h.id,name:i,path:o,read:m.read,write:m.write}):t.push({name:i,path:o,read:m.read,write:m.write}):h&&d.push({id:h.id})}),l({create:t,update:n,delete:d})};return c.jsxs("div",{className:"p-4 max-w-5xl mx-auto text-sm",children:[c.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Permissions Management"}),c.jsx("div",{className:"space-y-3",children:r.map(t=>{var u,s;const n=`${t.name}|${t.path}`,d=((u=t.children)==null?void 0:u.map(a=>`${t.name}-${a.name}|${a.path}`))||[];return c.jsxs("div",{className:"border rounded p-3 bg-white shadow-sm",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("label",{className:"flex items-center gap-2 font-medium",children:[c.jsx("input",{type:"checkbox",checked:p[n]||!1,onChange:a=>M(n,a.target.checked,d)}),t.name]}),c.jsx("div",{className:"flex gap-4",children:["read","write"].map(a=>{var o;return c.jsxs("label",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"checkbox",checked:((o=j[n])==null?void 0:o[a])||!1,onChange:i=>$(n,a,i.target.checked)}),a.charAt(0).toUpperCase()+a.slice(1)]},a)})})]}),((s=t.children)==null?void 0:s.length)&&c.jsx("div",{className:"ml-6 mt-3 space-y-2",children:t.children.map(a=>{const o=`${t.name}-${a.name}|${a.path}`;return c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("label",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",checked:p[o]||!1,onChange:i=>E(o,i.target.checked)}),a.name]}),c.jsx("div",{className:"flex gap-4",children:["read","write"].map(i=>{var m;return c.jsxs("label",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"checkbox",checked:((m=j[o])==null?void 0:m[i])||!1,onChange:h=>$(o,i,h.target.checked)}),i.charAt(0).toUpperCase()+i.slice(1)]},i)})})]},o)})})]},n)})}),c.jsx("button",{onClick:k,className:"mt-6 px-5 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save Changes"})]})};export{Z as default};
