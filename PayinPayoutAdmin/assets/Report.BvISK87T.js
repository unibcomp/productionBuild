import{u as P,a as _,l as q,r as j,j as e,m as I,P as L,V as h}from"./index.0M3KEVIp.js";import{d as O,a as T,b as U}from"./DownloadFile.DKytvTbd.js";import{u as $}from"./useUsers.Gjo29-bt.js";const M=m=>{const{startDate:s="",endDate:o="",actions:a=[],type:l="",date:n="",user_id:u="",enabled:y=!0}=m,i={...s&&{startDate:s},...o&&{endDate:o},...l&&{type:l},...n&&{date:n},...u&&{user_id:u},...a.length&&{actions:a.join(",")}};return P({queryKey:["transaction-report",i],queryFn:async()=>{const c=new URLSearchParams(i);return(await _.get(`/file/downloding/?${c.toString()}`)).data.data},enabled:y&&!!s&&!!o&&!!a.length&&!!l&&!!n,staleTime:5*60*1e3})},z=["ALL","SUCCESS","PENDING","PROCESSING","REJECTED","REVERSE"],D=m=>{const s=new Date,o=s.toISOString().split("T")[0];let a;switch(m){case"today":a=o;break;case"7d":a=new Date(s.setDate(s.getDate()-7)).toISOString().split("T")[0];break;case"14d":a=new Date(s.setDate(s.getDate()-14)).toISOString().split("T")[0];break;case"1m":a=new Date(s.setMonth(s.getMonth()-1)).toISOString().split("T")[0];break;default:a=""}return{start:a,end:o}},B=({mode:m})=>{const{register:s,handleSubmit:o,setValue:a,watch:l,formState:{errors:n}}=q({defaultValues:{dateRange:"",startDate:"",endDate:"",actions:[],format:""}}),[u,y]=j.useState(null),i=l("search"),{data:c}=$({pageNumber:1,pageSize:10,searchQuery:(i==null?void 0:i.trim())??""}),[p,v]=j.useState(!1),[w,N]=j.useState(!1),d=l("actions"),b=l("dateRange"),S=l("startDate"),k=l("endDate"),R=t=>{const r=d.includes(t)?d.filter(x=>x!==t):[...d,t];a("actions",r),N(!1)},f=async t=>{if(!g||g.length===0){h.error("No data available to export.");return}const r=`${b||"report"}_${Date.now()}`;switch(t){case"pdf":await U(g,r);break;case"excel":await T(g,r);break;case"csv":await O(g,r);break;default:h.error("Invalid format selected.");return}h.success("Report downloaded successfully.")},C=t=>{if(t.actions.length===0){h.error("Please select at least one action.");return}if(t.dateRange!=="custom"){const{start:r,end:x}=D(t.dateRange);t.startDate=r,t.endDate=x,a("startDate",r),a("endDate",x)}v(!0)},{data:g,isLoading:E}=M({startDate:S,endDate:k,actions:d,date:b,type:m.toUpperCase(),enabled:p,...u&&{user_id:u}});return e.jsxs(I.div,{className:"bg-white shadow-lg rounded-2xl min-h-screen",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx(L,{title:`${m} Report`}),e.jsxs("form",{onSubmit:o(C),className:"p-6 space-y-8 text-gray-800 bg-white rounded-2xl shadow",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Date Range"}),e.jsxs("select",{...s("dateRange",{required:"Date range is required"}),onChange:t=>{const r=t.target.value;if(a("dateRange",r),r!=="custom"){const{start:x,end:A}=D(r);a("startDate",x),a("endDate",A)}else a("startDate",""),a("endDate","")},className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"14d",children:"Last 14 Days"}),e.jsx("option",{value:"1m",children:"Last 1 Month"}),e.jsx("option",{value:"custom",children:"Custom"})]}),n.dateRange&&e.jsx("p",{className:"text-sm text-red-600",children:n.dateRange.message})]}),b==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",...s("startDate",{required:"Start date is required"}),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"}),n.startDate&&e.jsx("p",{className:"text-sm text-red-600",children:n.startDate.message})]}),b==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",...s("endDate",{required:"End date is required"}),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"}),n.endDate&&e.jsx("p",{className:"text-sm text-red-600",children:n.endDate.message})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Actions"}),e.jsx("div",{className:"w-full border border-gray-300 rounded-lg px-4 py-2 cursor-pointer bg-white",onClick:()=>N(!w),children:d.length>0?d.join(", "):"Select actions"}),w&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow p-3",children:z.map(t=>e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:d.includes(t),onChange:()=>R(t),className:"accent-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t})]},t))}),d.length===0&&p&&e.jsx("p",{className:"text-sm text-red-600",children:"Please select at least one action"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Search (Mobile or Name)"}),e.jsx("input",{type:"text",placeholder:"Enter mobile or name",...s("search"),className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"}),i&&Array.isArray(c==null?void 0:c.data)&&c.data.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:c.data.map(t=>e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-800 hover:bg-blue-100 cursor-pointer",onClick:()=>{a("search",`${t.full_name} (${t.mobile})`),y(t.user_id)},children:[e.jsx("div",{className:"font-medium",children:t.full_name||"Unnamed User"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.mobile})]},t.user_id))})]})]}),e.jsx("div",{className:"flex justify-end",children:p?E?e.jsxs("button",{type:"button",disabled:!0,className:"bg-gray-300 text-gray-700 font-semibold px-6 py-3 rounded-xl shadow flex items-center gap-2 cursor-not-allowed",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Loading..."]}):e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>f("pdf"),className:"bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"picture_as_pdf"}),"PDF"]}),e.jsxs("button",{type:"button",onClick:()=>f("excel"),className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"grid_on"}),"Excel"]}),e.jsxs("button",{type:"button",onClick:()=>f("csv"),className:"bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"description"}),"CSV"]})]}):e.jsxs("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-xl shadow transition-all flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),"Generate Report"]})})]})]})};export{B as default};
