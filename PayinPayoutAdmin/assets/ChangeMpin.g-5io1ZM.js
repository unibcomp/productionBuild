import{r as x,l as _,q as $,j as e,m as g,P as V,V as p}from"./index.DsbNlJU-.js";import{u as E,a as L,F as R}from"./useForgetPassword.CB1uYuCf.js";import{a as z}from"./useMpin.DFAFAD1z.js";import{m as A}from"./maskContact.DrZG2-eQ.js";const y=["Send OTP","Verify OTP","Set New MPIN"],J=()=>{const[i,u]=x.useState(0),[l,I]=x.useState("mobile"),[n,S]=x.useState(!1),[h,k]=x.useState(!1),[c,b]=x.useState(!1),[o,f]=x.useState(!1),{user:s}=_(),{register:m,handleSubmit:O,formState:{errors:a,isSubmitting:N},watch:w}=$(),{mutateAsync:F}=E(),{mutateAsync:q}=L(),{mutateAsync:j}=z();if(!s)return e.jsx("div",{children:"failed to load data"});const M=l==="email"?s==null?void 0:s.email:s==null?void 0:s.mobile,T=async t=>{var r,v,P,C;try{n?i===0?(await F({[l]:M}),p.success(`OTP sent to your ${l}`),u(1)):i===1?(await q({user_id:s==null?void 0:s.user_id,[`${l}Otp`]:t.otp}),p.success("OTP verified"),u(2)):i===2&&await j({newMpin:t.newMpin,confirmMpin:t.confirmMpin},{onSuccess:()=>{p.success("MPIN changed successfully"),u(0)}}):await j({currentMpin:t.currentMpin,newMpin:t.newMpin,confirmMpin:t.confirmMpin},{onSuccess:()=>{p.success("MPIN changed successfully")}})}catch(d){p.error(((v=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:v.message)||((C=(P=d==null?void 0:d.response)==null?void 0:P.data)==null?void 0:C.error)||"Something went wrong")}};return e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"min-h-screen flex items-center justify-center bg-gradient-to-r from-[#101F33] to-[#0D2B2F] px-4",children:e.jsxs(g.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2},className:"w-full max-w-md bg-[#1a2c33] text-white border border-[#2a3e4c] shadow-2xl rounded-xl overflow-hidden",children:[e.jsx(V,{title:"Change MPIN",searchComponent:e.jsx(e.Fragment,{})}),e.jsxs("div",{className:"p-6 md:p-8 space-y-6",children:[n&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-4 left-[10%] right-[10%] h-1 bg-gray-600 z-0 rounded-full",children:e.jsx("div",{className:"h-1 bg-green-500 rounded-full transition-all duration-500",style:{width:`${i/(y.length-1)*100}%`}})}),e.jsx("div",{className:"flex justify-between relative z-10",children:y.map((t,r)=>e.jsxs("div",{className:"flex flex-col items-center",style:{width:`${80/y.length}%`},children:[e.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold ${r===i?"bg-cyan-500":r<i?"bg-green-500":"bg-gray-600 text-gray-300"} text-white`,children:r+1}),e.jsx("p",{className:`text-xs mt-1 ${r===i?"text-cyan-300":"text-gray-400"}`,children:t})]},t))})]}),e.jsxs("form",{onSubmit:O(T),className:"space-y-6 mt-4",children:[!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"Current MPIN"}),e.jsx("input",{type:h?"text":"password",maxLength:6,...m("currentMpin",{required:"Current MPIN is required"}),className:"w-full py-3 px-4 rounded-md bg-white text-gray-900 pr-12"}),e.jsx("span",{className:"material-symbols-outlined absolute right-3 top-10 cursor-pointer text-gray-700",onClick:()=>k(!h),children:h?"visibility_off":"visibility"}),a.currentMpin&&e.jsx("p",{className:"text-red-400 text-sm",children:a.currentMpin.message})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"New MPIN"}),e.jsx("input",{type:c?"text":"password",maxLength:6,...m("newMpin",{required:"New MPIN is required",pattern:{value:/^\d{6}$/,message:"MPIN must be 6 digits"}}),className:"w-full py-3 px-4 rounded-md bg-white text-gray-900 pr-12"}),e.jsx("span",{className:"material-symbols-outlined absolute right-3 top-10 cursor-pointer text-gray-700",onClick:()=>b(!c),children:c?"visibility_off":"visibility"}),a.newMpin&&e.jsx("p",{className:"text-red-400 text-sm",children:a.newMpin.message})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"Confirm MPIN"}),e.jsx("input",{type:o?"text":"password",maxLength:6,...m("confirmMpin",{validate:t=>t===w("newMpin")||"Confirm MPIN does not match"}),className:"w-full py-3 px-4 rounded-md bg-white text-gray-900 pr-12"}),e.jsx("span",{className:"material-symbols-outlined absolute right-3 top-10 cursor-pointer text-gray-700",onClick:()=>f(!o),children:o?"visibility_off":"visibility"}),a.confirmMpin&&e.jsx("p",{className:"text-red-400 text-sm",children:a.confirmMpin.message})]})]}),n&&i===0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"Choose Method"}),e.jsxs("select",{onChange:t=>I(t.target.value),value:l,className:"w-full py-3 px-4 rounded-md bg-white text-gray-900",children:[e.jsx("option",{value:"mobile",children:"Mobile"}),e.jsx("option",{value:"email",children:"Email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200 capitalize",children:l}),e.jsx("input",{type:"text",readOnly:!0,value:A(l,M),className:"w-full py-3 px-4 rounded-md bg-gray-100 text-gray-900"})]})]}),n&&i===1&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"Enter OTP"}),e.jsx("input",{type:"text",...m("otp",{required:"OTP is required"}),className:"w-full py-3 px-4 rounded-md bg-white text-gray-900"}),a.otp&&e.jsx("p",{className:"text-red-400 text-sm",children:a.otp.message})]}),n&&i===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"New MPIN"}),e.jsx("input",{type:c?"text":"password",maxLength:6,...m("newMpin",{required:"New MPIN is required",pattern:{value:/^\d{6}$/,message:"MPIN must be 6 digits"}}),className:"w-full py-3 px-4 rounded-md bg-white text-gray-900 pr-12"}),e.jsx("span",{className:"material-symbols-outlined absolute right-3 top-10 cursor-pointer text-gray-700",onClick:()=>b(!c),children:c?"visibility_off":"visibility"}),a.newMpin&&e.jsx("p",{className:"text-red-400 text-sm",children:a.newMpin.message})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-200",children:"Confirm MPIN"}),e.jsx("input",{type:o?"text":"password",...m("confirmMpin",{validate:t=>t===w("newMpin")||"MPINs do not match"}),className:"w-full py-3 px-4 rounded-md bg-white text-gray-900 pr-12"}),e.jsx("span",{className:"material-symbols-outlined absolute right-3 top-10 cursor-pointer text-gray-700",onClick:()=>f(!o),children:o?"visibility_off":"visibility"}),a.confirmMpin&&e.jsx("p",{className:"text-red-400 text-sm",children:a.confirmMpin.message})]})]}),e.jsx(g.button,{type:"submit",whileHover:{scale:1.03},whileTap:{scale:.97},disabled:N,className:"w-full py-3 bg-[#185e91] hover:bg-[#144e7a] text-white font-semibold rounded-md transition",children:N?"Processing...":n?i===0?"Send OTP":i===1?"Verify OTP":"Reset MPIN":"Change MPIN"})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{className:"text-sm text-cyan-400 hover:underline",onClick:()=>{S(!n),u(0)},children:n?"Back to Change MPIN":s!=null&&s.mpin_status?"Forgot MPIN?":"create Mpin"})})]}),e.jsx(R,{})]})})};export{J as default};
