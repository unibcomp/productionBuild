import{q as B,j as e,z as S,r as v,s as j,x as E,f as W,g as O,P as R,L as q,o as Y,p as K,N as Q,u as H,h as J,e as X,l as Z,a as _,m as L,c as ee,S as se,d as te,C as ae,V as U}from"./index.J9QQ68ld.js";import{a as re,d as ne,u as ie}from"./useDeposit.BtHpyuUh.js";import{D as le}from"./DateWiseTableBody.BkthpUGv.js";import{a as oe,M as ce}from"./MpinVerifyModal.CCtqldn1.js";import{u as de}from"./useManualPayin.B9DChpcf.js";import{u as ue}from"./useTransaction.Aw6Trlhl.js";import"./useMpin.Ct8daydb.js";const me=({transaction_id:n,closeModal:a,isOpen:l})=>{const{register:i,handleSubmit:y,formState:{errors:x}}=B(),{createUpdateUtrMutation:s}=de(),C=T=>{s.mutate({transaction_id:n,data:T},{onError:p=>{var t;const r=(t=p.response)==null?void 0:t.data;E.error((r==null?void 0:r.message)||(r==null?void 0:r.error)),a()},onSuccess:p=>{E.success(p.message||"SuccesFully Updated")}})};return e.jsx(S,{appear:!0,show:l,as:v.Fragment,children:e.jsxs(j,{as:"div",className:"relative z-50",onClose:a,children:[e.jsx(S.Child,{as:v.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(j.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded bg-white p-6 shadow-xl transition-all",children:[e.jsx(j.Title,{className:"text-lg font-medium text-gray-900 mb-4",children:"Update Utr"}),e.jsxs("form",{onSubmit:y(C),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("input",{type:"number",...i("utr",{required:"Utr is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter Utr Number"}),x.utr&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:x.utr.message})]}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-[#185e91] hover:bg-[#144e7a] text-white font-semibold rounded-md transition cursor-pointer",children:s.isPending?"Processing...":"Submit"})]})]})})})]})})},xe=(n,a,l=!0)=>W({queryKey:["taxReportByTransaction",n,a],enabled:l&&!!n&&!!a,queryFn:async()=>{const i=await O.get("/tax-report-specific-transaction",{params:{transaction_id:n,type:a}});if(!i.data.success||!i.data.data)throw new Error("No tax data found");return i.data.data}});function pe({isOpen:n,onClose:a,type:l,transaction_id:i}){const{data:y,isLoading:x}=xe(i,l,n),s=y,C=((s==null?void 0:s.companyTaxAmount)??0)+((s==null?void 0:s.gstApplyAmount)??0)+((s==null?void 0:s.resellerTaxAmount)??0)+((s==null?void 0:s.resellerGstAmount)??0);return e.jsx(S,{appear:!0,show:n,as:v.Fragment,children:e.jsxs(j,{as:"div",className:"relative z-50",onClose:a,children:[e.jsx(S.Child,{as:v.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-6",children:e.jsx(j.Panel,{className:"w-full max-w-xl transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all border border-blue-100",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsx(R,{title:"ðŸ§¾ Tax Transaction Details"}),e.jsxs("div",{className:"my-6 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 font-semibold mb-1",children:["Type: ",e.jsx("span",{className:"text-gray-800",children:l})]}),e.jsxs("div",{className:"text-sm text-gray-600 font-semibold",children:["Transaction ID:"," ",e.jsx("span",{className:"text-gray-800",children:i})]})]}),x?e.jsx(q,{}):e.jsxs("div",{className:"grid grid-cols-1 gap-2 max-h-[58vh] overflow-y-auto",children:[e.jsx(M,{label:"Total Amount",value:C||0}),e.jsx(M,{label:"Gateway Charges",value:(s==null?void 0:s.companyTaxAmount)||0}),e.jsx(M,{label:"Gateway GST",value:(s==null?void 0:s.gstApplyAmount)||0}),e.jsx(M,{label:"Company Charges",value:(s==null?void 0:s.resellerTaxAmount)||0}),e.jsx(M,{label:"Company GST",value:(s==null?void 0:s.resellerGstAmount)||0})]}),e.jsx("div",{className:"flex justify-end pt-10",children:e.jsx("button",{onClick:a,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md shadow-sm text-sm font-medium transition",children:"Close"})})]})})})})]})})}function M({label:n,value:a}){return e.jsxs("div",{className:"bg-white border border-gray-200 p-3 rounded-xl shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1",children:n}),e.jsxs("p",{className:"text-base text-gray-800 font-medium",children:["â‚¹ ",(a==null?void 0:a.toFixed(2))??"â€”"]})]})}const he=()=>{const n=Y();return K({mutationFn:async a=>(await O.put("/mannaul-paydollar-update-deposit/",a)).data,onSuccess:()=>{n.invalidateQueries({queryKey:["AllDeposits"]})}})},ye=({transaction_id:n,isOpen:a,closeModal:l,amount:i,payMethod:y,action:x,payRef:s,utr:C,completedAt:T,MannualBy:p})=>{const{register:r,handleSubmit:t,formState:{errors:o},watch:u}=B({defaultValues:{action:x,payRef:s,payMethod:y,utr:C,completedAt:T,MannualBy:p},shouldUnregister:!1}),f=he(),g=u("action"),I=h=>{const b={transaction_id:n,amount:i,action:h.action};(h.action==="SUCCESS"||h.action==="FAILED")&&(b.MannualBy=h.MannualBy),h.action==="SUCCESS"&&(b.payMethod=h.payMethod,b.payRef=h.payRef,b.utr=h.utr,b.completedAt=h.completedAt),f.mutate(b,{onSuccess:A=>{E.success(A.message||"Deposit updated successfully!"),l()},onError:A=>{var c;const N=(c=A.response)==null?void 0:c.data;E.error((N==null?void 0:N.message)||(N==null?void 0:N.error)||"Something went wrong"),l()}})};return e.jsx(S,{appear:!0,show:a,as:v.Fragment,children:e.jsxs(j,{as:"div",className:"relative z-50",onClose:l,children:[e.jsx(S.Child,{as:v.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(j.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded bg-white p-6 shadow-xl transition-all",children:[e.jsx(j.Title,{className:"text-lg font-medium text-gray-900 mb-2",children:"Manual Update Deposit"}),e.jsxs("form",{onSubmit:t(I),className:"space-y-5",children:[e.jsx("div",{children:e.jsx("input",{type:"text",value:n,disabled:!0,className:"w-full py-2 px-3 rounded-md bg-gray-100 text-gray-700 border border-gray-300 focus:outline-none",placeholder:"Transaction ID"})}),e.jsx("div",{children:e.jsx("input",{type:"number",value:i,disabled:!0,className:"w-full py-2 px-3 rounded-md bg-gray-100 text-gray-700 border border-gray-300 focus:outline-none",placeholder:"Amount"})}),e.jsxs("div",{children:[e.jsxs("select",{...r("action",{required:"Action is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Action"}),e.jsx("option",{value:"PENDING",children:"PENDING"}),e.jsx("option",{value:"INITIATED",children:"INITIATED"}),e.jsx("option",{value:"PROCESSING",children:"PROCESSING"}),e.jsx("option",{value:"FAILED",children:"FAILED"}),e.jsx("option",{value:"SUCCESS",children:"SUCCESS"})]}),o.action&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:o.action.message})]}),(g==="SUCCESS"||g==="FAILED")&&e.jsxs("div",{children:[e.jsx("input",{type:"text",...r("MannualBy",{required:"Please enter your name"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter Your Name"}),o.MannualBy&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:o.MannualBy.message})]}),g==="SUCCESS"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("select",{...r("payMethod",{required:"Pay Method is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Pay Method"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"UPICC",children:"UPICC"}),e.jsx("option",{value:"Debit Card",children:"Debit Card"}),e.jsx("option",{value:"Credit Card",children:"Credit Card"}),e.jsx("option",{value:"wallet",children:"Wallet"})]}),o.payMethod&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:o.payMethod.message})]}),e.jsxs("div",{children:[e.jsx("input",{type:"text",...r("payRef",{required:"Pay Reference is required"}),defaultValue:s,className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter Pay Reference"}),o.payRef&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:o.payRef.message})]}),e.jsxs("div",{children:[e.jsx("input",{type:"text",...r("utr",{required:"UTR is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none",placeholder:"Enter UTR Number"}),o.utr&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:o.utr.message})]}),e.jsxs("div",{children:[e.jsx("input",{type:"datetime-local",...r("completedAt",{required:"Completed At is required"}),className:"w-full py-2 px-3 rounded-md bg-white text-gray-900 border border-gray-300 focus:ring-2 focus:ring-[#185e91] focus:outline-none"}),o.completedAt&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:o.completedAt.message})]})]}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-[#185e91] hover:bg-[#144e7a] text-white font-semibold rounded-md transition cursor-pointer",children:f.isPending?"Processing...":"Submit"})]})]})})})]})})};function fe({isOpen:n,onClose:a,transaction_id:l}){const{data:i,isLoading:y,isError:x}=ue({searchQuery:l}),s=i==null?void 0:i.result;return e.jsx(S,{appear:!0,show:n,as:v.Fragment,children:e.jsxs(j,{as:"div",className:"relative z-50",onClose:a,children:[e.jsx(S.Child,{as:v.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-6",children:e.jsx(j.Panel,{className:"w-full max-w-5xl transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all border border-blue-100",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsx(R,{title:"ðŸ“„ Transaction Details"}),e.jsxs("div",{className:"my-6 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 font-semibold mb-1",children:["Transaction ID:"," ",e.jsx("span",{className:"text-gray-800 break-all",children:l})]}),(s==null?void 0:s.status)&&e.jsx("span",{className:`inline-block mt-2 px-3 py-1 rounded-full text-xs font-semibold
                        ${s.status==="SUCCESS"?"bg-green-100 text-green-700":s.status==="PENDING"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:s.status})]}),y?e.jsx(q,{}):x||!s?e.jsx(Q,{message:"Transaction not found"}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 max-h-[58vh] overflow-y-auto",children:[e.jsx(w,{label:"Type",value:s.type}),e.jsx(w,{label:"Amount",value:`â‚¹ ${s.amount}`}),e.jsx(w,{label:"Payable Amount",value:`â‚¹ ${s.payBaleAmount}`}),e.jsx(w,{label:"Tax Amount",value:`â‚¹ ${s.taxAmount}`}),e.jsx(w,{label:"Created At",value:s.createdAt}),s.completedAt&&e.jsx(w,{label:"Completed At",value:s.completedAt}),s.method&&e.jsx(w,{label:"Method",value:s.method}),s.utr&&e.jsx(w,{label:"UTR",value:s.utr})]}),e.jsx("div",{className:"flex justify-end pt-10",children:e.jsx("button",{onClick:a,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md shadow-sm text-sm font-medium transition",children:"Close"})})]})})})})]})})}function w({label:n,value:a}){return e.jsxs("div",{className:"bg-white border border-gray-200 p-3 rounded-xl shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1",children:n}),e.jsx("p",{className:"text-sm text-gray-800 font-medium break-all",children:a??"â€”"})]})}const Ce=()=>{var z,G;const[n,a]=v.useState("All"),l=["All","GATEPAY","PAYU"],{handlePageChange:i,handlePageSizeChange:y,pageNumber:x,pageSizeValue:s,startItem:C}=H(),{openModal:T,isModalOpen:p,closeModal:r,data:t}=J(),{date:o,status:u,type:f}=X(),{user:g}=Z(),I=f==="Pay-In",{setSearchQuery:h,searchQuery:b}=_(),{updateDepositMutation:A}=re(),{updateReverseMutation:N}=ne(),{data:c,isError:V,isLoading:F,refetch:k}=f==="Pay-In"?ie({searchQuery:b,pageNumber:x,pageSize:s,date:o,status:u==null?void 0:u.toUpperCase(),gateway:n},I):oe({searchQuery:b,pageNumber:x,pageSize:s,date:o,status:u==null?void 0:u.toUpperCase()}),$=d=>{d!=null&&d.transaction_id&&(d!=null&&d.isReverse)?N.mutate(d.transaction_id,{onSuccess:()=>{k(),U.success("Action  Completed SuccessFully"),r({isVerifyMpin:!1})},onError:D=>{var P;const m=(P=D.response)==null?void 0:P.data;U.error((m==null?void 0:m.message)||(m==null?void 0:m.error)),r({isVerifyMpin:!1})}}):A.mutate(d,{onSuccess:()=>{k(),U.success("Action  Completed SuccessFully"),r({isVerifyMpin:!1})},onError:D=>{var P;const m=(P=D.response)==null?void 0:P.data;U.error((m==null?void 0:m.message)||(m==null?void 0:m.error)),r({isVerifyMpin:!1})}})};return e.jsxs(L.div,{className:"bg-white shadow-lg rounded-2xl",variants:ee,initial:"hidden",animate:"visible",children:[e.jsx(R,{title:`${f} ${u} List`,searchComponent:e.jsx(se,{handlePageSizeChange:y,pageSizeOptions:[10,20,30],pageSize:s,setSearchQuery:h})}),f==="Pay-In"&&!["mannualsuccess","manualpending","manualfailed"].includes((u==null?void 0:u.toLowerCase())||"")&&(g==null?void 0:g.role)==="SUPERADMIN"&&e.jsx("div",{className:"flex justify-end mr-2 mt-2 mb-2",children:e.jsx("select",{value:n,onChange:d=>a(d.target.value),className:"p-2 pr-8 rounded-xl border border-gray-300 shadow-sm bg-gradient-to-r from-blue-100 to-blue-200 text-gray-700 font-medium hover:from-blue-200 hover:to-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition",children:l.map(d=>e.jsx("option",{value:d,children:d},d))})}),e.jsxs("div",{className:"custom-scroll h-[72vh] overflow-auto",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 border-b text-xs uppercase text-gray-500 sticky top-0 z-40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"S.N"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Mobile"}),((z=g==null?void 0:g.role)==null?void 0:z.toUpperCase())==="SUPERADMIN"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Reseller Name"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Mode"}),f==="Pay-In"&&e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Type"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Utr"}),f==="Pay-In"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Payment Ref"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"file"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Settled Date"})]}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Transaction Id"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Initiated At"}),e.jsx("th",{className:"px-4 py-3 text-nowrap",children:"Completed At"}),e.jsx("th",{className:"px-4 py-3 text-center text-nowrap",children:"Actions"})]})}),!V&&((G=c==null?void 0:c.results)==null?void 0:G.length)!=0&&!F&&e.jsx(le,{data:(c==null?void 0:c.results)||[],openModal:T,isPending:F,type:f,status:u,start_number:C})]}),F?e.jsx(q,{}):(V||(c==null?void 0:c.results.length)===0)&&e.jsx(Q,{})]}),e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.3},children:[e.jsx(te,{currentPage:x,handlePageChange:i,pageSize:s,handlePageSizeChange:y,totalCount:(c==null?void 0:c.pagination.total)||1}),e.jsx(ae,{isOpen:p.confirm||!1,onClose:()=>r({confirm:!1}),onConfirm:()=>T({isVerifyMpin:!0},t),disabled:A.isPending,title:"Transaction",description:"Are you sure you want to Change this Transaction ?"}),e.jsx(ce,{isOpen:p.isVerifyMpin||!1,closeModal:()=>r({isVerifyMpin:!1}),onVerify:()=>$(t),isNextTaskPending:A.isPending}),e.jsx(me,{transaction_id:t==null?void 0:t.transaction_id,isOpen:p.isUtr||!1,closeModal:()=>r({isUtr:!1})}),e.jsx(ye,{isOpen:p.isMannualUpdateDeposit||!1,closeModal:()=>r({isMannualUpdateDeposit:!1}),transaction_id:t==null?void 0:t.transaction_id,amount:t==null?void 0:t.amount,payMethod:t==null?void 0:t.payMethod,payRef:t==null?void 0:t.payRef}),e.jsx(pe,{isOpen:p.isTaxDetails||!1,onClose:()=>r({isTaxDetails:!1}),type:t==null?void 0:t.type,transaction_id:t==null?void 0:t.transaction_id}),e.jsx(fe,{isOpen:p.isTransactionDetails||!1,onClose:()=>r({isTransactionDetails:!1}),transaction_id:t==null?void 0:t.transaction_id})]})]})};export{Ce as default};
