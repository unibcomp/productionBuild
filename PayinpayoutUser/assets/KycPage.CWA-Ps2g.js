import{n as A,o as T,p as O,a as _,j as e,V as E,r as N,q as K,s as ee,t as te,E as se,v as re,w as ae,m as $,g as ne,P as ie,L as oe,N as le}from"./index.D_2yFTP8.js";const ce=()=>A({mutationFn:async n=>(await T.post("/kyc/personal",n)).data}),de=({setKycPage:n})=>{const{mutate:s,isPending:h}=ce(),{user:d,refetch:x}=O(),{register:u,handleSubmit:i,formState:{errors:o},reset:m}=_({defaultValues:{address:d==null?void 0:d.address,dateOfBirth:(d==null?void 0:d.dateOfBirth)&&(d==null?void 0:d.dateOfBirth.split("T")[0]),firstName:d==null?void 0:d.firstName,lastName:d==null?void 0:d.lastName,pincode:d==null?void 0:d.pincode}}),p=b=>{s(b,{onSuccess:g=>{E.success(g.message),n(g.kycPage),x(),m()},onError:g=>{var t,l;const c=(t=g.response)==null?void 0:t.data,r=Array.isArray(c==null?void 0:c.error)?(l=c==null?void 0:c.error)==null?void 0:l.join(","):c!=null&&c.message?c.message:(c==null?void 0:c.error)||"Something went wrong";E.error(r)}})};return e.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Personal Information"}),!["PENDING","REJECTED"].includes(d==null?void 0:d.personalInformationStatus)&&e.jsxs("button",{onClick:()=>n("aadhar"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:i(p),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"First Name"}),e.jsx("input",{type:"text",...u("firstName",{required:"First name is required"}),className:`w-full px-4 py-2 rounded-xl border ${o.firstName?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),o.firstName&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.firstName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",...u("lastName",{required:"Last name is required"}),className:`w-full px-4 py-2 rounded-xl border ${o.lastName?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),o.lastName&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.lastName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",...u("dateOfBirth",{required:"Date of birth is required"}),className:`w-full px-4 py-2 rounded-xl border ${o.dateOfBirth?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),o.dateOfBirth&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.dateOfBirth.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",...u("address",{required:"Address is required"}),className:`w-full px-4 py-2 rounded-xl border ${o.address?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),o.address&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.address.message})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Pincode"}),e.jsx("input",{type:"text",...u("pincode",{required:"Pincode is required"}),className:`w-full px-4 py-2 rounded-xl border ${o.pincode?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),o.pincode&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o.pincode.message})]})]}),e.jsx("button",{type:"submit",disabled:h,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-50",children:h?"Saving...":"Continue"})]})]})})},ue=()=>A({mutationFn:async n=>(await T.post("/kyc/aadhar/init",n)).data}),me=()=>A({mutationFn:async n=>(await T.post("/kyc/aadhar/otpVerify",n)).data}),pe=({setKycPage:n})=>{const{user:s,refetch:h}=O(),{register:d,handleSubmit:x,setValue:u,getValues:i,reset:o,formState:{errors:m}}=_({defaultValues:{aadharNumber:s==null?void 0:s.aadharNumber}});N.useEffect(()=>{s&&o(s)},[s,o]);const[p,b]=N.useState(!1),[g,y]=N.useState(""),[c,r]=N.useState(!1),[t,l]=N.useState(null),[a,v]=N.useState(!1),f=ue(),j=me(),U=async P=>{try{b(!0);const w=await K(P);u("aadharImageUrl",w,{shouldValidate:!0}),y(w),E.success("Image uploaded successfully")}catch{E.error("Image upload failed")}finally{b(!1)}},k=async()=>{const P=i();if(!P.aadharNumber&&!(s!=null&&s.aadharNumber)||!P.aadharImageUrl&&!(s!=null&&s.aadharImageUrl))return E.error("Please provide Aadhaar number and image.");v(!1),f.mutate({aadharNumber:P.aadharNumber||s&&s.aadharNumber,aadharImageUrl:P.aadharImageUrl||s&&s.aadharImageUrl},{onSuccess:w=>{l(w.data.ref_id),r(!0),h(),setTimeout(()=>{v(!0)},1e4),E.success("OTP sent successfully")},onError:w=>{var M,R;E.error(((R=(M=w==null?void 0:w.response)==null?void 0:M.data)==null?void 0:R.error)||"Failed to send OTP")}})},S=P=>{const{otp:w}=P;if(console.log(t,w),!t||!w)return E.error("Missing OTP or Aadhaar session data");j.mutate({ref_id:t,otp:w},{onSuccess:M=>{E.success("Aadhaar verified successfully!"),h(),n(M.kycPage)},onError:M=>{var R,V;E.error(((V=(R=M==null?void 0:M.response)==null?void 0:R.data)==null?void 0:V.error)||"OTP verification failed")}})};return e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Aadhaar Information"}),e.jsxs("button",{onClick:()=>n("personalInformation"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.aadharStatus)&&e.jsxs("button",{onClick:()=>n("pan"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:x(S),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Aadhaar Number"}),e.jsx("input",{type:"text",defaultValue:(s==null?void 0:s.aadharNumber)??"",maxLength:12,...d("aadharNumber",{required:"Aadhar number is required",pattern:{value:/^[0-9]{12}$/,message:"Aadhar number must be 12 digits"}}),onInput:P=>{const w=P.currentTarget;w.value=w.value.replace(/[^0-9]/g,"").slice(0,12)},className:`w-full px-4 py-2 rounded-xl border ${m.aadharNumber?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),m.aadharNumber&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.aadharNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Aadhaar Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:P=>{var M;const w=(M=P.target.files)==null?void 0:M[0];if(w){if(w.size>2097152){alert("File size should not exceed 2 MB"),P.target.value="";return}U(w)}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl cursor-pointer"}),p&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Uploading..."}),(g||(s==null?void 0:s.aadharImageUrl))&&/\.(jpe?g|png|webp|gif|bmp)$/i.test(g||(s==null?void 0:s.aadharImageUrl))&&e.jsx("img",{src:g||(s==null?void 0:s.aadharImageUrl)||"",alt:"Aadhaar Preview",className:"mt-3 h-32 object-contain rounded-md border"}),m.aadharImageUrl&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.aadharImageUrl.message})]})]}),e.jsx("input",{type:"hidden",defaultValue:(s==null?void 0:s.aadharImageUrl)??"",...d("aadharImageUrl",{required:"Aadhar image is required"})}),c&&e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Enter OTP"}),e.jsx("input",{type:"number",...d("otp",{required:"OTP is required"}),className:`w-full px-4 py-2 rounded-xl border ${m.otp?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),m.otp&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.otp.message}),e.jsxs("button",{type:"button",onClick:k,disabled:!a,className:`mt-3 text-sm font-semibold underline transition ${a?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,children:["Resend OTP ",!a&&"(Wait 10s)"]})]}),e.jsx("button",{type:c?"submit":"button",onClick:c?void 0:k,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-60 cursor-pointer",children:p||f.isPending||j.isPending?"Processing...":c?"Continue":"Send OTP"})]})]})})},xe=()=>A({mutationFn:async n=>{const{data:s}=await T.post("/kyc/pan/init",n);return s}}),he=({setKycPage:n})=>{const{user:s,refetch:h}=O(),{register:d,handleSubmit:x,setValue:u,formState:{errors:i}}=_(),[o,m]=N.useState(!1),[p,b]=N.useState(""),g=xe();N.useEffect(()=>{s!=null&&s.panNumber&&u("pan",s.panNumber),(s!=null&&s.firstName||s!=null&&s.lastName)&&u("name",`${s.firstName??""} ${s.lastName??""}`.trim()),s!=null&&s.panImageUrl&&(u("panImageUrl",s.panImageUrl),b(s.panImageUrl))},[s,u]);const y=async r=>{try{m(!0);const t=await K(r);u("panImageUrl",t,{shouldValidate:!0}),b(t),E.success("PAN Image uploaded successfully")}catch(t){E.error("Failed to upload image"),console.error(t)}finally{m(!1)}},c=r=>{g.mutate({pan:r.pan,name:r.name,panImageUrl:r.panImageUrl},{onSuccess:t=>{n("businessInformation"),h(),E.success(t.message||"PAN verified successfully")},onError:t=>{var l,a;E.error(((a=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:a.error)||"PAN verification failed")}})};return e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 mt-6 relative",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"PAN Verification"}),e.jsxs("button",{onClick:()=>n("aadhar"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.panStatus)&&e.jsxs("button",{onClick:()=>n("businessInformation"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:x(c),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PAN Number"}),e.jsx("input",{type:"text",maxLength:10,...d("pan",{required:"PAN number is required",pattern:{value:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Invalid PAN format"},maxLength:{value:10,message:"PAN must be 10 characters"}}),onInput:r=>{const t=r.currentTarget;t.value=t.value.toUpperCase()},className:`w-full px-4 py-2 rounded-xl border ${i.pan?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),i.pan&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.pan.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Name on PAN"}),e.jsx("input",{type:"text",...d("name",{required:"Name is required"}),className:`w-full px-4 py-2 rounded-xl border ${i.name?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),i.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.name.message})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"PAN Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:r=>{var l;const t=(l=r.target.files)==null?void 0:l[0];if(t){if(t.size>2097152){alert("File size should not exceed 2 MB"),r.target.value="";return}y(t)}},className:"w-full px-3 py-2 border border-gray-300 rounded-xl cursor-pointer"}),o&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Uploading..."}),(p||(s==null?void 0:s.panImageUrl))&&/\.(jpe?g|png|webp|gif|bmp)$/i.test(p||(s==null?void 0:s.panImageUrl))&&e.jsx("img",{src:p||(s==null?void 0:s.panImageUrl)||"",alt:"PAN Preview",className:"mt-3 h-32 object-contain rounded-md border"}),i.panImageUrl&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.panImageUrl.message})]})]}),e.jsx("button",{type:"submit",disabled:o||g.isPending,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-60",children:o||g.isPending?"Processing...":"Continue"})]})]})})},fe=()=>A({mutationFn:async n=>(await T.post("/kyc/business",n)).data}),be=({setKycPage:n})=>{const{user:s,refetch:h}=O(),{register:d,handleSubmit:x,setValue:u,watch:i,formState:{errors:o}}=_({defaultValues:{companyType:s.companyType,phoneNumber:s.phoneNumber,url:s.url,gstNumber:s.gstNumber,companyPan:s.companyPan,msmeNumber:s.msmeNumber,tan:s.tan,cin:s.tan,moa:s.moa,aoa:s.aoa}}),m=i("method"),p=i("companyType"),[b,g]=N.useState(""),y=fe(),c=async(t,l)=>{try{g(l);const a=await K(t);u(l,a,{shouldValidate:!0})}catch(a){console.error(`Upload failed for ${l}`,a),E.error("Upload failed")}finally{g("")}},r=t=>{delete t.method;const l=Object.fromEntries(Object.entries(t).filter(([,a])=>a!=null&&!(typeof a=="string"&&a.trim()==="")));y.mutate(l,{onSuccess:a=>{E.success(a.message||"Business KYC submitted successfully"),h(),n(a.kycPage)},onError:a=>{var v,f;E.error(((f=(v=a==null?void 0:a.response)==null?void 0:v.data)==null?void 0:f.error)||"Submission failed")}})};return e.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsxs("button",{onClick:()=>n("pan"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.businessStatus)&&e.jsxs("button",{onClick:()=>n("bank"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Business KYC"}),e.jsxs("form",{onSubmit:x(r),children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Choose Company Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{...d("companyType",{required:"Please select a method"}),className:"w-full appearance-none bg-white px-4 py-3 pr-10 rounded-xl border border-gray-300 shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"",children:"-- Select Company Type --"}),e.jsx("option",{value:"Proprietor",children:"Proprietor"}),e.jsx("option",{value:"opc",children:"OPC"}),e.jsx("option",{value:"private limited",children:"Private Limited"}),e.jsx("option",{value:"llp",children:"LLP"}),e.jsx("option",{value:"partnership",children:"Partnership"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-400",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M7 7l3-3 3 3m0 6l-3 3-3-3",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})})})]}),o.companyType&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.companyType.message})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Phone Number"}),e.jsx("input",{type:"text",...d("phoneNumber",{required:"Phone number is required",pattern:{value:/^[6-9][0-9]{9}$/,message:"Phone number must be 10 digits starting with 6-9"}}),className:`w-full px-4 py-2 rounded-xl border ${o.phoneNumber?"border-red-500":"border-gray-300"}`}),o.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:o.phoneNumber.message})]}),!["Proprietor","opc","partnership"].includes(p)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"CIN"}),e.jsx("input",{type:"text",...d("cin",{required:"CIN is required",pattern:{value:/^[A-Z0-9]{21}$/,message:"Invalid CIN format"}}),className:`w-full px-4 py-2 rounded-xl border ${o.cin?"border-red-500":"border-gray-300"}`}),o.cin&&e.jsx("p",{className:"text-sm text-red-500",children:o.cin.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Choose Verification Method"}),e.jsxs("select",{...d("method",{required:"Please select a method"}),className:"w-full px-4 py-2 rounded-xl border border-gray-300",children:[e.jsx("option",{value:"",children:"-- Select Verification method"}),e.jsx("option",{value:"gst",children:"GST Number"}),p!=="Proprietor"&&e.jsxs("option",{value:"pan",children:[" ",p==="partnership"?"Firm":"Company"," PAN"]}),p==="Proprietor"&&e.jsx("option",{value:"msme",children:"Msme Number"})]}),o.method&&e.jsx("p",{className:"text-red-500 text-sm",children:o.method.message})]}),m==="gst"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"GST Number"}),e.jsx("input",{type:"text",...d("gstNumber",{required:"GST Number is required when using GST method"}),className:`w-full px-4 py-2 rounded-xl border ${o.gstNumber?"border-red-500":"border-gray-300"}`}),o.gstNumber&&e.jsx("p",{className:"text-red-500 text-sm",children:o.gstNumber.message})]}),m==="pan"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-1",children:[" ",p==="partnership"?"Firm":"Company"," PAN"]}),e.jsx("input",{type:"text",...d("companyPan",{required:"Company PAN is required when using PAN method",pattern:{value:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,message:"Invalid PAN format"}}),className:`w-full px-4 py-2 rounded-xl border ${o.companyPan?"border-red-500":"border-gray-300"}`}),o.companyPan&&e.jsx("p",{className:"text-red-500 text-sm",children:o.companyPan.message})]}),(p==="Proprietor"?m==="msme":!0)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"MSME Number"}),e.jsx("input",{type:"text",...d("msmeNumber"),className:"w-full px-4 py-2 rounded-xl border border-gray-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Website / URL"}),e.jsx("input",{type:"url",...d("url"),className:`w-full px-4 py-2 rounded-xl border ${o.url?"border-red-500":"border-gray-300"}`}),o.url&&e.jsx("p",{className:"text-sm text-red-500",children:o.url.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-1",children:"TAN"}),e.jsx("input",{type:"text",...d("tan"),className:"w-full px-4 py-2 rounded-xl border border-gray-300"})]}),ee.map(({label:t,name:l,required:a})=>(te[p]||[]).includes(t)?e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-1",children:[t," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",onChange:f=>{var U;const j=(U=f.target.files)==null?void 0:U[0];j&&c(j,l)},className:"w-full px-3 py-2 border border-gray-300 rounded-xl cursor-pointer"}),b===l&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Uploading..."})]},l):null)]})}),e.jsx("button",{type:"submit",disabled:!!b||y.isPending,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all disabled:opacity-60",children:b||y.isPending?"Processing...":"Continue"})]})]})})},ge=n=>T.post("/kyc/bank",n).then(s=>s.data),ye=n=>T.post("/kyc/video",n).then(s=>s.data),ve=n=>T.post("/kyc/photo",n).then(s=>s.data),J=()=>{const n=A({mutationFn:ge}),s=A({mutationFn:ve}),h=A({mutationFn:ye});return{updateBankMutation:n,updateVideoMutation:h,updateImageMutation:s}},Ne=({fullName:n,resellerName:s,businessName:h})=>{const d=N.useRef(null),x=N.useRef(null),[u,i]=N.useState(!1),[o,m]=N.useState(!1),p=new Date,b=p.toLocaleDateString("en-GB"),g=p.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}),y=[{id:1,title:"1. Declaration Acknowledgement",text:`“I have carefully read and understood the KYC Declaration Form provided by ${s}. I accept all terms, and I am voluntarily recording this video as proof of my consent.”`},{id:2,title:"2. Introduction",text:`“Hello, my name is ${n}. I am recording this video to complete the KYC verification process for Payin and Payout services with ${s}.”`},{id:3,title:"3. Date and Time Confirmation",text:`“Today’s date is ${b}, and the current time is approximately ${g} IST.”`},{id:4,title:"4. Identity Proof Display",text:"“I am now showing my government-issued ID: [PAN Card / Aadhaar Card / Passport], issued by [Issuing Authority].”"},{id:5,title:"5. Address Proof Display (If Required)",text:"“This document is my [Utility Bill / Bank Statement / Rent Agreement], dated [MM/YYYY], which shows my current address.”"},{id:6,title:"6. Facial Verification",text:"“You can clearly see my face. I will now move my head left and right, and smile to confirm liveness.”"},{id:7,title:"7. Declaration of Accuracy",text:"“I confirm that all the documents shown belong to me and the information provided is accurate to the best of my knowledge.”"},{id:8,title:"8. Purpose of KYC",text:"“This video is submitted solely for the purpose of verifying my identity for using Payin and Payout services.”"},{id:9,title:"9. Business Account Confirmation",text:`“The bank account provided is registered under the name of ${h}, and is used for official business transactions.”`,condition:!!h},{id:10,title:"10. Signature Confirmation (Optional)",text:"“I will now sign for additional verification purposes.”"},{id:11,title:"11. Final Consent and Authorization",text:`“Thank you for reviewing my KYC video. I authorize ${s} to verify my documents and use this information for KYC validation of Payin and Payout services. I am available for any additional verification if needed.”`}];return{contentRef:d,scrollRef:x,checkboxVisible:u,accepted:o,setAccepted:m,handleScroll:()=>{const t=x.current;if(!t)return;t.scrollHeight-t.scrollTop<=t.clientHeight+10&&i(!0)},generatePDF:()=>{const t=new se;let l=t.internal.pageSize.getWidth(),a=20;const v=20,f=l-v*2,j=16,U=13,k=11,S=6;t.setFillColor(230,240,255),t.rect(0,0,l,t.internal.pageSize.getHeight(),"F"),t.setFontSize(j),t.setTextColor(40,40,90),t.setFont("helvetica","bold");const P="KYC Video Declaration",w=t.getStringUnitWidth(P)*j/t.internal.scaleFactor,M=(l-w)/2;t.text(P,M,a),a+=10,y.filter(q=>q.condition!==!1).forEach(({title:q,text:z})=>{a>260&&(t.addPage(),a=20),t.setFillColor(255,255,255),t.setDrawColor(200,200,200),t.roundedRect(v,a,f,30,3,3,"FD"),t.setFontSize(U),t.setTextColor(0,0,100),t.setFont("helvetica","bold"),t.text(q,v+5,a+8),t.setFontSize(k),t.setTextColor(50,50,50),t.setFont("helvetica","normal");const W=t.splitTextToSize(z,f-10);t.text(W,v+5,a+15),a+=W.length*S+15});const R=t.output("blob");return new File([R],`kyc_declaration_${Date.now()}.pdf`,{type:"application/pdf"})},dateStr:b,timeStr:g,declarations:y}},je=({setKycPage:n})=>{const{user:s,refetch:h}=O(),{register:d,handleSubmit:x,formState:{errors:u}}=_({defaultValues:{bankName:s.bankName,accountNumber:s.accountNumber,ifscCode:s.ifscCode}}),{updateBankMutation:i}=J(),o=m=>{i.mutate(m)};return N.useEffect(()=>{var g,y;const m=i.isError,p=i.isSuccess,b=(g=i.data)==null?void 0:g.kycPage;if(p&&(h(),E.success("Bank details submitted succesfully"),b&&n(b),h()),m){const c=(y=i.error.response)==null?void 0:y.data;E.success((c==null?void 0:c.message)||(c==null?void 0:c.error))}},[i.isError,i.isSuccess]),e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 mt-6",children:e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Bank KYC Information"}),e.jsxs("button",{onClick:()=>n("businessInformation"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(s==null?void 0:s.bankStatus)&&e.jsxs("button",{onClick:()=>n("photo"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("form",{onSubmit:x(o),className:"grid grid-cols-1 sm:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Bank Name"}),e.jsx("input",{type:"text",...d("bankName",{required:"Bank name is required"}),className:`w-full px-4 py-2 rounded-xl border ${u.bankName?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),u.bankName&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.bankName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Account Number"}),e.jsx("input",{type:"text",...d("accountNumber",{required:"Account number is required"}),className:`w-full px-4 py-2 rounded-xl border ${u.accountNumber?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),u.accountNumber&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.accountNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"IFSC Code"}),e.jsx("input",{type:"text",...d("ifscCode",{required:"IFSC code is required",pattern:{value:/^[A-Z]{4}0[A-Z0-9]{6}$/i,message:"Invalid IFSC code format"}}),className:`w-full px-4 py-2 rounded-xl border ${u.ifscCode?"border-red-500":"border-gray-300"} uppercase focus:outline-none focus:ring-2 focus:ring-blue-500`}),u.ifscCode&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.ifscCode.message})]}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx("button",{type:"submit",disabled:i.isPending,className:"mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-xl shadow transition-all",children:i.isPending?"Processing":"Continue"})})]})]})})};var G={exports:{}},we=G.exports,H;function Se(){return H||(H=1,function(n,s){(function(d,x){n.exports=x(re())})(we,function(h){return function(d){var x={};function u(i){if(x[i])return x[i].exports;var o=x[i]={i,l:!1,exports:{}};return d[i].call(o.exports,o,o.exports,u),o.l=!0,o.exports}return u.m=d,u.c=x,u.d=function(i,o,m){u.o(i,o)||Object.defineProperty(i,o,{enumerable:!0,get:m})},u.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},u.t=function(i,o){if(o&1&&(i=u(i)),o&8||o&4&&typeof i=="object"&&i&&i.__esModule)return i;var m=Object.create(null);if(u.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:i}),o&2&&typeof i!="string")for(var p in i)u.d(m,p,(function(b){return i[b]}).bind(null,p));return m},u.n=function(i){var o=i&&i.__esModule?function(){return i.default}:function(){return i};return u.d(o,"a",o),o},u.o=function(i,o){return Object.prototype.hasOwnProperty.call(i,o)},u.p="",u(u.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(d,x,u){u.r(x);var i=u("react"),o=function(){var y=function(c,r){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,l){t.__proto__=l}||function(t,l){for(var a in l)l.hasOwnProperty(a)&&(t[a]=l[a])},y(c,r)};return function(c,r){y(c,r);function t(){this.constructor=c}c.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),m=function(){return m=Object.assign||function(y){for(var c,r=1,t=arguments.length;r<t;r++){c=arguments[r];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(y[l]=c[l])}return y},m.apply(this,arguments)},p=function(y,c){var r={};for(var t in y)Object.prototype.hasOwnProperty.call(y,t)&&c.indexOf(t)<0&&(r[t]=y[t]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,t=Object.getOwnPropertySymbols(y);l<t.length;l++)c.indexOf(t[l])<0&&Object.prototype.propertyIsEnumerable.call(y,t[l])&&(r[t[l]]=y[t[l]]);return r};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(c){var r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return r?new Promise(function(t,l){r.call(navigator,c,t,l)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function b(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var g=function(y){o(c,y);function c(r){var t=y.call(this,r)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return c.prototype.componentDidMount=function(){var r=this,t=r.state,l=r.props;if(this.unmounted=!1,!b()){l.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),l.children&&typeof l.children!="function"&&console.warn("children must be a function")},c.prototype.componentDidUpdate=function(r){var t=this.props;if(!b()){t.onUserMediaError("getUserMedia not supported");return}var l=JSON.stringify(r.audioConstraints)!==JSON.stringify(t.audioConstraints),a=JSON.stringify(r.videoConstraints)!==JSON.stringify(t.videoConstraints),v=r.minScreenshotWidth!==t.minScreenshotWidth,f=r.minScreenshotHeight!==t.minScreenshotHeight;(a||v||f)&&(this.canvas=null,this.ctx=null),(l||a)&&(this.stopAndCleanup(),this.requestUserMedia())},c.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},c.stopMediaStream=function(r){r&&(r.getVideoTracks&&r.getAudioTracks?(r.getVideoTracks().map(function(t){r.removeTrack(t),t.stop()}),r.getAudioTracks().map(function(t){r.removeTrack(t),t.stop()})):r.stop())},c.prototype.stopAndCleanup=function(){var r=this.state;r.hasUserMedia&&(c.stopMediaStream(this.stream),r.src&&window.URL.revokeObjectURL(r.src))},c.prototype.getScreenshot=function(r){var t=this,l=t.state,a=t.props;if(!l.hasUserMedia)return null;var v=this.getCanvas(r);return v&&v.toDataURL(a.screenshotFormat,a.screenshotQuality)},c.prototype.getCanvas=function(r){var t=this,l=t.state,a=t.props;if(!this.video||!l.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var v=this.video.videoWidth,f=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var j=v/f;v=a.minScreenshotWidth||this.video.clientWidth,f=v/j,a.minScreenshotHeight&&f<a.minScreenshotHeight&&(f=a.minScreenshotHeight,v=f*j)}this.canvas=document.createElement("canvas"),this.canvas.width=(r==null?void 0:r.width)||v,this.canvas.height=(r==null?void 0:r.height)||f,this.ctx=this.canvas.getContext("2d")}var U=this,k=U.ctx,S=U.canvas;return k&&S&&(S.width=(r==null?void 0:r.width)||S.width,S.height=(r==null?void 0:r.height)||S.height,a.mirrored&&(k.translate(S.width,0),k.scale(-1,1)),k.imageSmoothingEnabled=a.imageSmoothing,k.drawImage(this.video,0,0,(r==null?void 0:r.width)||S.width,(r==null?void 0:r.height)||S.height),a.mirrored&&(k.scale(-1,1),k.translate(-S.width,0))),S},c.prototype.requestUserMedia=function(){var r=this,t=this.props,l=function(f,j){var U={video:typeof j<"u"?j:!0};t.audio&&(U.audio=typeof f<"u"?f:!0),r.requestUserMediaId++;var k=r.requestUserMediaId;navigator.mediaDevices.getUserMedia(U).then(function(S){r.unmounted||k!==r.requestUserMediaId?c.stopMediaStream(S):r.handleUserMedia(null,S)}).catch(function(S){r.handleUserMedia(S)})};if("mediaDevices"in navigator)l(t.audioConstraints,t.videoConstraints);else{var a=function(f){return{optional:[{sourceId:f}]}},v=function(f){var j=f.deviceId;return typeof j=="string"?j:Array.isArray(j)&&j.length>0?j[0]:typeof j=="object"&&j.ideal?j.ideal:null};MediaStreamTrack.getSources(function(f){var j=null,U=null;f.forEach(function(P){P.kind==="audio"?j=P.id:P.kind==="video"&&(U=P.id)});var k=v(t.audioConstraints);k&&(j=k);var S=v(t.videoConstraints);S&&(U=S),l(a(j),a(U))})}},c.prototype.handleUserMedia=function(r,t){var l=this.props;if(r||!t){this.setState({hasUserMedia:!1}),l.onUserMediaError(r);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}l.onUserMedia(t)},c.prototype.render=function(){var r=this,t=this,l=t.state,a=t.props,v=a.audio;a.forceScreenshotSourceSize;var f=a.disablePictureInPicture;a.onUserMedia,a.onUserMediaError,a.screenshotFormat,a.screenshotQuality,a.minScreenshotWidth,a.minScreenshotHeight,a.audioConstraints,a.videoConstraints,a.imageSmoothing;var j=a.mirrored,U=a.style,k=U===void 0?{}:U,S=a.children,P=p(a,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),w=j?m(m({},k),{transform:(k.transform||"")+" scaleX(-1)"}):k,M={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",m({autoPlay:!0,disablePictureInPicture:f,src:l.src,muted:!v,playsInline:!0,ref:function(R){r.video=R},style:w},P)),S&&S(M))},c.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},c}(i.Component);x.default=g},react:function(d,x){d.exports=h}}).default})}(G)),G.exports}var Pe=Se();const Ce=ae(Pe),Ie=({setKycPage:n})=>{const{register:s,handleSubmit:h,setValue:d}=_(),{user:x,refetch:u}=O(),[i,o]=N.useState(null),[m,p]=N.useState(!1),b=N.useRef(null),{updateImageMutation:g}=J(),y=()=>{var t;const r=(t=b.current)==null?void 0:t.getScreenshot();r&&(o(r),fetch(r).then(l=>l.blob()).then(l=>{const a=new File([l],"captured.png",{type:"image/png"}),v=new DataTransfer;v.items.add(a),d("imageFile",v.files)}),p(!1))},c=async r=>{var t,l;if((t=r.imageFile)!=null&&t[0]){const a=await K(r.imageFile[0]);a&&g.mutate({photoUrl:a})}console.log("Submitted Image:",(l=r.imageFile)==null?void 0:l[0])};return N.useEffect(()=>{var a,v;const r=g.isError,t=g.isSuccess,l=(a=g.data)==null?void 0:a.kycPage;if(t&&(E.success("Image submitted succesfully"),l&&(u(),n(l))),r){const f=(v=g.error.response)==null?void 0:v.data;E.success((f==null?void 0:f.message)||(f==null?void 0:f.error))}},[g.isError,g.isSuccess]),e.jsx($.div,{className:"w-full max-w-3xl mx-auto px-4 mt-6 relative",children:e.jsxs($.div,{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Upload Image"}),e.jsxs("button",{onClick:()=>n("bank"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute left-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"}),"Back"]}),!["PENDING","REJECTED"].includes(x==null?void 0:x.photoUrl)&&e.jsxs("button",{onClick:()=>n("video"),className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition absolute right-10 top-10 cursor-pointer",children:[e.jsx("span",{className:"material-symbols-outlined",children:"arrow_forward"}),"Next"]}),e.jsxs("h4",{className:"text-lg font-semibold",children:["Pick One Option ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("form",{onSubmit:h(c),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Image"}),e.jsx("input",{type:"file",accept:"image/*",...s("imageFile"),className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Webcam Option"}),e.jsxs("button",{type:"button",onClick:()=>p(!m),className:`w-full flex justify-center items-center gap-2 px-4 py-2 rounded-md text-white transition ${m?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:m?"stop_circle":"photo_camera"}),m?"Close Webcam":"Open Webcam"]})]})]}),m&&e.jsxs("div",{className:"rounded border p-4 shadow-md bg-gray-50 space-y-3 text-center",children:[e.jsx(Ce,{ref:b,screenshotFormat:"image/png",className:"rounded-md w-full max-w-sm mx-auto"}),e.jsx("button",{type:"button",onClick:y,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded",children:"Capture"})]}),i&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Preview:"}),e.jsx("img",{src:i,alt:"Captured Preview",className:"w-40 h-auto mx-auto rounded border"})]}),e.jsx("button",{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700 text-white w-full py-2 rounded-md font-medium",disabled:g.isPending,children:g.isPending?"Processing":"Continue"})]})]})})},ke=({contentRef:n,scrollRef:s,checkboxVisible:h,accepted:d,setAccepted:x,handleScroll:u,declarations:i})=>{const[o,m]=N.useState(!1);return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[!o&&e.jsx("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-6 py-2 rounded-md cursor-pointer",children:"View Declaration"}),o&&e.jsxs("div",{children:[e.jsx("div",{ref:s,onScroll:u,className:"max-h-[200px] overflow-y-auto border border-gray-300 p-4 rounded bg-white mt-6",children:e.jsxs("div",{ref:n,className:"text-sm leading-relaxed whitespace-pre-wrap",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4 border-b pb-2",children:"Video KYC for User Activation of Payin and Payout Services"}),i.filter(p=>p.condition!==!1).map(({id:p,title:b,text:g})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:b}),e.jsx("p",{className:"mt-1",children:g})]},p))]})}),e.jsx("div",{className:"mt-4",children:h&&e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:p=>{x(p.target.checked)}}),e.jsx("span",{children:"I accept the above declaration"})]})})]})]})},Ue=({setKycPage:n})=>{const{refetch:s,user:h}=O(),{reseller_name:d}=ne();if(!d)return"Failed To Load";const x=Ne({fullName:` ${h==null?void 0:h.firstName} ${h==null?void 0:h.lastName}`,businessName:h==null?void 0:h.company_name,resellerName:d==="Vault Pg"?"QUANTUMSPHERE INNOVATIONS (OPC) PRIVATE LIMITED":d}),{handleSubmit:u,setValue:i,watch:o}=_(),m=o("videoFile"),[p,b]=N.useState({uploading:!1,error:"",success:""}),[g,y]=N.useState(20),[c,r]=N.useState(!1),[t,l]=N.useState(null),[a,v]=N.useState(0),f=N.useRef(null),j=N.useRef(null),U=N.useRef(null),k=N.useRef(null),S=N.useRef(null),P=N.useRef([]),{updateVideoMutation:w}=J(),M=I=>I.size>20*1024*1024?(b({uploading:!1,error:"File too large (>20MB).",success:""}),!1):!0,R=async()=>{const I=await navigator.mediaDevices.getUserMedia({audio:!0});U.current=I;const F=new AudioContext,C=F.createAnalyser();F.createMediaStreamSource(I).connect(C),k.current=F,S.current=C;const Y=new Uint8Array(C.frequencyBinCount),Q=setInterval(()=>{C.getByteFrequencyData(Y);const X=Math.max(...Y)/255;v(X)},100);return()=>clearInterval(Q)},V=()=>{var I,F;(I=U.current)==null||I.getTracks().forEach(C=>C.stop()),(F=k.current)==null||F.close(),S.current=null},q=async()=>{r(!0),y(20),P.current=[];const I=await navigator.mediaDevices.getUserMedia({video:{width:320,height:240,frameRate:10},audio:!0});U.current=I,f.current&&(f.current.srcObject=I,f.current.play());const F={mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:2e5},C=new MediaRecorder(I,F);C.ondataavailable=D=>{D.data.size>0&&P.current.push(D.data)},C.onstop=()=>{const D=new Blob(P.current,{type:"video/webm"}),Y=URL.createObjectURL(D);l(Y),V()},j.current=C,C.start(),await R()},z=()=>{var I;(I=j.current)==null||I.stop(),r(!1)};N.useEffect(()=>{let I;return c&&g>0&&(I=setTimeout(()=>y(F=>F-1),1e3)),c&&g===0&&z(),()=>clearTimeout(I)},[c,g]);const W=async I=>{if(!I.videoFile){b({uploading:!1,error:"No video recorded.",success:""});return}const F=x.generatePDF();if(!F){b({uploading:!1,error:"No video recorded.",success:""});return}b({uploading:!0,error:"",success:""});const C=new FormData;C.append("videoFile",I.videoFile),C.append("kycDeclaration",F);try{w.mutate(C,{onSuccess:()=>{n("under_review"),s()}})}catch(D){console.error(D),b({uploading:!1,error:"Upload failed.",success:""})}};return N.useEffect(()=>{var I,F;if(w.isSuccess){E.success("Video uploaded successfully");const C=(I=w.data)==null?void 0:I.kycPage;C&&n(C)}if(w.isError){const C=(F=w.error.response)==null?void 0:F.data;E.error((C==null?void 0:C.message)||(C==null?void 0:C.error)||"Upload failed"),b({uploading:!1,error:"Upload failed.",success:""})}},[w.isError,w.isSuccess]),e.jsx($.div,{className:"w-full max-w-3xl mx-auto px-4 mt-6 relative",children:e.jsxs($.div,{className:"border-2 border-gray-300 rounded-2xl p-6 sm:p-8 shadow-sm relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 mb-6 text-center",children:"Video Verification"}),e.jsx("button",{onClick:()=>n("photo"),className:"absolute left-10 top-10 text-blue-600 hover:text-blue-800",children:"← Back"}),e.jsx("p",{className:"text-sm text-yellow-800 bg-yellow-100 border-l-4 border-yellow-500 p-2 rounded",children:"📌 Please review the full declaration below and record a video clearly stating your acceptance to proceed with the KYC verification process."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[c&&e.jsxs("p",{children:["⏱ Time left: ",g,"s"]}),c&&e.jsx("div",{className:"h-3 w-28 bg-gray-200 rounded",children:e.jsx("div",{className:"h-3 bg-green-500 rounded",style:{width:`${a*100}%`}})})]}),e.jsxs("div",{className:"flex gap-4 justify-center flex-col items-center",children:[e.jsx("video",{ref:f,autoPlay:!0,muted:!0,playsInline:!0,className:"w-40 h-40 rounded-full object-cover border"}),e.jsx("button",{onClick:c?z:q,className:`px-4 py-2 cursor-pointer text-white rounded ${c?"bg-red-600":"bg-blue-600"}`,children:c?"Stop":"Record"}),t&&e.jsx("button",{onClick:()=>{i("videoFile",void 0),l(null),y(20)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Retry"})]}),t&&!c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("video",{src:t,controls:!0,className:"w-full rounded"}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:async()=>{const I=await fetch(t).then(C=>C.blob()),F=new File([I],"recorded.webm",{type:I.type});M(F)&&i("videoFile",F)},children:"Use This Recording"})]})]}),m&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Selected Video:"}),e.jsx("video",{src:URL.createObjectURL(m),controls:!0,className:"w-full rounded"})]}),e.jsxs("div",{className:"text-sm text-center mt-2 text-gray-600",children:[p.uploading&&e.jsx("p",{className:"text-blue-600",children:"Uploading video..."}),p.error&&e.jsx("p",{className:"text-red-600",children:p.error}),p.success&&e.jsx("p",{className:"text-green-600",children:p.success})]}),e.jsx(ke,{...x}),e.jsx("form",{onSubmit:u(W),className:"text-center mt-4",children:e.jsx("button",{type:"submit",disabled:p.uploading||!x.accepted,className:`px-6 py-2 rounded font-medium text-white 
    ${p.uploading||!x.accepted?"bg-indigo-600 hover:bg-indigo-700 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,style:{opacity:1},children:p.uploading?"Uploading...":"Submit Video"})})]})})},B=["personalInformation","aadhar","pan","businessInformation","bank","photo","video","under_review","approved"],L={personalInformation:"Personal Info",aadhar:"Aadhaar",pan:"PAN",businessInformation:"Business",bank:"Bank",photo:"photo",video:"Video",under_review:"Under Review",approved:"Approved"},Ee=({currentStep:n})=>{const s=B.indexOf(n==="done"?"approved":n);return e.jsxs("div",{className:"w-full px-4 py-6 text-gray-800",children:[e.jsxs("div",{className:"hidden md:flex relative items-center justify-between gap-4 min-w-[900px] sm:min-w-full",children:[e.jsx("div",{className:"absolute top-[13px] h-1 bg-gray-300 z-0",style:{left:"calc(50px + 0.75rem)",right:"calc(50px + 0.75rem)"},children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${s/(B.length-1)*100}%`}})}),B.map((h,d)=>{const x=n==="done"||d<s,u=d===s;return e.jsxs("div",{className:"flex flex-col items-center text-center z-10 min-w-[100px]",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center text-sm font-semibold
                  ${x?"bg-blue-600 text-white":u?"bg-white border-2 border-blue-600 text-blue-600":"bg-gray-300 text-white"}
                `,children:x?"✓":d+1}),e.jsx("div",{className:"text-xs mt-2 px-1 whitespace-nowrap",children:L[h]})]},h)})]}),e.jsx("div",{className:"flex flex-col items-center gap-4 md:hidden mt-4",children:e.jsxs("div",{className:"flex justify-around w-full text-sm font-medium text-gray-800",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-green-600 text-[28px]",children:"radio_button_checked"}),e.jsx("span",{className:`text-xs ${s===0?"font-bold text-blue-600":""}`,children:L[B[s]]||"Current"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Current"})]}),B[s+1]&&e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-500 text-[28px]",children:"arrow_forward"}),e.jsx("span",{className:"text-xs",children:L[B[s+1]]}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Next"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-purple-600 text-[28px]",children:"flag"}),e.jsx("span",{className:"text-xs",children:L.approved}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Final"})]})]})})]})},Fe={PENDING:"Your KYC is pending.",UNDER_REVIEW:"Your KYC is under review.",APPROVED:"Your KYC has been approved 🎉",REJECTED:"Your KYC was rejected.",PROCESSING:"Your Kyc Has Been Approved. Service will be start after 15 minutes"},Me={PENDING:"text-yellow-500",UNDER_REVIEW:"text-blue-500",APPROVED:"text-green-600",REJECTED:"text-red-600",PROCESSING:"text-green-600"},Z=({status:n,onRetry:s,onBack:h,rejectedField:d})=>e.jsx($.div,{className:"max-w-xl mx-auto px-4 mt-10",children:e.jsxs("div",{className:"border border-gray-300 rounded-2xl shadow p-8 text-center space-y-6",children:[e.jsx("h2",{className:`text-2xl font-bold ${Me[n]}`,children:Fe[n]}),n==="REJECTED"&&e.jsxs("div",{className:"bg-red-50 text-red-700 border border-red-200 rounded p-4",children:[e.jsx("strong",{children:"Reason:"}),e.jsx("p",{children:"Please review the details and fill out the form correctly."}),e.jsx("div",{className:"flex gap-4 justify-center",children:d&&d.map(x=>e.jsx("b",{children:x.split("S")[0]}))})]}),(n==="PENDING"||n==="UNDER_REVIEW")&&e.jsx("p",{className:"text-gray-600",children:"We are currently verifying your information. You will be notified once it's done."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[n==="REJECTED"&&s&&e.jsx("button",{onClick:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"Retry KYC"}),h&&e.jsx("button",{onClick:h,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded",children:"Back"})]})]})}),Re=["personalInformation","aadhar","pan","businessInformation","bank","photo","video","under_review","approved"],Ae={personalInformation:de,aadhar:pe,pan:he,businessInformation:be,bank:je,photo:Ie,video:Ue,under_review:()=>e.jsx("div",{}),approved:()=>e.jsx("div",{})},Oe=()=>{var p;const{user:n,isLoading:s,isError:h}=O(),[d,x]=N.useState("personalInformation");N.useEffect(()=>{const b=n==null?void 0:n.kycPage;b&&Re.includes(b)&&x(b)},[n==null?void 0:n.kycPage]);const u=Ae[d],i=n==null?void 0:n.kycStatus,o=n&&Object.keys(n).filter(b=>n[b]==="REJECTED"&&b!="kycStatus"),m=i&&["UNDER_REVIEW","APPROVED","PROCESSING"].includes(i);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-100 to-indigo-100 text-gray-800 sm:p-6 p-2",children:[e.jsx(ie,{title:"KYC",searchComponent:e.jsx(e.Fragment,{})}),e.jsx(Ee,{currentStep:d}),e.jsx("div",{className:"mt-4",children:s?e.jsx(oe,{}):h?e.jsx(le,{}):e.jsx(e.Fragment,{children:m?e.jsx(Z,{status:i,onRetry:()=>x(d),onBack:()=>x(d),reason:(p=n==null?void 0:n.data)==null?void 0:p.kycRejectionReason}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-6",children:u&&e.jsx(u,{setKycPage:x})}),i==="REJECTED"&&e.jsx(Z,{status:i,onRetry:()=>x(d),onBack:()=>x(d),reason:n==null?void 0:n.remark,rejectedField:o})]})})})]})};export{Oe as default};
