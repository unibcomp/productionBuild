import{a as _,b as C,p as A,r as b,j as e,z as f,o as N,R as P,f as F,h as $}from"./index.CcjL_5p2.js";import{u as L}from"./useMutation.B7IGJ_ZR.js";import{B as S,u as D}from"./ButtonBar.DPGIZOU4.js";import{u as M}from"./index.esm.DeVLCDcj.js";import{K as j,h as k,P as v}from"./PageHeadline.BlS9do2u.js";import{b as O,u as I}from"./useCart.eRTOEify.js";import{u as z}from"./useOrder.YOEO_2Yz.js";import"./queryToast.CNYNwkby.js";const T=async s=>(await C.get("/get-address",{params:s})).data,R=async s=>(await C.post("/create-address",s)).data,E=({pageNumber:s=1,pageSize:r=10})=>{const l={pageNumber:s,pageSize:r};return _({queryKey:["address",l],queryFn:()=>T(l)})},Q=()=>L({mutationFn:R}),K=async s=>(await A.get(`https://pinlookup.in/api/pincode?pincode=${s}`)).data,B=s=>_({queryKey:["pincodeData",s],queryFn:()=>K(s),enabled:!!s,staleTime:1e3*60*5}),U=({show:s,handleClose:r,isAdd:l,data:o,refetch:x})=>{const{register:a,handleSubmit:c,reset:d,watch:u,formState:{errors:n}}=M({defaultValues:o||{}}),t=u("postalCode"),{data:p}=B(t||"");b.useEffect(()=>{p?.data&&d(h=>({...h,city:p.data.district_name,state:p.data.state_name,country:"India"}))},[p,d]);const m=Q(),i=h=>{l&&m.mutate(h,{onSuccess:()=>{f.success("Address created successfully"),x?.(),r()},onError:g=>{console.error("Failed to add address:",g),f.error("Failed to add address")}})};return e.jsx(j,{appear:!0,show:s,as:b.Fragment,children:e.jsxs(k,{as:"div",className:"relative z-50",onClose:r,children:[e.jsx(j.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsx(j.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(k.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white p-6 shadow-xl transition-all border border-gray-200",children:[e.jsx(v,{title:l?"Add New Address":"Edit Address",component:e.jsx(S,{buttons:[{label:"X",onClick:()=>r(),colorClass:"bg-red-500"}]})}),e.jsxs("form",{onSubmit:c(i),className:"space-y-6",children:[e.jsxs("div",{className:"max-h-[60vh] custom-scroll",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name *"}),e.jsx("input",{type:"text",placeholder:"Enter full name",...a("name",{required:"Name is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${n.name?"border-red-500":""}`}),n.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),e.jsx("input",{type:"text",placeholder:"Street address",...a("addressLine1",{required:"Address Line 1 is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${n.addressLine1?"border-red-500":""}`}),n.addressLine1&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.addressLine1.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),e.jsx("input",{type:"text",placeholder:"Apartment, suite, etc. (optional)",...a("addressLine2"),className:"mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Postal Code *"}),e.jsx("input",{type:"text",placeholder:"ZIP / Postal Code",...a("postalCode",{required:"Postal Code is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${n.postalCode?"border-red-500":""}`}),n.postalCode&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.postalCode.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"City *"}),e.jsx("input",{type:"text",placeholder:"City",...a("city",{required:"City is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 bg-gray-100 ${n.city?"border-red-500":""}`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"State *"}),e.jsx("input",{type:"text",placeholder:"State",...a("state",{required:"State is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 bg-gray-100 ${n.state?"border-red-500":""}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Country *"}),e.jsx("input",{type:"text",placeholder:"Country",...a("country",{required:"Country is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 bg-gray-100 ${n.country?"border-red-500":""}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone *"}),e.jsx("input",{type:"text",placeholder:"Phone number",...a("phone",{required:"Phone is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${n.phone?"border-red-500":""}`}),n.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.phone.message})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"px-5 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:"Save"})]})]})]})})})})]})})},H=({selectedAddress:s,setSelectedAddress:r,onContinue:l})=>{const{data:o,isLoading:x,error:a,refetch:c}=E({pageNumber:1,pageSize:10}),{openModal:d,closeModal:u,isModalOpen:n}=D();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4 max-w-xl mx-auto",children:[e.jsx(v,{title:"Address",component:e.jsxs(e.Fragment,{children:[e.jsx(S,{buttons:[{label:"Add New",onClick:()=>d({isAddress:!0}),colorClass:"bg-blue-500"}]})," "]})}),e.jsx(U,{show:n?.isAddress||!1,handleClose:()=>u({isAddress:!1}),isAdd:!0,refetch:c}),x&&e.jsx(N,{}),a&&e.jsx("p",{className:"text-red-500",children:"Failed to load addresses"}),o?.results?.length?e.jsx("div",{className:"space-y-2 max-h-[50vh] custom-scroll",children:o.results.map(t=>e.jsxs("div",{onClick:()=>t._id&&r(t),className:`p-3 border rounded cursor-pointer ${s?._id===t._id?"border-pink-600 bg-pink-50":"border-gray-300"}`,children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.addressLine1}),t.addressLine2&&e.jsx("p",{className:"text-sm text-gray-600",children:t.addressLine2}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.city,", ",t.state," - ",t.postalCode]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.country}),e.jsx("p",{className:"text-sm text-gray-600",children:t.phone})]},t._id))}):e.jsx("p",{className:"text-gray-500",children:"No saved addresses"}),e.jsx("button",{onClick:l,disabled:!s,className:"bg-pink-600 text-white px-6 py-2 rounded hover:bg-pink-700 w-full disabled:opacity-50",children:"Continue to Payment"})]})},V=({products:s,address:r,subtotal:l,shipping:o,discount:x=0,refetch:a,onContinue:c})=>{const{handleIncrease:d,handleDecrease:u,handleRemove:n,isPending:t}=O(a),p=l+o;return e.jsxs("div",{className:"max-w-4xl mx-auto  bg-gradient-to-br from-pink-50 to-white rounded-xl shadow-xl",children:[e.jsx(v,{title:"Summary"}),e.jsxs("div",{className:"sm:p-8 p-2 flex gap-3 flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md sm:p-6 p-2",children:[e.jsx("h3",{className:"font-semibold text-2xl mb-4 border-b border-pink-300 pb-2",children:"Shipping Address"}),e.jsxs("address",{className:"not-italic space-y-1 text-gray-800 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-lg",children:r.name}),e.jsxs("p",{children:[r.addressLine1,r.addressLine2&&`, ${r.addressLine2}`]}),e.jsxs("p",{children:[r.city,", ",r.state," - ",r.postalCode]}),e.jsx("p",{children:r.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Phone: ",r.phone]})]})]}),e.jsxs("div",{className:"max-h-[50vh] custom-scroll",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-white bg-opacity-90 backdrop-blur-md border-b border-pink-300 py-3 px-2",children:e.jsxs("h3",{className:"font-semibold text-2xl text-pink-600 tracking-wide",children:["Products:- ",s.length]})}),e.jsx("div",{className:"space-y-6 mt-4",children:t?e.jsx(N,{}):s.map(m=>{const i=typeof m.product_id=="string"?null:m.product_id;if(!i)return e.jsxs("div",{className:"text-red-700 font-semibold bg-red-100 p-4 rounded-md shadow-sm",children:["Product data missing for item ",m._id]},m._id);const h=!i.inStock||i.stock===0,g=m.quantity<i.stock,y=m.quantity>0;return e.jsxs("div",{className:"flex items-center flex-wrap justify-between border rounded-lg border-gray-200 p-4 shadow-sm hover:shadow-lg transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[i.images?e.jsx("img",{src:i.images,alt:i.name,className:"w-24 h-24 object-cover rounded-lg shadow-md",loading:"lazy"}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-sm font-medium",children:"No Image"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:i.name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Quantity: ",m.quantity]}),h&&e.jsxs("p",{className:"text-red-600 flex items-center gap-2 mt-2 font-medium",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"error"}),"Sorry, this product is out of stock. Available stock:"," ",i.stock]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"font-bold text-lg text-pink-600 tracking-wide",children:["₹",i.total_sell_price.toFixed(2)]}),e.jsx("button",{onClick:()=>u(m),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${y?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Decrease quantity of ${i.name}`,type:"button",disabled:!y,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"remove"})}),e.jsx("button",{onClick:()=>d(m),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${g?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Increase quantity of ${i.name}`,type:"button",disabled:!g,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"})}),e.jsx("button",{onClick:()=>n(m),className:"flex items-center justify-center w-10 h-10 bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-300 text-white rounded-full shadow-md transition-transform active:scale-95","aria-label":`Remove ${i.name} from cart`,type:"button",children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]},m._id)})})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",l.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",o.toFixed(2)]})]}),x>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-semibold text-lg",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",x.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-extrabold text-2xl pt-3 text-pink-600",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",p.toFixed(2)]})]})]}),e.jsx("button",{onClick:c,className:"w-full mt-8 bg-gradient-to-r from-pink-500 to-pink-700 hover:from-pink-700 hover:to-pink-900 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95",type:"button",children:"Proceed to Payment"})]})]})},X=({step:s,setStep:r})=>{const l=["Address","Summary","Payment","Done"];return e.jsx("div",{className:"w-full bg-white p-4 rounded-md shadow border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between relative",children:l.map((o,x)=>{const a=x+1,c=s===a,d=s>a;return e.jsxs("div",{className:"flex flex-col items-center flex-1 relative",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold z-10
                  ${d?"bg-green-500 text-white":c?"bg-pink-500 text-white":"bg-gray-200 text-gray-500"}`,onClick:()=>r(a),children:d?"✓":a}),e.jsx("span",{className:`mt-2 text-xs sm:text-sm text-center
                  ${c?"text-pink-600 font-medium":d?"text-green-600":"text-gray-400"}`,children:o}),x<l.length-1&&e.jsxs("div",{className:"absolute top-[15px] left-1/2 w-full h-0.5 -z-0",children:[e.jsx("div",{className:"h-[3px] absolute left-0 bg-gray-300 w-full"}),e.jsx("div",{className:`h-[3px] absolute left-0 transition-all duration-500
        ${d&&"bg-green-500"}`,style:{width:d?"100%":c?"50%":"0%"}})]})]},o)})})})},Z=({productData:s,setPaymentMethod:r,onConfirm:l,isPending:o,address:x})=>{const{results:a,total_carts:c}=s,[d,u]=P.useState("upi"),n=t=>{u(t),r(t)};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-3",children:"Review & Payment"}),e.jsx("div",{className:"space-y-4",children:a.map(t=>e.jsx(G,{item:t},t._id))}),e.jsx(J,{totals:c}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Select Payment Method"}),e.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:d,onChange:t=>n(t.target.value),children:[e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Credit/Debit Card"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"})]})]}),e.jsx("button",{className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition disabled:opacity-60",onClick:()=>l({address_id:x?._id,card_id:a.map(t=>t._id),paymentMethod:d}),disabled:o,children:o?"Processing...":`Confirm & Pay ₹${c.total_sell_price.toFixed(2)}`})]})},G=({item:s})=>e.jsxs("div",{className:"flex items-center gap-4 border-b pb-4 last:border-none",children:[e.jsx("img",{src:s.product_id.images,alt:s.product_id.name,className:"w-20 h-20 object-contain rounded border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.product_id.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",s.quantity," | In stock: ",s.product_id.stock]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-700",children:["₹",s.product_id.total_sell_price]}),e.jsxs("span",{className:"text-sm line-through text-gray-400",children:["₹",s.product_id.total_original_price]})]})]}),e.jsxs("div",{className:"font-semibold text-gray-700 mr-16",children:["₹",(s.product_id.total_sell_price*s.quantity).toFixed(2)]})]}),J=({totals:s})=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Items"}),e.jsx("span",{children:s.total_quantity})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Original Price"}),e.jsxs("span",{children:["₹",s.total_original_price]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium text-green-700",children:[e.jsx("span",{children:"Discounted Price"}),e.jsxs("span",{children:["₹",s.total_sell_price]})]})]}),le=()=>{const s=F(),r=$(),l=new URLSearchParams(s.search),o=l.get("cart_id"),x=l.get("type"),{data:a,isLoading:c,refetch:d}=I({type:x||"through_cart",cart_id:o||""}),[u,n]=b.useState(1),[t,p]=b.useState(null),[m,i]=P.useState("upi"),{mutate:h,isPending:g}=z();return c?e.jsx(N,{}):a&&e.jsxs("div",{children:[e.jsx(X,{step:u,setStep:n}),u===1&&e.jsx(H,{selectedAddress:t,setSelectedAddress:p,onContinue:()=>n(2)}),u===2&&t&&e.jsx(V,{products:a.results,address:t,subtotal:a.total_carts.total_sell_price,shipping:a.total_carts.total_quantity,discount:a.total_carts.total_original_price-a.total_carts.total_sell_price,refetch:d,onContinue:()=>n(3)}),u===3&&e.jsx(Z,{productData:a,setPaymentMethod:i,onConfirm:y=>{h(y,{onSuccess:w=>{console.log(w);const{_id:q}=w;f.success("Order placed successfully"),r(`/order-status?order_id=${q}`,{replace:!0})}})},isPending:g,address:t})]})};export{le as default};
