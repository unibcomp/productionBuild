import{j as e,i as y,z as v,R as N,h as C,e as S,r as f}from"./index.kHeCUqgD.js";import{u as A,A as F}from"./AddressModal.CbuUGnvR.js";import{u as O}from"./useModal.NtcNY5nY.js";import{B as L}from"./ButtonBar.BSGV4Iyl.js";import{P as w}from"./PageHeadline.D63AtBSz.js";import{b as M,u as $}from"./useCart.Ba0SyC7_.js";import{u as z}from"./useOrder.CJfXuAF5.js";import"./index.esm.DAdEF9-a.js";import"./useMutation.tTKQ-mwc.js";import"./queryToast.D5cnosND.js";const D=({selectedAddress:s,setSelectedAddress:n,onContinue:c})=>{const{data:o,isLoading:m,error:a,refetch:x}=A({pageNumber:1,pageSize:10}),{openModal:l,closeModal:u,isModalOpen:p}=O();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4 max-w-xl mx-auto",children:[e.jsx(w,{title:"Address",component:e.jsxs(e.Fragment,{children:[e.jsx(L,{buttons:[{label:"Add New",onClick:()=>l({isAddress:!0}),colorClass:"bg-blue-500"}]})," "]})}),e.jsx(F,{show:p?.isAddress||!1,handleClose:()=>u({isAddress:!1}),isAdd:!0,refetch:x}),m&&e.jsx(y,{}),a&&e.jsx("p",{className:"text-red-500",children:"Failed to load addresses"}),o?.results?.length?e.jsx("div",{className:"space-y-2 max-h-[50vh] custom-scroll",children:o.results.map(t=>e.jsxs("div",{onClick:()=>t._id&&n(t),className:`relative p-3 border rounded cursor-pointer ${s?._id===t._id?"border-pink-600 bg-pink-50":"border-gray-300"}`,children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 z-10",children:[e.jsx("button",{onClick:h=>{h.stopPropagation()},className:"p-1 text-gray-500 hover:text-pink-600 hover:bg-gray-200 rounded transition",title:"Edit Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),v.success(`Deleted address: ${t.name}`)},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-gray-200 rounded transition",title:"Delete Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.addressLine1}),t.addressLine2&&e.jsx("p",{className:"text-sm text-gray-600",children:t.addressLine2}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.city,", ",t.state," - ",t.postalCode]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.country}),e.jsx("p",{className:"text-sm text-gray-600",children:t.phone})]},t._id))}):e.jsx("p",{className:"text-gray-500",children:"No saved addresses"}),e.jsx("button",{onClick:c,disabled:!s,className:"bg-pink-600 text-white px-6 py-2 rounded hover:bg-pink-700 w-full disabled:opacity-50",children:"Continue to Payment"})]})},R=({products:s,address:n,subtotal:c,discount:o=0,refetch:m,onContinue:a})=>{const{handleIncrease:x,handleDecrease:l,handleRemove:u,isPending:p}=M(m),t=c+o,h=c;return e.jsxs("div",{className:"max-w-4xl mx-auto  bg-gradient-to-br from-pink-50 to-white rounded-xl shadow-xl",children:[e.jsx(w,{title:"Summary"}),e.jsxs("div",{className:"sm:p-8 p-2 flex gap-3 flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md sm:p-6 p-2",children:[e.jsx("h3",{className:"font-semibold text-2xl mb-4 border-b border-pink-300 pb-2",children:"Shipping Address"}),e.jsxs("address",{className:"not-italic space-y-1 text-gray-800 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-lg",children:n.name}),e.jsxs("p",{children:[n.addressLine1,n.addressLine2&&`, ${n.addressLine2}`]}),e.jsxs("p",{children:[n.city,", ",n.state," - ",n.postalCode]}),e.jsx("p",{children:n.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Phone: ",n.phone]})]})]}),e.jsxs("div",{className:"max-h-[50vh] custom-scroll",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-white bg-opacity-90 backdrop-blur-md border-b border-pink-300 py-3 px-2",children:e.jsxs("h3",{className:"font-semibold text-2xl text-pink-600 tracking-wide",children:["Products:- ",s.length]})}),e.jsx("div",{className:"space-y-6 mt-4",children:p?e.jsx(y,{}):s.map(d=>{const i=typeof d.product_id=="string"?null:d.product_id;if(!i)return e.jsxs("div",{className:"text-red-700 font-semibold bg-red-100 p-4 rounded-md shadow-sm",children:["Product data missing for item ",d._id]},d._id);const g=!i.inStock||i.stock===0,r=d.quantity<i.stock,j=d.quantity>0;return e.jsxs("div",{className:"flex items-center flex-wrap justify-between border rounded-lg border-gray-200 p-4 shadow-sm hover:shadow-lg transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[i.images?e.jsx("img",{src:i.images,alt:i.name,className:"w-24 h-24 object-cover rounded-lg shadow-md",loading:"lazy"}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-sm font-medium",children:"No Image"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:i.name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Quantity: ",d.quantity]}),g&&e.jsxs("p",{className:"text-red-600 flex items-center gap-2 mt-2 font-medium",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"error"}),"Sorry, this product is out of stock. Available stock:"," ",i.stock]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"font-bold text-lg text-pink-600 tracking-wide",children:["₹",i.total_sell_price.toFixed(2)]}),e.jsx("button",{onClick:()=>l(d),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${j?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Decrease quantity of ${i.name}`,type:"button",disabled:!j,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"remove"})}),e.jsx("button",{onClick:()=>x(d),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${r?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Increase quantity of ${i.name}`,type:"button",disabled:!r,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"})}),e.jsx("button",{onClick:()=>u(d),className:"flex items-center justify-center w-10 h-10 bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-300 text-white rounded-full shadow-md transition-transform active:scale-95","aria-label":`Remove ${i.name} from cart`,type:"button",children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]},d._id)})})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Price"}),e.jsxs("span",{children:["₹",t.toFixed(2)]})]}),o>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-semibold text-lg",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",c.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-extrabold text-2xl pt-3 text-pink-600",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",h.toFixed(2)]})]})]}),e.jsx("button",{onClick:a,className:"w-full mt-8 bg-gradient-to-r from-pink-500 to-pink-700 hover:from-pink-700 hover:to-pink-900 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95",type:"button",children:"Proceed to Payment"})]})]})},q=({step:s,setStep:n})=>{const c=["Address","Summary","Payment","Done"];return e.jsx("div",{className:"w-full bg-white p-4 rounded-md shadow border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between relative",children:c.map((o,m)=>{const a=m+1,x=s===a,l=s>a;return e.jsxs("div",{className:"flex flex-col items-center flex-1 relative",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold z-10 cursor-pointer
                  ${l?"bg-green-500 text-white":x?"bg-pink-500 text-white":"bg-gray-200 text-gray-500"}`,onClick:()=>n(a),children:l?"✓":a}),e.jsx("span",{className:`mt-2 text-xs sm:text-sm text-center
                  ${x?"text-pink-600 font-medium":l?"text-green-600":"text-gray-400"}`,children:o}),m<c.length-1&&e.jsxs("div",{className:"absolute top-[15px] left-1/2 w-full h-0.5 -z-0",children:[e.jsx("div",{className:"h-[3px] absolute left-0 bg-gray-300 w-full"}),e.jsx("div",{className:`h-[3px] absolute left-0 transition-all duration-500
        ${l&&"bg-green-500"}`,style:{width:l?"100%":x?"50%":"0%"}})]})]},o)})})})},I=({productData:s,setPaymentMethod:n,onConfirm:c,isPending:o,address:m})=>{const{results:a,total_carts:x}=s,[l,u]=N.useState("razorpay"),[p,t]=N.useState("upi"),h=r=>{u(r),n(r)},d=()=>{c({address_id:m?._id,card_id:a.map(r=>r._id),paymentMethod:l,...l==="razorpay"&&{method:p}})},g=(x?.total_sell_price??0)+5;return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-3",children:"Review & Payment"}),e.jsx("div",{className:"space-y-4",children:a.map(r=>e.jsx(E,{item:r},r._id))}),e.jsx(T,{totals:x}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Select Payment Method"}),e.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:l,onChange:r=>h(r.target.value),children:[e.jsx("option",{value:"razorpay",children:"Pay With Online"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"})]})]}),l==="razorpay"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Choose Online Payment Mode"}),e.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:p,onChange:r=>t(r.target.value),children:[e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Debit / Credit Card"}),e.jsx("option",{value:"netbanking",children:"Net Banking"}),e.jsx("option",{value:"wallet",children:"Wallet"})]})]}),e.jsx("button",{className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition disabled:opacity-60",onClick:d,disabled:o,children:o?"Processing...":`Confirm & Pay ₹${g.toFixed(2)}`})]})},E=({item:s})=>e.jsxs("div",{className:"flex items-center gap-4 border-b pb-4 last:border-none",children:[e.jsx("img",{src:s.product_id.images,alt:s.product_id.name,className:"w-20 h-20 object-contain rounded border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.product_id.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",s.quantity," | In stock: ",s.product_id.stock]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-700",children:["₹",s.product_id.total_sell_price]}),e.jsxs("span",{className:"text-sm line-through text-gray-400",children:["₹",s.product_id.total_original_price]})]})]}),e.jsxs("div",{className:"font-semibold text-gray-700 mr-16",children:["₹",(s.product_id.total_sell_price*s.quantity).toFixed(2)]})]}),T=({totals:s})=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Items"}),e.jsx("span",{children:s.total_quantity})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Original Price"}),e.jsxs("span",{children:["₹",s.total_original_price]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium text-green-700",children:[e.jsx("span",{children:"Discounted Price"}),e.jsxs("span",{children:["₹",s.total_original_price-s.total_sell_price]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Price"}),e.jsxs("span",{children:["₹",s.total_sell_price.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Platform Fee"}),e.jsx("span",{children:"₹5.00"})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Total Price"}),e.jsxs("span",{children:["₹",(s.total_sell_price+5).toFixed(2)]})]})]}),Y=()=>{const s=C(),n=S(),c=new URLSearchParams(s.search),o=c.get("cart_id"),m=c.get("type"),{data:a,isLoading:x,refetch:l}=$({type:m||"through_cart",cart_id:o||""}),[u,p]=f.useState(1),[t,h]=f.useState(null),[d,i]=f.useState("razorpay"),{mutate:g,isPending:r}=z(),j=_=>{r||g(_,{onSuccess:k=>{const{_id:P,paymentRes:b}=k;b&&b.url?window.open(b.url,"_self"):(v.success("Order placed successfully"),n(`/order-status?order_id=${P}`,{replace:!0}))}})};return x?e.jsx(y,{}):a?e.jsxs("div",{children:[e.jsx(q,{step:u,setStep:p}),u===1&&e.jsx(D,{selectedAddress:t,setSelectedAddress:h,onContinue:()=>p(2)}),u===2&&t&&e.jsx(R,{products:a.results,address:t,subtotal:a.total_carts.total_sell_price,discount:a.total_carts.total_original_price-a.total_carts.total_sell_price,refetch:l,onContinue:()=>p(3)}),u===3&&t&&e.jsx(I,{productData:a,setPaymentMethod:i,onConfirm:j,isPending:r,address:t})]}):null};export{Y as default};
