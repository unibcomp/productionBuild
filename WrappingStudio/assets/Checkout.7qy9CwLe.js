import{a as _,b as C,n as A,j as e,r as b,z as j,m as N,R as P,h as F,e as $}from"./index.DUluIbsD.js";import{u as L}from"./useMutation.kA70zzM7.js";import{K as f,h as k,P as v,u as D}from"./dialog.C6bD8B7I.js";import{u as M}from"./index.esm.BvoZv709.js";import{B as S}from"./ButtonBar.CTIfDFvU.js";import{b as O,u as I}from"./useCart.B7HoldXc.js";import{u as z}from"./useOrder.Da439tCB.js";import"./queryToast.CGziroIY.js";const T=async t=>(await C.get("/get-address",{params:t})).data,R=async t=>(await C.post("/create-address",t)).data,E=({pageNumber:t=1,pageSize:r=10})=>{const n={pageNumber:t,pageSize:r};return _({queryKey:["address",n],queryFn:()=>T(n)})},Q=()=>L({mutationFn:R}),K=async t=>(await A.get(`https://pinlookup.in/api/pincode?pincode=${t}`)).data,B=t=>_({queryKey:["pincodeData",t],queryFn:()=>K(t),enabled:!!t,staleTime:1e3*60*5}),U=({show:t,handleClose:r,isAdd:n,data:o,refetch:m})=>{const{register:a,handleSubmit:c,reset:i,watch:u,setValue:x,formState:{errors:s}}=M({defaultValues:o||{}}),p=u("postalCode"),{data:d}=B(p||"");d?.data&&(x("city",d.data.district_name),x("state",d.data.state_name),x("country","India"));const l=Q(),g=h=>{n&&l.mutate(h,{onSuccess:()=>{j.success("Address added successfully"),m?.(),i(),r()},onError:()=>{j.error("Failed to add address")}})};return e.jsx(f,{appear:!0,show:t,as:b.Fragment,children:e.jsxs(k,{as:"div",className:"relative z-50",onClose:r,children:[e.jsx(f.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsx(f.Child,{as:b.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(k.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white p-6 shadow-xl transition-all border border-gray-200",children:[e.jsx(v,{title:n?"Add New Address":"Edit Address",component:e.jsx(S,{buttons:[{label:"X",onClick:r,colorClass:"bg-red-500"}]})}),e.jsxs("form",{onSubmit:c(g),className:"space-y-6 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name *"}),e.jsx("input",{type:"text",placeholder:"Enter full name",...a("name",{required:"Name is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${s.name?"border-red-500":""}`}),s.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),e.jsx("input",{type:"text",placeholder:"Street address",...a("addressLine1",{required:"Address Line 1 is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${s.addressLine1?"border-red-500":""}`}),s.addressLine1&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.addressLine1.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),e.jsx("input",{type:"text",placeholder:"Apartment, suite, etc. (optional)",...a("addressLine2"),className:"mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Postal Code *"}),e.jsx("input",{type:"text",placeholder:"ZIP / Postal Code",...a("postalCode",{required:"Postal Code is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${s.postalCode?"border-red-500":""}`}),s.postalCode&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.postalCode.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"City *"}),e.jsx("input",{type:"text",placeholder:"City",...a("city",{required:"City is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 bg-gray-100 ${s.city?"border-red-500":""}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"State *"}),e.jsx("input",{type:"text",placeholder:"State",...a("state",{required:"State is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 bg-gray-100 ${s.state?"border-red-500":""}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Country *"}),e.jsx("input",{type:"text",placeholder:"Country",...a("country",{required:"Country is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 bg-gray-100 ${s.country?"border-red-500":""}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone *"}),e.jsx("input",{type:"text",placeholder:"Phone number",...a("phone",{required:"Phone is required"}),className:`mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 ${s.phone?"border-red-500":""}`}),s.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.phone.message})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"px-5 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:"Save"})]})]})]})})})})]})})},V=({selectedAddress:t,setSelectedAddress:r,onContinue:n})=>{const{data:o,isLoading:m,error:a,refetch:c}=E({pageNumber:1,pageSize:10}),{openModal:i,closeModal:u,isModalOpen:x}=D();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4 max-w-xl mx-auto",children:[e.jsx(v,{title:"Address",component:e.jsxs(e.Fragment,{children:[e.jsx(S,{buttons:[{label:"Add New",onClick:()=>i({isAddress:!0}),colorClass:"bg-blue-500"}]})," "]})}),e.jsx(U,{show:x?.isAddress||!1,handleClose:()=>u({isAddress:!1}),isAdd:!0,refetch:c}),m&&e.jsx(N,{}),a&&e.jsx("p",{className:"text-red-500",children:"Failed to load addresses"}),o?.results?.length?e.jsx("div",{className:"space-y-2 max-h-[50vh] custom-scroll",children:o.results.map(s=>e.jsxs("div",{onClick:()=>s._id&&r(s),className:`relative p-3 border rounded cursor-pointer ${t?._id===s._id?"border-pink-600 bg-pink-50":"border-gray-300"}`,children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 z-10",children:[e.jsx("button",{onClick:p=>{p.stopPropagation()},className:"p-1 text-gray-500 hover:text-pink-600 hover:bg-gray-200 rounded transition",title:"Edit Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),j.success(`Deleted address: ${s.name}`)},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-gray-200 rounded transition",title:"Delete Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.addressLine1}),s.addressLine2&&e.jsx("p",{className:"text-sm text-gray-600",children:s.addressLine2}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.city,", ",s.state," - ",s.postalCode]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.country}),e.jsx("p",{className:"text-sm text-gray-600",children:s.phone})]},s._id))}):e.jsx("p",{className:"text-gray-500",children:"No saved addresses"}),e.jsx("button",{onClick:n,disabled:!t,className:"bg-pink-600 text-white px-6 py-2 rounded hover:bg-pink-700 w-full disabled:opacity-50",children:"Continue to Payment"})]})},H=({products:t,address:r,subtotal:n,shipping:o,discount:m=0,refetch:a,onContinue:c})=>{const{handleIncrease:i,handleDecrease:u,handleRemove:x,isPending:s}=O(a),p=n+o;return e.jsxs("div",{className:"max-w-4xl mx-auto  bg-gradient-to-br from-pink-50 to-white rounded-xl shadow-xl",children:[e.jsx(v,{title:"Summary"}),e.jsxs("div",{className:"sm:p-8 p-2 flex gap-3 flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md sm:p-6 p-2",children:[e.jsx("h3",{className:"font-semibold text-2xl mb-4 border-b border-pink-300 pb-2",children:"Shipping Address"}),e.jsxs("address",{className:"not-italic space-y-1 text-gray-800 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-lg",children:r.name}),e.jsxs("p",{children:[r.addressLine1,r.addressLine2&&`, ${r.addressLine2}`]}),e.jsxs("p",{children:[r.city,", ",r.state," - ",r.postalCode]}),e.jsx("p",{children:r.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Phone: ",r.phone]})]})]}),e.jsxs("div",{className:"max-h-[50vh] custom-scroll",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-white bg-opacity-90 backdrop-blur-md border-b border-pink-300 py-3 px-2",children:e.jsxs("h3",{className:"font-semibold text-2xl text-pink-600 tracking-wide",children:["Products:- ",t.length]})}),e.jsx("div",{className:"space-y-6 mt-4",children:s?e.jsx(N,{}):t.map(d=>{const l=typeof d.product_id=="string"?null:d.product_id;if(!l)return e.jsxs("div",{className:"text-red-700 font-semibold bg-red-100 p-4 rounded-md shadow-sm",children:["Product data missing for item ",d._id]},d._id);const g=!l.inStock||l.stock===0,h=d.quantity<l.stock,y=d.quantity>0;return e.jsxs("div",{className:"flex items-center flex-wrap justify-between border rounded-lg border-gray-200 p-4 shadow-sm hover:shadow-lg transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[l.images?e.jsx("img",{src:l.images,alt:l.name,className:"w-24 h-24 object-cover rounded-lg shadow-md",loading:"lazy"}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-sm font-medium",children:"No Image"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:l.name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Quantity: ",d.quantity]}),g&&e.jsxs("p",{className:"text-red-600 flex items-center gap-2 mt-2 font-medium",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"error"}),"Sorry, this product is out of stock. Available stock:"," ",l.stock]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"font-bold text-lg text-pink-600 tracking-wide",children:["₹",l.total_sell_price.toFixed(2)]}),e.jsx("button",{onClick:()=>u(d),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${y?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Decrease quantity of ${l.name}`,type:"button",disabled:!y,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"remove"})}),e.jsx("button",{onClick:()=>i(d),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${h?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Increase quantity of ${l.name}`,type:"button",disabled:!h,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"})}),e.jsx("button",{onClick:()=>x(d),className:"flex items-center justify-center w-10 h-10 bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-300 text-white rounded-full shadow-md transition-transform active:scale-95","aria-label":`Remove ${l.name} from cart`,type:"button",children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]},d._id)})})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",n.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",o.toFixed(2)]})]}),m>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-semibold text-lg",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-extrabold text-2xl pt-3 text-pink-600",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",p.toFixed(2)]})]})]}),e.jsx("button",{onClick:c,className:"w-full mt-8 bg-gradient-to-r from-pink-500 to-pink-700 hover:from-pink-700 hover:to-pink-900 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95",type:"button",children:"Proceed to Payment"})]})]})},X=({step:t,setStep:r})=>{const n=["Address","Summary","Payment","Done"];return e.jsx("div",{className:"w-full bg-white p-4 rounded-md shadow border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between relative",children:n.map((o,m)=>{const a=m+1,c=t===a,i=t>a;return e.jsxs("div",{className:"flex flex-col items-center flex-1 relative",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold z-10
                  ${i?"bg-green-500 text-white":c?"bg-pink-500 text-white":"bg-gray-200 text-gray-500"}`,onClick:()=>r(a),children:i?"✓":a}),e.jsx("span",{className:`mt-2 text-xs sm:text-sm text-center
                  ${c?"text-pink-600 font-medium":i?"text-green-600":"text-gray-400"}`,children:o}),m<n.length-1&&e.jsxs("div",{className:"absolute top-[15px] left-1/2 w-full h-0.5 -z-0",children:[e.jsx("div",{className:"h-[3px] absolute left-0 bg-gray-300 w-full"}),e.jsx("div",{className:`h-[3px] absolute left-0 transition-all duration-500
        ${i&&"bg-green-500"}`,style:{width:i?"100%":c?"50%":"0%"}})]})]},o)})})})},Z=({productData:t,setPaymentMethod:r,onConfirm:n,isPending:o,address:m})=>{const{results:a,total_carts:c}=t,[i,u]=P.useState("upi"),x=s=>{u(s),r(s)};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-3",children:"Review & Payment"}),e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsx(G,{item:s},s._id))}),e.jsx(J,{totals:c}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Select Payment Method"}),e.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:i,onChange:s=>x(s.target.value),children:[e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Credit/Debit Card"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"})]})]}),e.jsx("button",{className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition disabled:opacity-60",onClick:()=>n({address_id:m?._id,card_id:a.map(s=>s._id),paymentMethod:i}),disabled:o,children:o?"Processing...":`Confirm & Pay ₹${c.total_sell_price.toFixed(2)}`})]})},G=({item:t})=>e.jsxs("div",{className:"flex items-center gap-4 border-b pb-4 last:border-none",children:[e.jsx("img",{src:t.product_id.images,alt:t.product_id.name,className:"w-20 h-20 object-contain rounded border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:t.product_id.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",t.quantity," | In stock: ",t.product_id.stock]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-700",children:["₹",t.product_id.total_sell_price]}),e.jsxs("span",{className:"text-sm line-through text-gray-400",children:["₹",t.product_id.total_original_price]})]})]}),e.jsxs("div",{className:"font-semibold text-gray-700 mr-16",children:["₹",(t.product_id.total_sell_price*t.quantity).toFixed(2)]})]}),J=({totals:t})=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Items"}),e.jsx("span",{children:t.total_quantity})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Original Price"}),e.jsxs("span",{children:["₹",t.total_original_price]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium text-green-700",children:[e.jsx("span",{children:"Discounted Price"}),e.jsxs("span",{children:["₹",t.total_sell_price]})]})]}),le=()=>{const t=F(),r=$(),n=new URLSearchParams(t.search),o=n.get("cart_id"),m=n.get("type"),{data:a,isLoading:c,refetch:i}=I({type:m||"through_cart",cart_id:o||""}),[u,x]=b.useState(1),[s,p]=b.useState(null),[d,l]=P.useState("upi"),{mutate:g,isPending:h}=z();return c?e.jsx(N,{}):a&&e.jsxs("div",{children:[e.jsx(X,{step:u,setStep:x}),u===1&&e.jsx(V,{selectedAddress:s,setSelectedAddress:p,onContinue:()=>x(2)}),u===2&&s&&e.jsx(H,{products:a.results,address:s,subtotal:a.total_carts.total_sell_price,shipping:a.total_carts.total_quantity,discount:a.total_carts.total_original_price-a.total_carts.total_sell_price,refetch:i,onContinue:()=>x(3)}),u===3&&e.jsx(Z,{productData:a,setPaymentMethod:l,onConfirm:y=>{g(y,{onSuccess:w=>{console.log(w);const{_id:q}=w;j.success("Order placed successfully"),r(`/order-status?order_id=${q}`,{replace:!0})}})},isPending:h,address:s})]})};export{le as default};
