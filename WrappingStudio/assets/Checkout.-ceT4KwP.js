import{j as e,i as y,z as v,R as N,h as P,e as S,r as f}from"./index.bXKJJq9E.js";import{u as A,A as O}from"./AddressModal.D3EeOdH6.js";import{u as z}from"./useModal.4BY1klWy.js";import{B as F}from"./ButtonBar.C5On5S_O.js";import{P as w}from"./PageHeadline.COcIlFem.js";import{b as $,u as I}from"./useCart.EXVdgE77.js";import{u as L}from"./useOrder.CwHUm_PZ.js";import"./index.esm.C6xHGqC8.js";import"./useMutation.De94NKpU.js";import"./queryToast.C7s0pjE9.js";const M=({selectedAddress:s,setSelectedAddress:r,onContinue:d})=>{const{data:i,isLoading:x,error:n,refetch:c}=A({pageNumber:1,pageSize:10}),{openModal:l,closeModal:m,isModalOpen:u}=z();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4 max-w-xl mx-auto",children:[e.jsx(w,{title:"Address",component:e.jsxs(e.Fragment,{children:[e.jsx(F,{buttons:[{label:"Add New",onClick:()=>l({isAddress:!0}),colorClass:"bg-blue-500"}]})," "]})}),e.jsx(O,{show:u?.isAddress||!1,handleClose:()=>m({isAddress:!1}),isAdd:!0,refetch:c}),x&&e.jsx(y,{}),n&&e.jsx("p",{className:"text-red-500",children:"Failed to load addresses"}),i?.results?.length?e.jsx("div",{className:"space-y-2 max-h-[50vh] custom-scroll",children:i.results.map(a=>e.jsxs("div",{onClick:()=>a._id&&r(a),className:`relative p-3 border rounded cursor-pointer ${s?._id===a._id?"border-pink-600 bg-pink-50":"border-gray-300"}`,children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 z-10",children:[e.jsx("button",{onClick:p=>{p.stopPropagation()},className:"p-1 text-gray-500 hover:text-pink-600 hover:bg-gray-200 rounded transition",title:"Edit Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),v.success(`Deleted address: ${a.name}`)},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-gray-200 rounded transition",title:"Delete Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.addressLine1}),a.addressLine2&&e.jsx("p",{className:"text-sm text-gray-600",children:a.addressLine2}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.city,", ",a.state," - ",a.postalCode]}),e.jsx("p",{className:"text-sm text-gray-600",children:a.country}),e.jsx("p",{className:"text-sm text-gray-600",children:a.phone})]},a._id))}):e.jsx("p",{className:"text-gray-500",children:"No saved addresses"}),e.jsx("button",{onClick:d,disabled:!s,className:"bg-pink-600 text-white px-6 py-2 rounded hover:bg-pink-700 w-full disabled:opacity-50",children:"Continue to Payment"})]})},D=({products:s,address:r,subtotal:d,discount:i=0,refetch:x,onContinue:n})=>{const{handleIncrease:c,handleDecrease:l,handleRemove:m,isPending:u}=$(x),a=d+i,p=d;return e.jsxs("div",{className:"max-w-4xl mx-auto  bg-gradient-to-br from-pink-50 to-white rounded-xl shadow-xl",children:[e.jsx(w,{title:"Summary"}),e.jsxs("div",{className:"sm:p-8 p-2 flex gap-3 flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md sm:p-6 p-2",children:[e.jsx("h3",{className:"font-semibold text-2xl mb-4 border-b border-pink-300 pb-2",children:"Shipping Address"}),e.jsxs("address",{className:"not-italic space-y-1 text-gray-800 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-lg",children:r.name}),e.jsxs("p",{children:[r.addressLine1,r.addressLine2&&`, ${r.addressLine2}`]}),e.jsxs("p",{children:[r.city,", ",r.state," - ",r.postalCode]}),e.jsx("p",{children:r.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Phone: ",r.phone]})]})]}),e.jsxs("div",{className:"max-h-[50vh] custom-scroll",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-white bg-opacity-90 backdrop-blur-md border-b border-pink-300 py-3 px-2",children:e.jsxs("h3",{className:"font-semibold text-2xl text-pink-600 tracking-wide",children:["Products:- ",s.length]})}),e.jsx("div",{className:"space-y-6 mt-4",children:u?e.jsx(y,{}):s.map(o=>{const t=typeof o.product_id=="string"?null:o.product_id;if(!t)return e.jsxs("div",{className:"text-red-700 font-semibold bg-red-100 p-4 rounded-md shadow-sm",children:["Product data missing for item ",o._id]},o._id);const j=!t.inStock||t.stock===0,h=o.quantity<t.stock,g=o.quantity>0;return e.jsxs("div",{className:"flex items-center flex-wrap justify-between border rounded-lg border-gray-200 p-4 shadow-sm hover:shadow-lg transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[t.images?e.jsx("img",{src:t.images,alt:t.name,className:"w-24 h-24 object-cover rounded-lg shadow-md",loading:"lazy"}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-sm font-medium",children:"No Image"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:t.name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Quantity: ",o.quantity]}),j&&e.jsxs("p",{className:"text-red-600 flex items-center gap-2 mt-2 font-medium",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"error"}),"Sorry, this product is out of stock. Available stock:"," ",t.stock]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"font-bold text-lg text-pink-600 tracking-wide",children:["₹",t.total_sell_price.toFixed(2)]}),e.jsx("button",{onClick:()=>l(o),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${g?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Decrease quantity of ${t.name}`,type:"button",disabled:!g,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"remove"})}),e.jsx("button",{onClick:()=>c(o),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${h?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Increase quantity of ${t.name}`,type:"button",disabled:!h,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"})}),e.jsx("button",{onClick:()=>m(o),className:"flex items-center justify-center w-10 h-10 bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-300 text-white rounded-full shadow-md transition-transform active:scale-95","aria-label":`Remove ${t.name} from cart`,type:"button",children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]},o._id)})})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Price"}),e.jsxs("span",{children:["₹",a.toFixed(2)]})]}),i>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-semibold text-lg",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",i.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Subtotal (Incl. GST)"}),e.jsxs("span",{children:["₹",d.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-extrabold text-2xl pt-3 text-pink-600",children:[e.jsx("span",{children:"Total Payable"}),e.jsxs("span",{children:["₹",p.toFixed(2)]})]})]}),e.jsx("button",{onClick:n,className:"w-full mt-8 bg-gradient-to-r from-pink-500 to-pink-700 hover:from-pink-700 hover:to-pink-900 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95",type:"button",children:"Proceed to Payment"})]})]})},q=({step:s,setStep:r})=>{const d=["Address","Summary","Payment","Done"];return e.jsx("div",{className:"w-full bg-white p-4 rounded-md shadow border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between relative",children:d.map((i,x)=>{const n=x+1,c=s===n,l=s>n;return e.jsxs("div",{className:"flex flex-col items-center flex-1 relative",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold z-10 cursor-pointer
                  ${l?"bg-green-500 text-white":c?"bg-pink-500 text-white":"bg-gray-200 text-gray-500"}`,onClick:()=>r(n),children:l?"✓":n}),e.jsx("span",{className:`mt-2 text-xs sm:text-sm text-center
                  ${c?"text-pink-600 font-medium":l?"text-green-600":"text-gray-400"}`,children:i}),x<d.length-1&&e.jsxs("div",{className:"absolute top-[15px] left-1/2 w-full h-0.5 -z-0",children:[e.jsx("div",{className:"h-[3px] absolute left-0 bg-gray-300 w-full"}),e.jsx("div",{className:`h-[3px] absolute left-0 transition-all duration-500
        ${l&&"bg-green-500"}`,style:{width:l?"100%":c?"50%":"0%"}})]})]},i)})})})},R=({productData:s,setPaymentMethod:r,onConfirm:d,isPending:i,address:x})=>{const{results:n,total_carts:c}=s,[l,m]=N.useState("razorpay"),[u,a]=N.useState("upi"),p=t=>{m(t),r(t)},o=()=>{d({address_id:x?._id,card_id:n.map(t=>t._id),paymentMethod:l,...l==="razorpay"&&{method:u}})};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-3",children:"Review & Payment"}),e.jsx("div",{className:"space-y-4",children:n.map(t=>e.jsx(T,{item:t},t._id))}),e.jsx(B,{totals:c}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Select Payment Method"}),e.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:l,onChange:t=>p(t.target.value),children:[e.jsx("option",{value:"razorpay",children:"Pay With Online"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"})]})]}),l==="razorpay"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Choose Online Payment Mode"}),e.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:u,onChange:t=>a(t.target.value),children:[e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Debit / Credit Card"}),e.jsx("option",{value:"netbanking",children:"Net Banking"}),e.jsx("option",{value:"wallet",children:"Wallet"})]})]}),e.jsx("button",{className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition disabled:opacity-60",onClick:o,disabled:i,children:i?"Processing...":"Confirm & Pay"})]})},T=({item:s})=>e.jsxs("div",{className:"flex items-center gap-4 border-b pb-4 last:border-none",children:[e.jsx("img",{src:s.product_id.images,alt:s.product_id.name,className:"w-20 h-20 object-contain rounded border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.product_id.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",s.quantity," | In stock: ",s.product_id.stock]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-700",children:["₹",s.product_id.total_sell_price]}),e.jsxs("span",{className:"text-sm line-through text-gray-400",children:["₹",s.product_id.total_original_price]})]})]}),e.jsxs("div",{className:"font-semibold text-gray-700 mr-16",children:["₹",(s.product_id.total_sell_price*s.quantity).toFixed(2)]})]}),B=({totals:s})=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Items"}),e.jsx("span",{children:s.total_quantity})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Price"}),e.jsxs("span",{children:["₹",s.total_original_price.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-green-700",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",(s.total_original_price-s.total_sell_price).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"Subtotal (Incl. GST)"}),e.jsxs("span",{children:["₹",s.total_sell_price.toFixed(2)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Item Total (Incl. GST)"}),e.jsxs("span",{children:["₹",s.total_sell_price.toFixed(2)]})]})]}),Y=()=>{const s=P(),r=S(),d=new URLSearchParams(s.search),i=d.get("cart_id"),x=d.get("type"),{data:n,isLoading:c,refetch:l}=I({type:x||"through_cart",cart_id:i||""}),[m,u]=f.useState(1),[a,p]=f.useState(null),[o,t]=f.useState("razorpay"),{mutate:j,isPending:h}=L(),g=_=>{h||j(_,{onSuccess:k=>{const{_id:C,paymentRes:b}=k;b&&b.url?window.open(b.url,"_self"):(v.success("Order placed successfully"),r(`/order-status?order_id=${C}`,{replace:!0}))}})};return c?e.jsx(y,{}):n?e.jsxs("div",{children:[e.jsx(q,{step:m,setStep:u}),m===1&&e.jsx(M,{selectedAddress:a,setSelectedAddress:p,onContinue:()=>u(2)}),m===2&&a&&e.jsx(D,{products:n.results,address:a,subtotal:n.total_carts.total_sell_price,discount:n.total_carts.total_original_price-n.total_carts.total_sell_price,refetch:l,onContinue:()=>u(3)}),m===3&&a&&e.jsx(R,{productData:n,setPaymentMethod:t,onConfirm:g,isPending:h,address:a})]}):null};export{Y as default};
