import{b as f,n as x,r as c,d as S,j as o,i as v}from"./index.C6Nt1IZo.js";import{u}from"./useMutation.DmWZvgnl.js";import{a as k}from"./queryToast.CdnRU_Iq.js";const j=async t=>(await x.post("https://api.unibcomp.in/api/v1/user/payment/pay",{payment_session_id:t})).data,N=async t=>(await f.post("/check/deposit",{payment_session_id:t})).data,C=async t=>(await x.put(`https://api.unibcomp.in/api/v1/user/deposit/update/${t}`)).data,I=async t=>(await f.post("/payment/update",t)).data,z=()=>{const t=u({mutationFn:j}),e=u({mutationFn:N}),s=u({mutationFn:C}),a=u({mutationFn:I});return{depositRequestMutation:t,depositProcessMutation:e,depositStatusUpdateMutation:s,depositUpdate2:a}},M=()=>{const{depositUpdate2:t}=z();return{openRazorpayCheckout:({key:s,order_id:a,amount:d,currency:n,customer:r})=>{if(!window.Razorpay){alert("Razorpay SDK not loaded properly.");return}const m={key:s,order_id:a,amount:d*100,currency:n||"INR",name:"UnibComp",description:"Order Payment",prefill:{name:r?.name||"",email:r?.email||"",contact:r?.contact||""},theme:{color:"#3399cc"},handler:function(p){t.mutate({order_id:a,status:"SUCCESS",payment_id:p.razorpay_payment_id,signature:p.razorpay_signature}),window.location.replace("/")},modal:{ondismiss:function(){t.mutate({order_id:a,status:"FAILED"},k(()=>window.location.replace("/")))}}};new window.Razorpay(m).open()}}},A=()=>{const[t,e]=c.useState("â³ Navigating to payment gateway..."),[s,a]=c.useState("loading"),[d]=S(),n=d.get("payment_session_id"),{depositProcessMutation:r}=z(),{openRazorpayCheckout:m}=M(),[y,p]=c.useState(0);return c.useEffect(()=>{if(!n){a("error"),e("âŒ Payment link is invalid, expired, or already used.");return}r.mutate(n,{onSuccess:i=>{if(!i||!i.data){a("error"),e("âŒ Invalid response from server.");return}const{paymentMode:g,data:P}=i,{key:h,order_id:w,amount:l,customer:R}=P;g==="razorpay"?h&&w&&l?(p(l),m({key:h,order_id:w,amount:l,customer:R,currency:"INR"}),a("success"),e("ğŸš€ Redirecting to Razorpay...")):(a("error"),e("âŒ Missing Razorpay configuration.")):(a("error"),e(`âŒ Payment mode ${g} not supported yet.`))},onError:i=>{console.error("Deposit API Error:",i),a("error"),e("âŒ Payment link is invalid, expired, or already used.")}})},[n]),o.jsx("div",{className:"deposit-container",children:o.jsxs("div",{className:"deposit-card",children:[s==="loading"&&o.jsx(v,{}),o.jsxs("p",{className:`message ${s}`,children:[s==="loading"&&"â³ ",t]}),s==="error"&&o.jsx("button",{className:"retry-btn",onClick:()=>window.history.back(),children:"ğŸ” Try Again"}),s==="success"&&y&&o.jsx("div",{className:"text-gray-600",children:o.jsxs("p",{className:"text-sm",children:["Please wait while we process your payment of â‚¹",y]})})]})})};export{A as default};
