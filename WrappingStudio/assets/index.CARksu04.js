import{r as t,j as y}from"./index.5YY_tytV.js";import{M as T,i as W,u as L,P as b,a as A,b as D,L as H}from"./proxy.CxDTGf0M.js";class K extends t.Component{getSnapshotBeforeUpdate(l){const e=this.props.childRef.current;if(e&&l.isPresent&&!this.props.isPresent){const f=e.offsetParent,m=W(f)&&f.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=m-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function U({children:i,isPresent:l,anchorX:e,root:f}){const m=t.useId(),n=t.useRef(null),p=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:x}=t.useContext(T);return t.useInsertionEffect(()=>{const{width:g,height:s,top:E,left:r,right:u}=p.current;if(l||!n.current||!g||!s)return;const a=e==="left"?`left: ${r}`:`right: ${u}`;n.current.dataset.motionPopId=m;const c=document.createElement("style");x&&(c.nonce=x);const d=f??document.head;return d.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${s}px !important;
            ${a}px !important;
            top: ${E}px !important;
          }
        `),()=>{d.contains(c)&&d.removeChild(c)}},[l]),y.jsx(K,{isPresent:l,childRef:n,sizeRef:p,children:t.cloneElement(i,{ref:n})})}const B=({children:i,initial:l,isPresent:e,onExitComplete:f,custom:m,presenceAffectsLayout:n,mode:p,anchorX:x,root:g})=>{const s=L(F),E=t.useId();let r=!0,u=t.useMemo(()=>(r=!1,{id:E,initial:l,isPresent:e,custom:m,onExitComplete:a=>{s.set(a,!0);for(const c of s.values())if(!c)return;f&&f()},register:a=>(s.set(a,!1),()=>s.delete(a))}),[e,s,f]);return n&&r&&(u={...u}),t.useMemo(()=>{s.forEach((a,c)=>s.set(c,!1))},[e]),t.useEffect(()=>{!e&&!s.size&&f&&f()},[e]),p==="popLayout"&&(i=y.jsx(U,{isPresent:e,anchorX:x,root:g,children:i})),y.jsx(b.Provider,{value:u,children:i})};function F(){return new Map}const P=i=>i.key||"";function $(i){const l=[];return t.Children.forEach(i,e=>{t.isValidElement(e)&&l.push(e)}),l}const X=({children:i,custom:l,initial:e=!0,onExitComplete:f,presenceAffectsLayout:m=!0,mode:n="sync",propagate:p=!1,anchorX:x="left",root:g})=>{const[s,E]=A(p),r=t.useMemo(()=>$(i),[i]),u=p&&!s?[]:r.map(P),a=t.useRef(!0),c=t.useRef(r),d=L(()=>new Map),[z,I]=t.useState(r),[C,j]=t.useState(r);D(()=>{a.current=!1,c.current=r;for(let h=0;h<C.length;h++){const o=P(C[h]);u.includes(o)?d.delete(o):d.get(o)!==!0&&d.set(o,!1)}},[C,u.length,u.join("-")]);const M=[];if(r!==z){let h=[...r];for(let o=0;o<C.length;o++){const R=C[o],w=P(R);u.includes(w)||(h.splice(o,0,R),M.push(R))}return n==="wait"&&M.length&&(h=M),j($(h)),I(r),null}const{forceRender:k}=t.useContext(H);return y.jsx(y.Fragment,{children:C.map(h=>{const o=P(h),R=p&&!s?!1:r===C||u.includes(o),w=()=>{if(d.has(o))d.set(o,!0);else return;let v=!0;d.forEach(S=>{S||(v=!1)}),v&&(k?.(),j(c.current),p&&E?.(),f&&f())};return y.jsx(B,{isPresent:R,initial:!a.current||e?void 0:!1,custom:l,presenceAffectsLayout:m,mode:n,root:g,onExitComplete:R?void 0:w,anchorX:x,children:h},o)})})};export{X as A};
