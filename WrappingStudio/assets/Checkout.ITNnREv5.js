import{j as e,m as b,z as N,R as v,h as k,e as C,r as y}from"./index.BZ3CuIN3.js";import{u as P,A as S}from"./AddressModal.CsCXY1oV.js";import{u as A}from"./useModal.d5guQICm.js";import{P as w,B as $}from"./ButtonBar.IK0KlQIs.js";import{b as L,u as D}from"./useCart.DdR8M3Ax.js";import{u as O}from"./useOrder.BZl9V5nI.js";import"./index.esm.nnVlaqJ0.js";import"./useMutation.DbXY277N.js";import"./queryToast.Ckz_Oloe.js";const q=({selectedAddress:t,setSelectedAddress:n,onContinue:o})=>{const{data:i,isLoading:x,error:a,refetch:d}=P({pageNumber:1,pageSize:10}),{openModal:l,closeModal:m,isModalOpen:u}=A();return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow space-y-4 max-w-xl mx-auto",children:[e.jsx(w,{title:"Address",component:e.jsxs(e.Fragment,{children:[e.jsx($,{buttons:[{label:"Add New",onClick:()=>l({isAddress:!0}),colorClass:"bg-blue-500"}]})," "]})}),e.jsx(S,{show:u?.isAddress||!1,handleClose:()=>m({isAddress:!1}),isAdd:!0,refetch:d}),x&&e.jsx(b,{}),a&&e.jsx("p",{className:"text-red-500",children:"Failed to load addresses"}),i?.results?.length?e.jsx("div",{className:"space-y-2 max-h-[50vh] custom-scroll",children:i.results.map(s=>e.jsxs("div",{onClick:()=>s._id&&n(s),className:`relative p-3 border rounded cursor-pointer ${t?._id===s._id?"border-pink-600 bg-pink-50":"border-gray-300"}`,children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 z-10",children:[e.jsx("button",{onClick:p=>{p.stopPropagation()},className:"p-1 text-gray-500 hover:text-pink-600 hover:bg-gray-200 rounded transition",title:"Edit Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"edit"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),N.success(`Deleted address: ${s.name}`)},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-gray-200 rounded transition",title:"Delete Address",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})})]}),e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.addressLine1}),s.addressLine2&&e.jsx("p",{className:"text-sm text-gray-600",children:s.addressLine2}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.city,", ",s.state," - ",s.postalCode]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.country}),e.jsx("p",{className:"text-sm text-gray-600",children:s.phone})]},s._id))}):e.jsx("p",{className:"text-gray-500",children:"No saved addresses"}),e.jsx("button",{onClick:o,disabled:!t,className:"bg-pink-600 text-white px-6 py-2 rounded hover:bg-pink-700 w-full disabled:opacity-50",children:"Continue to Payment"})]})},F=({products:t,address:n,subtotal:o,shipping:i,discount:x=0,refetch:a,onContinue:d})=>{const{handleIncrease:l,handleDecrease:m,handleRemove:u,isPending:s}=L(a),p=o+i;return e.jsxs("div",{className:"max-w-4xl mx-auto  bg-gradient-to-br from-pink-50 to-white rounded-xl shadow-xl",children:[e.jsx(w,{title:"Summary"}),e.jsxs("div",{className:"sm:p-8 p-2 flex gap-3 flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md sm:p-6 p-2",children:[e.jsx("h3",{className:"font-semibold text-2xl mb-4 border-b border-pink-300 pb-2",children:"Shipping Address"}),e.jsxs("address",{className:"not-italic space-y-1 text-gray-800 leading-relaxed",children:[e.jsx("p",{className:"font-semibold text-lg",children:n.name}),e.jsxs("p",{children:[n.addressLine1,n.addressLine2&&`, ${n.addressLine2}`]}),e.jsxs("p",{children:[n.city,", ",n.state," - ",n.postalCode]}),e.jsx("p",{children:n.country}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Phone: ",n.phone]})]})]}),e.jsxs("div",{className:"max-h-[50vh] custom-scroll",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-white bg-opacity-90 backdrop-blur-md border-b border-pink-300 py-3 px-2",children:e.jsxs("h3",{className:"font-semibold text-2xl text-pink-600 tracking-wide",children:["Products:- ",t.length]})}),e.jsx("div",{className:"space-y-6 mt-4",children:s?e.jsx(b,{}):t.map(c=>{const r=typeof c.product_id=="string"?null:c.product_id;if(!r)return e.jsxs("div",{className:"text-red-700 font-semibold bg-red-100 p-4 rounded-md shadow-sm",children:["Product data missing for item ",c._id]},c._id);const j=!r.inStock||r.stock===0,h=c.quantity<r.stock,g=c.quantity>0;return e.jsxs("div",{className:"flex items-center flex-wrap justify-between border rounded-lg border-gray-200 p-4 shadow-sm hover:shadow-lg transition-shadow duration-300",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[r.images?e.jsx("img",{src:r.images,alt:r.name,className:"w-24 h-24 object-cover rounded-lg shadow-md",loading:"lazy"}):e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-sm font-medium",children:"No Image"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:r.name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Quantity: ",c.quantity]}),j&&e.jsxs("p",{className:"text-red-600 flex items-center gap-2 mt-2 font-medium",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"error"}),"Sorry, this product is out of stock. Available stock:"," ",r.stock]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"font-bold text-lg text-pink-600 tracking-wide",children:["₹",r.total_sell_price.toFixed(2)]}),e.jsx("button",{onClick:()=>m(c),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${g?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Decrease quantity of ${r.name}`,type:"button",disabled:!g,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"remove"})}),e.jsx("button",{onClick:()=>l(c),className:`flex items-center justify-center w-10 h-10 rounded-full text-white shadow-md transition-transform transform ${h?"bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-pink-300 active:scale-95":"bg-gray-300 cursor-not-allowed"}`,"aria-label":`Increase quantity of ${r.name}`,type:"button",disabled:!h,children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"add"})}),e.jsx("button",{onClick:()=>u(c),className:"flex items-center justify-center w-10 h-10 bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-300 text-white rounded-full shadow-md transition-transform active:scale-95","aria-label":`Remove ${r.name} from cart`,type:"button",children:e.jsx("span",{className:"material-symbols-outlined text-lg",children:"delete"})})]})]},c._id)})})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700 text-lg",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",i.toFixed(2)]})]}),x>0&&e.jsxs("div",{className:"flex justify-between text-green-600 font-semibold text-lg",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",x.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-extrabold text-2xl pt-3 text-pink-600",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",p.toFixed(2)]})]})]}),e.jsx("button",{onClick:d,className:"w-full mt-8 bg-gradient-to-r from-pink-500 to-pink-700 hover:from-pink-700 hover:to-pink-900 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95",type:"button",children:"Proceed to Payment"})]})]})},M=({step:t,setStep:n})=>{const o=["Address","Summary","Payment","Done"];return e.jsx("div",{className:"w-full bg-white p-4 rounded-md shadow border border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between relative",children:o.map((i,x)=>{const a=x+1,d=t===a,l=t>a;return e.jsxs("div",{className:"flex flex-col items-center flex-1 relative",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-semibold z-10
                  ${l?"bg-green-500 text-white":d?"bg-pink-500 text-white":"bg-gray-200 text-gray-500"}`,onClick:()=>n(a),children:l?"✓":a}),e.jsx("span",{className:`mt-2 text-xs sm:text-sm text-center
                  ${d?"text-pink-600 font-medium":l?"text-green-600":"text-gray-400"}`,children:i}),x<o.length-1&&e.jsxs("div",{className:"absolute top-[15px] left-1/2 w-full h-0.5 -z-0",children:[e.jsx("div",{className:"h-[3px] absolute left-0 bg-gray-300 w-full"}),e.jsx("div",{className:`h-[3px] absolute left-0 transition-all duration-500
        ${l&&"bg-green-500"}`,style:{width:l?"100%":d?"50%":"0%"}})]})]},i)})})})},z=({productData:t,setPaymentMethod:n,onConfirm:o,isPending:i,address:x})=>{const{results:a,total_carts:d}=t,[l,m]=v.useState("upi"),u=s=>{m(s),n(s)};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto space-y-6",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-3",children:"Review & Payment"}),e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsx(I,{item:s},s._id))}),e.jsx(R,{totals:d}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Select Payment Method"}),e.jsxs("select",{className:"w-full border px-3 py-2 rounded",value:l,onChange:s=>u(s.target.value),children:[e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Credit/Debit Card"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"})]})]}),e.jsx("button",{className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition disabled:opacity-60",onClick:()=>o({address_id:x?._id,card_id:a.map(s=>s._id),paymentMethod:l}),disabled:i,children:i?"Processing...":`Confirm & Pay ₹${d.total_sell_price.toFixed(2)}`})]})},I=({item:t})=>e.jsxs("div",{className:"flex items-center gap-4 border-b pb-4 last:border-none",children:[e.jsx("img",{src:t.product_id.images,alt:t.product_id.name,className:"w-20 h-20 object-contain rounded border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:t.product_id.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",t.quantity," | In stock: ",t.product_id.stock]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-700",children:["₹",t.product_id.total_sell_price]}),e.jsxs("span",{className:"text-sm line-through text-gray-400",children:["₹",t.product_id.total_original_price]})]})]}),e.jsxs("div",{className:"font-semibold text-gray-700 mr-16",children:["₹",(t.product_id.total_sell_price*t.quantity).toFixed(2)]})]}),R=({totals:t})=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Items"}),e.jsx("span",{children:t.total_quantity})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Original Price"}),e.jsxs("span",{children:["₹",t.total_original_price]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium text-green-700",children:[e.jsx("span",{children:"Discounted Price"}),e.jsxs("span",{children:["₹",t.total_sell_price]})]})]}),V=()=>{const t=k(),n=C(),o=new URLSearchParams(t.search),i=o.get("cart_id"),x=o.get("type"),{data:a,isLoading:d,refetch:l}=D({type:x||"through_cart",cart_id:i||""}),[m,u]=y.useState(1),[s,p]=y.useState(null),[c,r]=v.useState("upi"),{mutate:j,isPending:h}=O();return d?e.jsx(b,{}):a&&e.jsxs("div",{children:[e.jsx(M,{step:m,setStep:u}),m===1&&e.jsx(q,{selectedAddress:s,setSelectedAddress:p,onContinue:()=>u(2)}),m===2&&s&&e.jsx(F,{products:a.results,address:s,subtotal:a.total_carts.total_sell_price,shipping:a.total_carts.total_quantity,discount:a.total_carts.total_original_price-a.total_carts.total_sell_price,refetch:l,onContinue:()=>u(3)}),m===3&&e.jsx(z,{productData:a,setPaymentMethod:r,onConfirm:g=>{j(g,{onSuccess:f=>{console.log(f);const{_id:_}=f;N.success("Order placed successfully"),n(`/order-status?order_id=${_}`,{replace:!0})}})},isPending:h,address:s})]})};export{V as default};
